<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Ubuntu for Linux 基础练习 | leccxx-blogs</title><meta name="author" content="leccxx,25225ccxx@gmail.com"><meta name="copyright" content="leccxx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Ubuntu for Linux 基础练习Ubuntu操作练习基础操作  用户和权限管理 创建新用户testuser并设置密码 将该用户添加到sudo组 创建一个共享目录&#x2F;home&#x2F;shared,设置权限775，确保该组用户有读写权限  1234567891011121314151617181920212223242526272829### 相关操作# 创建用户组zdffgroupsudo gro"><meta property="og:type" content="article"><meta property="og:title" content="Ubuntu for Linux 基础练习"><meta property="og:url" content="https://leccxx-maker.github.io/ccxx/2025/11/17/Ubuntu%20for%20Linux%20%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0/index.html"><meta property="og:site_name" content="leccxx-blogs"><meta property="og:description" content="Ubuntu for Linux 基础练习Ubuntu操作练习基础操作  用户和权限管理 创建新用户testuser并设置密码 将该用户添加到sudo组 创建一个共享目录&#x2F;home&#x2F;shared,设置权限775，确保该组用户有读写权限  1234567891011121314151617181920212223242526272829### 相关操作# 创建用户组zdffgroupsudo gro"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg"><meta property="article:published_time" content="2025-11-17T16:00:00.000Z"><meta property="article:modified_time" content="2025-11-30T14:30:46.211Z"><meta property="article:author" content="leccxx"><meta property="article:tag" content="练习"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Ubuntu for Linux 基础练习",
  "url": "https://leccxx-maker.github.io/ccxx/2025/11/17/Ubuntu%20for%20Linux%20%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0/",
  "image": "https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg",
  "datePublished": "2025-11-17T16:00:00.000Z",
  "dateModified": "2025-11-30T14:30:46.211Z",
  "author": [
    {
      "@type": "Person",
      "name": "leccxx",
      "url": "https://leccxx-maker.github.io/ccxx"
    }
  ]
}</script><link rel="shortcut icon" href="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/favicon/favicon-16x16.png"><link rel="canonical" href="https://leccxx-maker.github.io/ccxx/2025/11/17/Ubuntu%20for%20Linux%20%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/ccxx/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),r=window.matchMedia("(prefers-color-scheme: dark)"),c=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(c.matches)a();else if(r.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}r.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?o():a())})}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>const GLOBAL_CONFIG={root:"/ccxx/",algolia:void 0,localSearch:void 0,translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:300,highlightFullpage:!1,highlightMacStyle:!1},copy:{success:"Copy Successful",error:"Copy Failed",noSupport:"Browser Not Supported"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"Just now",min:"minutes ago",hour:"hours ago",day:"days ago",month:"months ago"},copyright:void 0,lightbox:"null",Snackbar:void 0,infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"Load More"},isPhotoFigcaption:!1,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Ubuntu for Linux 基础练习",isHighlightShrink:!0,isToc:!0,pageType:"post"}</script><style>@media screen and (max-width:768px){#page-header{height:55vh!important;background-size:cover!important;background-position:center!important;background-attachment:scroll!important}#site-title{font-size:1.8rem!important;line-height:1.2!important}#site-subtitle{font-size:1rem!important;opacity:.85!important}#content-inner{padding:12px!important}.card-widget,.recent-post-item{border-radius:14px!important;margin-bottom:14px!important}.post-content img{max-width:100%!important;height:auto!important;border-radius:8px}}</style><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image:url(https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/megalith-7683754.jpg)"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/avatar/avatar.jpg" onerror='this.onerror=null,this.src="/ccxx/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/ccxx/archives/"><div class="headline">Articles</div><div class="length-num">5</div></a><a href="/ccxx/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/ccxx/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/ccxx/"><i class="fa-fw fas fa-house-user"></i><span> home</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/archives/"><i class="fa-fw fas fa-box-open"></i><span> archives</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/tags/"><i class="fa-fw fas fa-hashtag"></i><span> tags</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/categories/"><i class="fa-fw fas fa-layer-group"></i><span> categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/ccxx/"><span class="site-name">leccxx-blogs</span></a><a class="nav-page-title" href="/ccxx/"><span class="site-name">Ubuntu for Linux 基础练习</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/ccxx/"><i class="fa-fw fas fa-house-user"></i><span> home</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/archives/"><i class="fa-fw fas fa-box-open"></i><span> archives</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/tags/"><i class="fa-fw fas fa-hashtag"></i><span> tags</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/categories/"><i class="fa-fw fas fa-layer-group"></i><span> categories</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Ubuntu for Linux 基础练习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-11-17T16:00:00.000Z" title="Created 2025-11-18 00:00:00">2025-11-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-11-30T14:30:46.211Z" title="Updated 2025-11-30 22:30:46">2025-11-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/ccxx/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Ubuntu-for-Linux-基础练习"><a href="#Ubuntu-for-Linux-基础练习" class="headerlink" title="Ubuntu for Linux 基础练习"></a>Ubuntu for Linux 基础练习</h1><h2 id="Ubuntu操作练习"><a href="#Ubuntu操作练习" class="headerlink" title="Ubuntu操作练习"></a>Ubuntu操作练习</h2><p><strong>基础操作</strong></p><ol><li><h3 id="用户和权限管理"><a href="#用户和权限管理" class="headerlink" title="用户和权限管理"></a>用户和权限管理</h3><ul><li>创建新用户<code>testuser</code>并设置密码</li><li>将该用户添加到<code>sudo</code>组</li><li>创建一个共享目录<code>/home/shared</code>,设置权限775，确保该组用户有读写权限</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 相关操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建用户组zdffgroup</span></span><br><span class="line"><span class="built_in">sudo</span> groupadd zdffgroup</span><br><span class="line"><span class="comment"># 创建用户testuser并将其加入zdffgroup组</span></span><br><span class="line"><span class="built_in">sudo</span> useradd -m -g zdffgroup -s /bin/bash testuser</span><br><span class="line"><span class="comment"># 设置用户testuser密码</span></span><br><span class="line"><span class="built_in">sudo</span> passwd testuser</span><br><span class="line"><span class="comment"># 给testuser用户授予管理员权限</span></span><br><span class="line"><span class="built_in">sudo</span> usermod -aG <span class="built_in">sudo</span> testuser</span><br><span class="line"><span class="comment"># 创建一个共享目录`/home/shared`,设置权限775，确保该组用户有读写权限</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> /home/shared</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> :zdffgroup /home/shared/</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 775 /home/shared</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">创建用户之前创建用户组是属于同一组的用户以便共享文件权限，当创建用户时，不指定组，Linux会自动创建一个与用户名同名的组作为该用户的主组。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sudo useradd -m -g zdffgroup -s /bin/bash testuser</span></span><br><span class="line"><span class="string">-m 或 --create-home 在创建用户的同时，为用户创建家目录</span></span><br><span class="line"><span class="string">-g 指定新用户所属的主组</span></span><br><span class="line"><span class="string">-s /bin/bash 为用户指定默认的登录Shell</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sudo usermod -aG sudo testuser</span></span><br><span class="line"><span class="string">-G 指定要添加的附加组</span></span><br><span class="line"><span class="string">-a append（追加）的意思，将用户添加到指定的附加组中，而不影响用户已有的其他附加组</span></span><br><span class="line"><span class="string">&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/doc_k8s_2025-11-20_images/%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86.png" alt="用户和权限管理"></p></li><li><h3 id="软件包管理"><a href="#软件包管理" class="headerlink" title="软件包管理"></a>软件包管理</h3><ul><li>使用apt更新软件包列表</li><li>安装<code>nginx web</code>服务器</li><li>配置<code>nginx</code>开机自启，并启动服务</li><li>使用<code>systemctl</code>检查服务状态</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install nginx -y</span><br><span class="line"><span class="built_in">sudo</span> systemctl start nginx</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> nginx</span><br><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure><p><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/doc_k8s_2025-11-20_images/%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86.png" alt="软件包管理"></p></li><li><h3 id="进程和系统监控"><a href="#进程和系统监控" class="headerlink" title="进程和系统监控"></a>进程和系统监控</h3><ul><li>使用<code>htop</code>监控系统资源</li><li>查找占用CPU最高的进程</li><li>使用<code>journalctl</code>查看系统日志</li><li>设置一个定时任务，每天凌晨3点清理临时文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用htop</span></span><br><span class="line">htop</span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">htop 界面说明</span></span><br><span class="line"><span class="string">上部：CPU使用率、内存使用情况、交换空间、负载平均值</span></span><br><span class="line"><span class="string">中部：进程列表，显示PID、用户、优先级、CPU%、内存%、进程命令</span></span><br><span class="line"><span class="string">下部：功能键提示</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="comment"># 查找占用CPU最高的进程</span></span><br><span class="line">ps aux --<span class="built_in">sort</span>=-%cpu | <span class="built_in">head</span> -11</span><br><span class="line"><span class="comment">### 使用journalctl查看系统日志</span></span><br><span class="line"><span class="comment"># 查看所有日志</span></span><br><span class="line"><span class="built_in">sudo</span> journalctl</span><br><span class="line"><span class="comment"># 查看最近的日志并实时刷新</span></span><br><span class="line"><span class="built_in">sudo</span> journalctl -f</span><br><span class="line"><span class="comment"># 查看指定服务的日志</span></span><br><span class="line"><span class="built_in">sudo</span> journalctl -u nginx.service</span><br><span class="line"><span class="built_in">sudo</span> journalctl -u docker.service</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 创建脚本文件</span><br><span class="line">sudo vim /usr/local/bin/cleanup_temp.sh</span><br><span class="line"></span><br><span class="line">### 添加以下内容：</span><br><span class="line">#!/bin/bash</span><br><span class="line"># 清理临时文件脚本</span><br><span class="line"></span><br><span class="line">echo &quot;$(date): 开始清理临时文件&quot; &gt;&gt; /var/log/cleanup.log</span><br><span class="line"></span><br><span class="line"># 清理 /tmp 目录（保留最近7天的文件）</span><br><span class="line">find /tmp -type f -atime +7 -delete 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"># 清理用户缓存</span><br><span class="line">find /home -type f -name &quot;*.tmp&quot; -atime +30 -delete 2&gt;/dev/null</span><br><span class="line">find /home -type f -name &quot;*.log&quot; -atime +30 -delete 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"># 清理包管理器缓存</span><br><span class="line"># apt-get clean</span><br><span class="line"></span><br><span class="line"># 清理系统日志（保留最近30天）</span><br><span class="line">find /var/log -name &quot;*.log&quot; -type f -mtime +30 -delete</span><br><span class="line"></span><br><span class="line">echo &quot;$(date): 临时文件清理完成&quot; &gt;&gt; /var/log/cleanup.log</span><br></pre></td></tr></table></figure><p><strong>给脚本执行权限</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /usr/local/bin/cleanup_temp.sh</span><br></pre></td></tr></table></figure><p><strong>设置定时任务（cron）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑root的crontab（推荐用于系统任务）</span></span><br><span class="line"><span class="built_in">sudo</span> crontab -e</span><br></pre></td></tr></table></figure><p><strong>添加定时任务</strong></p><p>在crontab文件中添加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每天凌晨3点执行清理脚本</span></span><br><span class="line">0 3 * * * /usr/local/bin/cleanup_temp.sh</span><br></pre></td></tr></table></figure><p><strong>验证定时任务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前用户的定时任务</span></span><br><span class="line">crontab -l</span><br><span class="line"><span class="comment"># 查看root的定时任务</span></span><br><span class="line"><span class="built_in">sudo</span> crontab -l</span><br><span class="line"><span class="comment"># 查看cron执行日志（Ubuntu）</span></span><br><span class="line"><span class="built_in">sudo</span> grep CRON /var/log/syslog</span><br><span class="line"><span class="comment"># 或者查看脚本自己的日志</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tail</span> -f /var/log/cleanup.log</span><br></pre></td></tr></table></figure></li><li><h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><ul><li>查看网络接口信息</li><li>测试到8.8.8.8的网络连通性</li><li>使用netstat查看监听端口</li><li>配置UFW防火墙，开放80和443端口</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看网络接口信息</span></span><br><span class="line">ip a 或者 ip addr</span><br><span class="line"><span class="comment"># 测试到8.8.8.8的网络连通性</span></span><br><span class="line">ping -c 4 8.8.8.8</span><br><span class="line"><span class="comment"># 使用netstat查看监听端口</span></span><br><span class="line"><span class="built_in">sudo</span> netstat -tulpn</span><br><span class="line"><span class="comment"># 配置UFW防火墙，开放80和443端口</span></span><br><span class="line"><span class="built_in">sudo</span> ufw allow 80/tcp</span><br><span class="line"><span class="built_in">sudo</span> ufw allow 443/tcp</span><br></pre></td></tr></table></figure></li><li><h3 id="磁盘管理"><a href="#磁盘管理" class="headerlink" title="磁盘管理"></a>磁盘管理</h3><ul><li>检查磁盘使用情况</li><li>查找大于100MB的文件</li><li>创建一个2GB的交换文件并启用</li><li>设置磁盘空间监控告警</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查磁盘使用情况</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"><span class="comment"># 查找大于100MB的文件</span></span><br><span class="line"><span class="built_in">sudo</span> find / -<span class="built_in">type</span> f -size +100M -<span class="built_in">printf</span> <span class="string">&quot;%s %p\n&quot;</span> 2&gt;/dev/null | <span class="built_in">sort</span> -nr</span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">find / 从根目录开始查找文件</span></span><br><span class="line"><span class="string">-type f 只查找普通文件（排除目录、设备文件等）</span></span><br><span class="line"><span class="string">-size +100M 查找大小超过100MB的文件</span></span><br><span class="line"><span class="string">-printf &quot;</span>%s %p\n<span class="string">&quot; 自定义输出格式： %s: 文件大小（字节） %p: 完整文件路径 \n: 换行符</span></span><br><span class="line"><span class="string">2&gt;/dev/null 将错误信息（如权限拒绝）重定向到空设备，不显示错误</span></span><br><span class="line"><span class="string">| sort -nr sort -n: 按数值排序 -r: 反向排序（从大到小）</span></span><br><span class="line"><span class="string">&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">### 创建一个2GB的交换文件并启用</span><br><span class="line">1. 创建交换文件</span><br><span class="line"># 检查当前交换空间</span><br><span class="line">free -h</span><br><span class="line">swapon --show</span><br><span class="line"># 创建2GB的交换文件（bs=1M count=2048 或 bs=1G count =2）</span><br><span class="line">sudo dd if=/dev/zero of=/swapfile bs=1M count=2048</span><br><span class="line">2. 设置权限</span><br><span class="line">sudo chmod 600 /swapfile</span><br><span class="line">3. 格式化为交换空间</span><br><span class="line">sudo mkswap /swapfile</span><br><span class="line">4. 启用交换文件</span><br><span class="line">sudo swapon /swapfile</span><br><span class="line"># 验证交换文件已启用</span><br><span class="line">free -h</span><br><span class="line">swapon --show</span><br><span class="line">5. 永久生效（重启后仍然有效）</span><br><span class="line"># 备份fstab文件</span><br><span class="line">sudo cp /etc/fstab /etc/fstab.bak</span><br><span class="line"># 将交换文件添加到fstab</span><br><span class="line">echo &#x27;/swapfile none swap sw 0 0&#x27; | sudo tee -a /etc/fstab</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#### 设置磁盘空间监控告警</span><br><span class="line">### 使用Shell脚本 + Cron</span><br><span class="line">1. 创建监控脚本</span><br><span class="line"># 创建脚本目录</span><br><span class="line">sudo mkdir -p /usr/local/scripts</span><br><span class="line">sudo vim /usr/local/scripts/disk_alert.sh</span><br><span class="line">2.脚本内容</span><br><span class="line">#!/bin/bash</span><br><span class="line"># 磁盘空间监控告警脚本</span><br><span class="line"></span><br><span class="line"># 配置参数</span><br><span class="line">THRESHOLD=90        # 警告阈值（百分比）</span><br><span class="line">EMAIL=&quot;&quot;  # 接收告警的邮箱</span><br><span class="line">LOG_FILE=&quot;/var/log/disk_alert.log&quot;</span><br><span class="line"></span><br><span class="line"># 获取磁盘使用率</span><br><span class="line">DISK_USAGE=$(df / | awk &#x27;NR==2 &#123;print $5&#125;&#x27; | sed &#x27;s/%//&#x27;)</span><br><span class="line"></span><br><span class="line"># 获取主机名</span><br><span class="line">HOSTNAME=$(hostname)</span><br><span class="line"></span><br><span class="line"># 记录日志</span><br><span class="line">echo &quot;$(date): 检查磁盘使用率 - $&#123;DISK_USAGE&#125;%&quot; &gt;&gt; $LOG_FILE</span><br><span class="line"></span><br><span class="line"># 检查是否超过阈值</span><br><span class="line">if [ $DISK_USAGE -gt $THRESHOLD ]; then</span><br><span class="line">    # 记录告警</span><br><span class="line">    echo &quot;$(date): 警告！磁盘使用率 $&#123;DISK_USAGE&#125;% 超过阈值 $&#123;THRESHOLD&#125;%&quot; &gt;&gt; $LOG_FILE</span><br><span class="line">    </span><br><span class="line">    # 发送邮件告警（需要配置邮件系统）</span><br><span class="line">    echo &quot;警告：服务器 $HOSTNAME 的根分区磁盘使用率已达到 $&#123;DISK_USAGE&#125;%，请及时清理！&quot; | \</span><br><span class="line">    mail -s &quot;磁盘空间告警 - $HOSTNAME&quot; $EMAIL</span><br><span class="line">    </span><br><span class="line">    # 发送到系统日志</span><br><span class="line">    logger -t disk_alert &quot;磁盘使用率 $&#123;DISK_USAGE&#125;% 超过阈值&quot;</span><br><span class="line">fi</span><br><span class="line">3. 设置脚本权限和定时任务</span><br><span class="line"># 给脚本执行权限</span><br><span class="line">sudo chmod +x /usr/local/scripts/disk_alert.sh</span><br><span class="line"># 添加到cron，每30分钟检查一次</span><br><span class="line">sudo crontab -e</span><br><span class="line"># 添加以下行：</span><br><span class="line">*/30 * * * * /usr/local/scripts/disk_alert.sh</span><br></pre></td></tr></table></figure></li></ol><h2 id="Shell脚本编写练习"><a href="#Shell脚本编写练习" class="headerlink" title="Shell脚本编写练习"></a>Shell脚本编写练习</h2><p><strong>脚本练习</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"># SHELL脚本知识点</span><br><span class="line">1. cut</span><br><span class="line">用途: 按列或定界符提取文本内容</span><br><span class="line">简单、速度快、但功能有限。适合固定分隔符的文本。</span><br><span class="line">基本语法: cut -d &quot;&lt;分隔符&gt;&quot; -f &lt;列号&gt;</span><br><span class="line">-d 指定字段分隔符（默认是TAB）</span><br><span class="line">-f 指定输出第几列，可以用逗号指定多列，比如-f1,3</span><br><span class="line"># 假设输出 df -h | head -2</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda1        50G   20G   28G  42% /</span><br><span class="line"></span><br><span class="line"># 取第二列（Size）</span><br><span class="line">df -h | head -2 | tail -1 | cut -d&#x27; &#x27; -f2</span><br><span class="line">空格不规则时，cut 不好用，因为它只按固定分隔符。</span><br><span class="line"></span><br><span class="line">2. awk</span><br><span class="line">用途: 按列、按模式提取和处理文本</span><br><span class="line">比cut强大， 可以做条件判断、计算、格式化输出</span><br><span class="line">默认以空格或TAB分列。</span><br><span class="line">基本语法: awk &#x27;/匹配模式/ &#123;print $列号&#125;&#x27;</span><br><span class="line">free -h | awk &#x27;/Mem:/ &#123;print $2&#125;&#x27;</span><br><span class="line">/Mem:/ → 匹配包含 Mem: 的行</span><br><span class="line">&#123;print $2&#125; → 输出第二列</span><br><span class="line"></span><br><span class="line">df -h | awk &#x27;$6==&quot;/&quot; &#123;print $4&#125;&#x27;</span><br><span class="line">$6 是挂载点列，$6==&quot;/&quot; → 找根分区</span><br><span class="line">&#123;print $4&#125; → 输出第四列（Avail）</span><br><span class="line"></span><br><span class="line">echo -e &quot;1\n2\n3&quot; | awk &#x27;&#123;sum+=$1&#125; END &#123;print sum&#125;&#x27;</span><br><span class="line">awk 列号 $1, $2, ...</span><br><span class="line">也可以用 $0 表示整行</span><br><span class="line"></span><br><span class="line">3. sed</span><br><span class="line">用途: 流编辑器，用于替换、删除、插入、提取行等。</span><br><span class="line">功能强大，常用于批量修改文本。</span><br><span class="line">基本语法:</span><br><span class="line">sed &#x27;命令&#x27; 文件</span><br><span class="line">常用命令:</span><br><span class="line">1. 替换</span><br><span class="line">echo &quot;hello world&quot; | sed &#x27;s/world/shell/&#x27;</span><br><span class="line"># 输出: hello shell</span><br><span class="line">2. 删除行</span><br><span class="line"># 删除第1行</span><br><span class="line">sed &#x27;1d&#x27; file.txt</span><br><span class="line">3. 打印匹配行</span><br><span class="line"># 打印包含 &quot;Mem:&quot; 的行</span><br><span class="line">free -h | sed -n &#x27;/Mem:/p&#x27;</span><br><span class="line">4. 删除多余空格</span><br><span class="line">echo &quot;   hello   world  &quot; | sed &#x27;s/^ *//;s/ *$//;s/  */ /g&#x27;</span><br><span class="line"># 输出: hello world</span><br></pre></td></tr></table></figure><ol><li><h3 id="系统信息收集脚本"><a href="#系统信息收集脚本" class="headerlink" title="系统信息收集脚本"></a>系统信息收集脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编写脚本收集：系统版本、内存使用、磁盘空间、登录用户等</span></span><br><span class="line"><span class="comment"># 输出格式化的报告到文件</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统信息收集脚本</span></span><br><span class="line"><span class="comment"># 作者:ccxx</span></span><br><span class="line"><span class="comment"># 日期: $(date)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义颜色（可选， 用于终端显示）</span></span><br><span class="line">RED=<span class="string">&#x27;\033[0;31m&#x27;</span></span><br><span class="line">GREEN=<span class="string">&#x27;\033[0;32m&#x27;</span></span><br><span class="line">YELLOW=<span class="string">&#x27;\033[1;33m&#x27;</span></span><br><span class="line">NC=<span class="string">&#x27;\033[0m&#x27;</span>  <span class="comment"># 没有颜色</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义输出文件</span></span><br><span class="line">REPORT_FILE=<span class="string">&quot;system_report_<span class="subst">$(date +%Y%m%d_%H%M%S)</span>.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数： 添加章节标题</span></span><br><span class="line"><span class="function"><span class="title">add_section</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;=== <span class="variable">$1</span> ===&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;--------------------------------&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成报告头</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;===============================&quot;</span> &gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;			系统信息报告&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;===============================&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;生成时间: <span class="subst">$(date)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;主机名: <span class="subst">$(hostname)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;===============================&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统信息</span></span><br><span class="line">add_section <span class="string">&quot;系统版本信息&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;操作系统: &quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/os-release ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">source</span> /etc/os-release</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot; - 名称: <span class="variable">$NAME</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot; - 版本: <span class="variable">$VERSION</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot; - ID: <span class="variable">$ID</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;内核版本: <span class="subst">$(uname -r)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统架构: <span class="subst">$(uname -m)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 内存信息</span></span><br><span class="line">add_section <span class="string">&quot;内存使用情况&quot;</span></span><br><span class="line">free -h | sed <span class="string">&#x27;s/^ *//&#x27;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 磁盘信息</span></span><br><span class="line">add_section <span class="string">&quot;磁盘空间信息&quot;</span></span><br><span class="line"><span class="built_in">df</span> -h | sed <span class="string">&#x27;s/^ *//&#x27;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户信息</span></span><br><span class="line">add_section <span class="string">&quot;登录用户信息&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前用户数: <span class="subst">$(who | wc -l)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">who</span> | sed <span class="string">&#x27;s/^ *//&#x27;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统负载</span></span><br><span class="line">add_section <span class="string">&quot;系统负载信息&quot;</span></span><br><span class="line"><span class="built_in">uptime</span> | sed <span class="string">&#x27;s/^ *//&#x27;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU信息</span></span><br><span class="line">add_section <span class="string">&quot;CPU信息&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;CPU型号: <span class="subst">$(grep <span class="string">&quot;model name&quot;</span> /proc/cpuinfo | head -1 | cut -d: -f2 | sed &#x27;s/^*//&#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==================================&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;报告生成完成: <span class="variable">$REPORT_FILE</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在终端显示成功信息</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;GREEN&#125;</span>系统信息报告已生成： <span class="variable">$&#123;YELLOW&#125;</span>$REPORT_FILE<span class="variable">$&#123;NC&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;GREEN&#125;</span>报告内容预览：<span class="variable">$&#123;NC&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==================================&quot;</span></span><br><span class="line"><span class="built_in">head</span> -20 <span class="variable">$REPORT_FILE</span></span><br></pre></td></tr></table></figure></li><li><h3 id="日志分析脚本"><a href="#日志分析脚本" class="headerlink" title="日志分析脚本"></a>日志分析脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分析/var/log/syslog，统计ERROR和WARNING出现次数</span></span><br><span class="line"><span class="comment"># 提取包含特定关键词的日志行</span></span><br><span class="line"><span class="comment"># 生成每日报告</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志分析脚本</span></span><br><span class="line"><span class="comment"># 功能：分析syslog，统计错误和警告，提取关键词，生成报告</span></span><br><span class="line"></span><br><span class="line">LOG_FILE=<span class="string">&quot;/var/log/syslog&quot;</span></span><br><span class="line">REPORT_DIR=<span class="string">&quot;/var/log/reports&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%Y-%m-%d)</span><br><span class="line">REPORT_FILE=<span class="string">&quot;<span class="variable">$REPORT_DIR</span>/syslog_report_<span class="variable">$DATE</span>.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建报告目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$REPORT_DIR</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查日志文件是否存在</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;错误: 日志文件 <span class="variable">$LOG_FILE</span> 不存在!&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成报告头部</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== 系统日志分析报告 (<span class="variable">$DATE</span>) ===&quot;</span> &gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;生成时间: <span class="subst">$(date)</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;日志文件: <span class="variable">$LOG_FILE</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;======================================&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 统计ERROR和WARNING出现次数</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1. 错误和警告统计:&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line">ERROR_COUNT=$(grep -i <span class="string">&quot;ERROR&quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">WARNING_COUNT=$(grep -i <span class="string">&quot;WARNING&quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ERROR 出现次数: <span class="variable">$ERROR_COUNT</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;WARNING 出现次数: <span class="variable">$WARNING_COUNT</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 提取包含特定关键词的日志行</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2. 关键词相关日志:&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义要搜索的关键词数组</span></span><br><span class="line">KEYWORDS=(<span class="string">&quot;fail&quot;</span> <span class="string">&quot;failed&quot;</span> <span class="string">&quot;critical&quot;</span> <span class="string">&quot;timeout&quot;</span> <span class="string">&quot;denied&quot;</span> <span class="string">&quot;refused&quot;</span> <span class="string">&quot;crash&quot;</span> <span class="string">&quot;exception&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> keyword <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;KEYWORDS[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    count=$(grep -i <span class="string">&quot;<span class="variable">$keyword</span>&quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$count</span> -gt 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;关键词 &#x27;<span class="variable">$keyword</span>&#x27; 出现次数: <span class="variable">$count</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 显示最近的ERROR和WARNING日志</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;3. 最近的ERROR日志 (最近10条):&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------------&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line">grep -i <span class="string">&quot;ERROR&quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | <span class="built_in">tail</span> -10 &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;4. 最近的WARNING日志 (最近10条):&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------------------------------&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line">grep -i <span class="string">&quot;WARNING&quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | <span class="built_in">tail</span> -10 &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 按服务/进程统计</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;5. 按进程统计ERROR和WARNING:&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;----------------------------&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;进程名 | ERROR数 | WARNING数&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------|---------|----------&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取所有包含ERROR或WARNING的进程</span></span><br><span class="line">grep -E -i <span class="string">&quot;ERROR|WARNING&quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | awk <span class="string">&#x27;&#123;print $5&#125;&#x27;</span> | sed <span class="string">&#x27;s/\[\|\]\|://g&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> | <span class="keyword">while</span> <span class="built_in">read</span> process; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$process</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        error_count=$(grep -i <span class="string">&quot;ERROR&quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | grep <span class="string">&quot;<span class="variable">$process</span>&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">        warning_count=$(grep -i <span class="string">&quot;WARNING&quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | grep <span class="string">&quot;<span class="variable">$process</span>&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$error_count</span> -gt 0 ] || [ <span class="variable">$warning_count</span> -gt 0 ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">printf</span> <span class="string">&quot;%-15s | %8d | %9d\n&quot;</span> <span class="string">&quot;<span class="variable">$process</span>&quot;</span> <span class="string">&quot;<span class="variable">$error_count</span>&quot;</span> <span class="string">&quot;<span class="variable">$warning_count</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;报告生成完成: <span class="variable">$REPORT_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示报告摘要</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== 报告摘要 ===&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ERROR总数: <span class="variable">$ERROR_COUNT</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;WARNING总数: <span class="variable">$WARNING_COUNT</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;详细报告: <span class="variable">$REPORT_FILE</span>&quot;</span></span><br></pre></td></tr></table></figure></li><li><h3 id="备份脚本"><a href="#备份脚本" class="headerlink" title="备份脚本"></a>备份脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建目录备份脚本，支持：</span></span><br><span class="line"><span class="comment"># - 增量备份</span></span><br><span class="line"><span class="comment"># - 保留最近7天的备份</span></span><br><span class="line"><span class="comment"># - 备份完成后发送邮件通知</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 目录备份脚本</span></span><br><span class="line"><span class="comment"># 功能：增量备份、保留最近7天备份、邮件通知</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置区域 - 根据实际环境修改这些变量</span></span><br><span class="line">SOURCE_DIR=<span class="string">&quot;/path/to/source&quot;</span>          <span class="comment"># 要备份的源目录</span></span><br><span class="line">BACKUP_BASE=<span class="string">&quot;/path/to/backups&quot;</span>        <span class="comment"># 备份存储基目录</span></span><br><span class="line">BACKUP_NAME=<span class="string">&quot;daily_backup&quot;</span>            <span class="comment"># 备份名称前缀</span></span><br><span class="line">RETENTION_DAYS=7                      <span class="comment"># 保留天数</span></span><br><span class="line">LOG_FILE=<span class="string">&quot;/var/log/backup.log&quot;</span>        <span class="comment"># 日志文件路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 邮件通知配置</span></span><br><span class="line">EMAIL_RECIPIENT=<span class="string">&quot;admin@example.com&quot;</span>   <span class="comment"># 收件人邮箱</span></span><br><span class="line">EMAIL_SUBJECT=<span class="string">&quot;备份完成通知&quot;</span>          <span class="comment"># 邮件主题</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建时间戳</span></span><br><span class="line">TIMESTAMP=$(<span class="built_in">date</span> +%Y%m%d_%H%M%S)</span><br><span class="line">TODAY=$(<span class="built_in">date</span> +%Y%m%d)</span><br><span class="line">BACKUP_DIR=<span class="string">&quot;<span class="variable">$&#123;BACKUP_BASE&#125;</span>/<span class="variable">$&#123;BACKUP_NAME&#125;</span>_<span class="variable">$&#123;TODAY&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志函数</span></span><br><span class="line"><span class="function"><span class="title">log</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[<span class="subst">$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)</span>] <span class="variable">$1</span>&quot;</span> | <span class="built_in">tee</span> -a <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误处理函数</span></span><br><span class="line"><span class="function"><span class="title">error_exit</span></span>() &#123;</span><br><span class="line">    <span class="built_in">log</span> <span class="string">&quot;错误: <span class="variable">$1</span>&quot;</span></span><br><span class="line">    send_notification <span class="string">&quot;失败&quot;</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送邮件通知函数</span></span><br><span class="line"><span class="function"><span class="title">send_notification</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> status=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="built_in">local</span> message=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">cat</span> &lt;&lt; <span class="string">EOF | mail -s &quot;$&#123;EMAIL_SUBJECT&#125; - $&#123;status&#125;&quot; &quot;$EMAIL_RECIPIENT&quot;</span></span><br><span class="line"><span class="string">备份任务执行完成</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">状态: $&#123;status&#125;</span></span><br><span class="line"><span class="string">时间: $(date)</span></span><br><span class="line"><span class="string">源目录: $&#123;SOURCE_DIR&#125;</span></span><br><span class="line"><span class="string">备份目录: $&#123;BACKUP_DIR&#125;</span></span><br><span class="line"><span class="string">备份时间: $&#123;TIMESTAMP&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">详细信息:</span></span><br><span class="line"><span class="string">$&#123;message&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">日志文件: $&#123;LOG_FILE&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="built_in">log</span> <span class="string">&quot;邮件通知已发送至: <span class="variable">$&#123;EMAIL_RECIPIENT&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查依赖</span></span><br><span class="line"><span class="function"><span class="title">check_dependencies</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> deps=(<span class="string">&quot;rsync&quot;</span> <span class="string">&quot;mail&quot;</span> <span class="string">&quot;find&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> dep <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;deps[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> ! <span class="built_in">command</span> -v <span class="string">&quot;<span class="variable">$dep</span>&quot;</span> &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">            error_exit <span class="string">&quot;缺少必要工具: <span class="variable">$dep</span>&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查目录是否存在</span></span><br><span class="line"><span class="function"><span class="title">check_directories</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$SOURCE_DIR</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        error_exit <span class="string">&quot;源目录不存在: <span class="variable">$SOURCE_DIR</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$BACKUP_BASE</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">log</span> <span class="string">&quot;创建备份基目录: <span class="variable">$BACKUP_BASE</span>&quot;</span></span><br><span class="line">        <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_BASE</span>&quot;</span> || error_exit <span class="string">&quot;无法创建备份基目录&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找最新的完整备份（用于增量备份参考）</span></span><br><span class="line"><span class="function"><span class="title">find_latest_backup</span></span>() &#123;</span><br><span class="line">    find <span class="string">&quot;<span class="variable">$BACKUP_BASE</span>&quot;</span> -maxdepth 1 -<span class="built_in">type</span> d -name <span class="string">&quot;<span class="variable">$&#123;BACKUP_NAME&#125;</span>_*&quot;</span> | grep -v <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> | <span class="built_in">sort</span> | <span class="built_in">tail</span> -n 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行备份</span></span><br><span class="line"><span class="function"><span class="title">perform_backup</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> latest_backup=$(find_latest_backup)</span><br><span class="line">    <span class="built_in">local</span> link_dest=<span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$latest_backup</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        link_dest=<span class="string">&quot;--link-dest=<span class="variable">$latest_backup</span>&quot;</span></span><br><span class="line">        <span class="built_in">log</span> <span class="string">&quot;执行增量备份，参考备份: <span class="variable">$latest_backup</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">log</span> <span class="string">&quot;执行首次完整备份&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建备份目录</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> || error_exit <span class="string">&quot;无法创建备份目录&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用rsync进行增量备份</span></span><br><span class="line">    <span class="built_in">log</span> <span class="string">&quot;开始备份...&quot;</span></span><br><span class="line">    rsync -avh --delete <span class="variable">$link_dest</span> <span class="string">&quot;<span class="variable">$SOURCE_DIR</span>/&quot;</span> <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>/&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> 2&gt;&amp;1</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">log</span> <span class="string">&quot;备份完成: <span class="variable">$BACKUP_DIR</span>&quot;</span></span><br><span class="line">        <span class="comment"># 创建备份完成标记文件</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;备份时间: <span class="variable">$TIMESTAMP</span>&quot;</span> &gt; <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>/backup.info&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;备份类型: <span class="subst">$([ -n <span class="string">&quot;<span class="variable">$link_dest</span>&quot;</span> ] &amp;&amp; echo <span class="string">&quot;增量&quot;</span> || echo <span class="string">&quot;完整&quot;</span>)</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>/backup.info&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;源目录: <span class="variable">$SOURCE_DIR</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>/backup.info&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        error_exit <span class="string">&quot;备份过程中出现错误&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理旧备份</span></span><br><span class="line"><span class="function"><span class="title">cleanup_old_backups</span></span>() &#123;</span><br><span class="line">    <span class="built_in">log</span> <span class="string">&quot;清理超过 <span class="variable">$&#123;RETENTION_DAYS&#125;</span> 天的旧备份...&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 查找并删除旧备份</span></span><br><span class="line">    find <span class="string">&quot;<span class="variable">$BACKUP_BASE</span>&quot;</span> -maxdepth 1 -<span class="built_in">type</span> d -name <span class="string">&quot;<span class="variable">$&#123;BACKUP_NAME&#125;</span>_*&quot;</span> -mtime +<span class="variable">$RETENTION_DAYS</span> | <span class="keyword">while</span> <span class="built_in">read</span> -r old_backup; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$old_backup</span>&quot;</span> ] &amp;&amp; [ <span class="string">&quot;<span class="variable">$old_backup</span>&quot;</span> != <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">log</span> <span class="string">&quot;删除旧备份: <span class="variable">$old_backup</span>&quot;</span></span><br><span class="line">            <span class="built_in">rm</span> -rf <span class="string">&quot;<span class="variable">$old_backup</span>&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">log</span> <span class="string">&quot;旧备份清理完成&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成备份报告</span></span><br><span class="line"><span class="function"><span class="title">generate_report</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> backup_size=$(<span class="built_in">du</span> -sh <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> 2&gt;/dev/null | <span class="built_in">cut</span> -f1)</span><br><span class="line">    <span class="built_in">local</span> total_backups=$(find <span class="string">&quot;<span class="variable">$BACKUP_BASE</span>&quot;</span> -maxdepth 1 -<span class="built_in">type</span> d -name <span class="string">&quot;<span class="variable">$&#123;BACKUP_NAME&#125;</span>_*&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">cat</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">=== 备份报告 ===</span></span><br><span class="line"><span class="string">备份状态: 成功</span></span><br><span class="line"><span class="string">备份时间: $(date)</span></span><br><span class="line"><span class="string">源目录: $SOURCE_DIR</span></span><br><span class="line"><span class="string">目标目录: $BACKUP_DIR</span></span><br><span class="line"><span class="string">备份大小: $backup_size</span></span><br><span class="line"><span class="string">备份类型: $([ -n &quot;$(find_latest_backup)&quot; ] &amp;&amp; echo &quot;增量&quot; || echo &quot;完整&quot;)</span></span><br><span class="line"><span class="string">保留策略: $&#123;RETENTION_DAYS&#125; 天</span></span><br><span class="line"><span class="string">当前备份数量: $total_backups</span></span><br><span class="line"><span class="string">磁盘使用情况:</span></span><br><span class="line"><span class="string">$(df -h &quot;$BACKUP_BASE&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主函数</span></span><br><span class="line"><span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="built_in">log</span> <span class="string">&quot;=== 开始备份任务 ===&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查依赖</span></span><br><span class="line">    check_dependencies</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查目录</span></span><br><span class="line">    check_directories</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 执行备份</span></span><br><span class="line">    perform_backup</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 清理旧备份</span></span><br><span class="line">    cleanup_old_backups</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 生成报告并发送通知</span></span><br><span class="line">    <span class="built_in">local</span> report=$(generate_report)</span><br><span class="line">    <span class="built_in">log</span> <span class="string">&quot;<span class="variable">$report</span>&quot;</span></span><br><span class="line">    send_notification <span class="string">&quot;成功&quot;</span> <span class="string">&quot;<span class="variable">$report</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">log</span> <span class="string">&quot;=== 备份任务完成 ===&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本入口</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># 无参数时执行备份</span></span><br><span class="line">    main</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;--cleanup-only&quot;</span>)</span><br><span class="line">            <span class="comment"># 仅执行清理</span></span><br><span class="line">            check_dependencies</span><br><span class="line">            check_directories</span><br><span class="line">            cleanup_old_backups</span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;--report&quot;</span>)</span><br><span class="line">            <span class="comment"># 生成报告</span></span><br><span class="line">            generate_report</span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;--help&quot;</span>)</span><br><span class="line">            <span class="comment"># 显示帮助</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;用法: <span class="variable">$0</span> [选项]&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;选项:&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;  无参数    执行完整备份流程&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;  --cleanup-only  仅清理旧备份&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;  --report        生成备份报告&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;  --help         显示此帮助信息&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;未知参数: <span class="variable">$1</span>&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;使用 --help 查看使用方法&quot;</span></span><br><span class="line">            <span class="built_in">exit</span> 1</span><br><span class="line">            ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li><li><h3 id="用户管理脚本"><a href="#用户管理脚本" class="headerlink" title="用户管理脚本"></a>用户管理脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 批量创建用户，从CSV文件读取用户名和密码</span></span><br><span class="line"><span class="comment"># 设置用户配额</span></span><br><span class="line"><span class="comment"># 生成创建报告</span></span><br></pre></td></tr></table></figure></li><li><h3 id="服务监控脚本"><a href="#服务监控脚本" class="headerlink" title="服务监控脚本"></a>服务监控脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 监控指定服务（如nginx、mysql）状态</span></span><br><span class="line"><span class="comment"># 如果服务停止，自动重启并发送告警</span></span><br><span class="line"><span class="comment"># 记录监控日志</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="Python脚本编写练习"><a href="#Python脚本编写练习" class="headerlink" title="Python脚本编写练习"></a>Python脚本编写练习</h2><p><strong>Python练习</strong></p><ol><li><h3 id="系统信息收集工具"><a href="#系统信息收集工具" class="headerlink" title="系统信息收集工具"></a>系统信息收集工具</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用psutil库收集系统信息</span></span><br><span class="line"><span class="comment"># 输出CPU、内存、磁盘、网络使用情况</span></span><br><span class="line"><span class="comment"># 生成HTML格式报告</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import psutil</span><br><span class="line">import datetime</span><br><span class="line">from jinja2 import Template</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ================================</span></span><br><span class="line"><span class="comment"># 数据采集层：所有采集函数统一封装</span></span><br><span class="line"><span class="comment"># ================================</span></span><br><span class="line"></span><br><span class="line">class Collector:</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def cpu():</span><br><span class="line">        freq = psutil.cpu_freq()</span><br><span class="line">        <span class="built_in">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;physical&quot;</span>: psutil.cpu_count(logical=False),</span><br><span class="line">            <span class="string">&quot;logical&quot;</span>: psutil.cpu_count(logical=True),</span><br><span class="line">            <span class="string">&quot;frequency&quot;</span>: freq.current <span class="keyword">if</span> freq <span class="keyword">else</span> 0,</span><br><span class="line">            <span class="string">&quot;usage&quot;</span>: psutil.cpu_percent(interval=1),</span><br><span class="line">            <span class="string">&quot;per_cpu&quot;</span>: psutil.cpu_percent(interval=1, percpu=True),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def memory():</span><br><span class="line">        mem = psutil.virtual_memory()</span><br><span class="line">        swap = psutil.swap_memory()</span><br><span class="line">        gb = 1024**3</span><br><span class="line">        <span class="built_in">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;total&quot;</span>: round(mem.total / gb, 2),</span><br><span class="line">            <span class="string">&quot;used&quot;</span>: round(mem.used / gb, 2),</span><br><span class="line">            <span class="string">&quot;available&quot;</span>: round(mem.available / gb, 2),</span><br><span class="line">            <span class="string">&quot;percent&quot;</span>: mem.percent,</span><br><span class="line">            <span class="string">&quot;swap_total&quot;</span>: round(swap.total / gb, 2),</span><br><span class="line">            <span class="string">&quot;swap_used&quot;</span>: round(swap.used / gb, 2),</span><br><span class="line">            <span class="string">&quot;swap_percent&quot;</span>: swap.percent</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def disks():</span><br><span class="line">        gb = 1024**3</span><br><span class="line">        disks = []</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> psutil.disk_partitions():</span><br><span class="line">            try:</span><br><span class="line">                u = psutil.disk_usage(p.mountpoint)</span><br><span class="line">                disks.append(&#123;</span><br><span class="line">                    <span class="string">&quot;device&quot;</span>: p.device,</span><br><span class="line">                    <span class="string">&quot;mount&quot;</span>: p.mountpoint,</span><br><span class="line">                    <span class="string">&quot;fs&quot;</span>: p.fstype,</span><br><span class="line">                    <span class="string">&quot;total&quot;</span>: round(u.total / gb, 2),</span><br><span class="line">                    <span class="string">&quot;used&quot;</span>: round(u.used / gb, 2),</span><br><span class="line">                    <span class="string">&quot;free&quot;</span>: round(u.free / gb, 2),</span><br><span class="line">                    <span class="string">&quot;percent&quot;</span>: u.percent</span><br><span class="line">                &#125;)</span><br><span class="line">            except PermissionError:</span><br><span class="line">                <span class="built_in">continue</span></span><br><span class="line">        <span class="built_in">return</span> disks</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def network():</span><br><span class="line">        io = psutil.net_io_counters()</span><br><span class="line">        mb = 1024**2</span><br><span class="line">        <span class="built_in">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;sent_mb&quot;</span>: round(io.bytes_sent / mb, 2),</span><br><span class="line">            <span class="string">&quot;recv_mb&quot;</span>: round(io.bytes_recv / mb, 2),</span><br><span class="line">            <span class="string">&quot;sent_packets&quot;</span>: io.packets_sent,</span><br><span class="line">            <span class="string">&quot;recv_packets&quot;</span>: io.packets_recv,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def system():</span><br><span class="line">        boot = datetime.datetime.fromtimestamp(psutil.boot_time())</span><br><span class="line">        <span class="built_in">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;boot&quot;</span>: boot.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>),</span><br><span class="line">            <span class="string">&quot;uptime&quot;</span>: str(datetime.datetime.now() - boot).<span class="built_in">split</span>(<span class="string">&#x27;.&#x27;</span>)[0],</span><br><span class="line">            <span class="string">&quot;timestamp&quot;</span>: datetime.datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ================================</span></span><br><span class="line"><span class="comment"># HTML 模板层（高美观，可随时替换）</span></span><br><span class="line"><span class="comment"># ================================</span></span><br><span class="line"></span><br><span class="line">REPORT_TEMPLATE = r<span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;</span>zh-cn<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">&lt;meta charset=&quot;</span>UTF-8<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;系统监控报告&lt;/title&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;style&gt;</span></span><br><span class="line"><span class="string">body &#123;</span></span><br><span class="line"><span class="string">    font-family: &#x27;Segoe UI&#x27;, Arial;</span></span><br><span class="line"><span class="string">    margin: 0;</span></span><br><span class="line"><span class="string">    padding: 25px;</span></span><br><span class="line"><span class="string">    background: #f5f6fa;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.container &#123;</span></span><br><span class="line"><span class="string">    max-width: 1200px;</span></span><br><span class="line"><span class="string">    margin: auto;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">h1 &#123;</span></span><br><span class="line"><span class="string">    text-align: center;</span></span><br><span class="line"><span class="string">    padding: 25px;</span></span><br><span class="line"><span class="string">    background: linear-gradient(135deg, #6a11cb, #2575fc);</span></span><br><span class="line"><span class="string">    color: white;</span></span><br><span class="line"><span class="string">    border-radius: 12px;</span></span><br><span class="line"><span class="string">    box-shadow: 0 4px 12px rgba(0,0,0,.1);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.section &#123;</span></span><br><span class="line"><span class="string">    background: white;</span></span><br><span class="line"><span class="string">    padding: 20px;</span></span><br><span class="line"><span class="string">    border-radius: 12px;</span></span><br><span class="line"><span class="string">    margin-top: 25px;</span></span><br><span class="line"><span class="string">    box-shadow: 0 2px 8px rgba(0,0,0,0.06);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.section-title &#123;</span></span><br><span class="line"><span class="string">    border-left: 6px solid #6a11cb;</span></span><br><span class="line"><span class="string">    padding-left: 12px;</span></span><br><span class="line"><span class="string">    margin-bottom: 15px;</span></span><br><span class="line"><span class="string">    font-size: 1.4em;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.grid &#123;</span></span><br><span class="line"><span class="string">    display: grid;</span></span><br><span class="line"><span class="string">    grid-template-columns: repeat(auto-fit,minmax(260px,1fr));</span></span><br><span class="line"><span class="string">    gap: 18px;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.card &#123;</span></span><br><span class="line"><span class="string">    background: #fafbfc;</span></span><br><span class="line"><span class="string">    padding: 15px;</span></span><br><span class="line"><span class="string">    border-left: 5px solid #2575fc;</span></span><br><span class="line"><span class="string">    border-radius: 8px;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.label &#123; font-weight: bold; color: #555; &#125;</span></span><br><span class="line"><span class="string">.value &#123; margin-top: 6px; font-size: 1.2em; color: #333; &#125;</span></span><br><span class="line"><span class="string">.progress &#123;</span></span><br><span class="line"><span class="string">    height: 9px; background: #ddd; border-radius: 5px; margin-top: 8px;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.fill &#123;</span></span><br><span class="line"><span class="string">    height: 100%; border-radius: 5px;</span></span><br><span class="line"><span class="string">    background: linear-gradient(90deg,#6a11cb,#2575fc);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.warning &#123; color: #e84118; font-weight: bold; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">table &#123;</span></span><br><span class="line"><span class="string">    width: 100%; border-collapse: collapse;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">th, td &#123;</span></span><br><span class="line"><span class="string">    padding: 10px; border-bottom: 1px solid #eee;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">th &#123; background: #f0f0f5; &#125;</span></span><br><span class="line"><span class="string">tr:hover &#123; background: #f9f9f9; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">.footer &#123;</span></span><br><span class="line"><span class="string">    text-align: center;</span></span><br><span class="line"><span class="string">    margin-top: 25px;</span></span><br><span class="line"><span class="string">    color: #888;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&quot;</span>container<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;h1&gt;系统监控报告&lt;/h1&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;div class=&quot;</span>section<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>section-title<span class="string">&quot;&gt;系统信息&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>grid<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;启动时间&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; sys.boot &#125;&#125;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;系统已运行&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; sys.uptime &#125;&#125;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;生成时间&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; sys.timestamp &#125;&#125;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;div class=&quot;</span>section<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>section-title<span class="string">&quot;&gt;CPU 信息&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>grid<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;物理核心&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; cpu.physical &#125;&#125;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;逻辑核心&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; cpu.logical &#125;&#125;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;当前频率&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; cpu.frequency &#125;&#125; MHz&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;</span>label<span class="string">&quot;&gt;CPU 使用率&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;</span>value &#123;% <span class="keyword">if</span> cpu.usage &gt; 80 %&#125;warning&#123;% endif %&#125;<span class="string">&quot;&gt;&#123;&#123; cpu.usage &#125;&#125;%&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;</span>progress<span class="string">&quot;&gt;&lt;div class=&quot;</span>fill<span class="string">&quot; style=&quot;</span>width:&#123;&#123; cpu.usage &#125;&#125;%<span class="string">&quot;&gt;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;div class=&quot;</span>section<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>section-title<span class="string">&quot;&gt;内存信息&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>grid<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;总内存&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; mem.total &#125;&#125; GB&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;已使用&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; mem.used &#125;&#125; GB&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;可用&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; mem.available &#125;&#125; GB&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;</span>label<span class="string">&quot;&gt;使用率&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;</span>value &#123;% <span class="keyword">if</span> mem.percent &gt; 80 %&#125;warning&#123;% endif %&#125;<span class="string">&quot;&gt;&#123;&#123; mem.percent &#125;&#125;%&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;</span>progress<span class="string">&quot;&gt;&lt;div class=&quot;</span>fill<span class="string">&quot; style=&quot;</span>width:&#123;&#123; mem.percent &#125;&#125;%<span class="string">&quot;&gt;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>card<span class="string">&quot; style=&quot;</span>margin-top:20px;<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>label<span class="string">&quot;&gt;Swap 内存&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; mem.swap_used &#125;&#125; GB / &#123;&#123; mem.swap_total &#125;&#125; GB (&#123;&#123; mem.swap_percent &#125;&#125;%)&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>progress<span class="string">&quot;&gt;&lt;div class=&quot;</span>fill<span class="string">&quot; style=&quot;</span>width:&#123;&#123; mem.swap_percent &#125;&#125;%<span class="string">&quot;&gt;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;div class=&quot;</span>section<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>section-title<span class="string">&quot;&gt;磁盘信息&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;table&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;&lt;th&gt;设备&lt;/th&gt;&lt;th&gt;挂载点&lt;/th&gt;&lt;th&gt;文件系统&lt;/th&gt;&lt;th&gt;总(GB)&lt;/th&gt;&lt;th&gt;已使用&lt;/th&gt;&lt;th&gt;剩余&lt;/th&gt;&lt;th&gt;使用率&lt;/th&gt;&lt;/tr&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &#123;% for d in disks %&#125;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">            &lt;td&gt;&#123;&#123; d.device &#125;&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;td&gt;&#123;&#123; d.mount &#125;&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;td&gt;&#123;&#123; d.fs &#125;&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;td&gt;&#123;&#123; d.total &#125;&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;td&gt;&#123;&#123; d.used &#125;&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;td&gt;&#123;&#123; d.free &#125;&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;td &#123;% if d.percent &gt; 85 %&#125;class=&quot;</span>warning<span class="string">&quot;&#123;% endif %&#125;&gt;&#123;&#123; d.percent &#125;&#125;%&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &#123;% endfor %&#125;</span></span><br><span class="line"><span class="string">    &lt;/table&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;div class=&quot;</span>section<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>section-title<span class="string">&quot;&gt;网络信息&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;</span>grid<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;发送数据&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; net.sent_mb &#125;&#125; MB&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;接收数据&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; net.recv_mb &#125;&#125; MB&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;发送包&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; net.sent_packets &#125;&#125;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;</span>card<span class="string">&quot;&gt;&lt;div class=&quot;</span>label<span class="string">&quot;&gt;接收包&lt;/div&gt;&lt;div class=&quot;</span>value<span class="string">&quot;&gt;&#123;&#123; net.recv_packets &#125;&#125;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;div class=&quot;</span>footer<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">    系统监控报告已生成 | 提示：超过 80% 使用率将标记为警告</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ================================</span></span><br><span class="line"><span class="comment"># 生成报告</span></span><br><span class="line"><span class="comment"># ================================</span></span><br><span class="line"></span><br><span class="line">class Report:</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def generate(filename=<span class="string">&quot;system_report.html&quot;</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;cpu&quot;</span>: Collector.cpu(),</span><br><span class="line">            <span class="string">&quot;mem&quot;</span>: Collector.memory(),</span><br><span class="line">            <span class="string">&quot;disks&quot;</span>: Collector.disks(),</span><br><span class="line">            <span class="string">&quot;net&quot;</span>: Collector.network(),</span><br><span class="line">            <span class="string">&quot;sys&quot;</span>: Collector.system(),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        html = Template(REPORT_TEMPLATE).render(**data)</span><br><span class="line">        with open(filename, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) as f:</span><br><span class="line">            f.write(html)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> filename</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ================================</span></span><br><span class="line"><span class="comment"># 主程序入口</span></span><br><span class="line"><span class="comment"># ================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在生成报告…&quot;</span>)</span><br><span class="line">    output = Report.generate()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;生成完成:&quot;</span>, os.path.abspath(output))</span><br></pre></td></tr></table></figure></li><li><h3 id="日志文件解析器"><a href="#日志文件解析器" class="headerlink" title="日志文件解析器"></a>日志文件解析器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解析Apache/Nginx访问日志</span></span><br><span class="line"><span class="comment"># 统计：访问量最多的IP、最受欢迎的页面、错误状态码</span></span><br><span class="line"><span class="comment"># 可视化显示结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Iterator, <span class="type">Optional</span>, <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 数据结构：使用 dataclass 表示一条结构化日志</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogRecord</span>:</span><br><span class="line">    ip: <span class="built_in">str</span></span><br><span class="line">    timestamp: <span class="built_in">str</span></span><br><span class="line">    method: <span class="built_in">str</span></span><br><span class="line">    url: <span class="built_in">str</span></span><br><span class="line">    protocol: <span class="built_in">str</span></span><br><span class="line">    status: <span class="built_in">int</span></span><br><span class="line">    size: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 抽象日志格式解析器（策略模式）</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseLogFormat</span>(abc.ABC):</span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, line: <span class="built_in">str</span></span>) -&gt; <span class="type">Optional</span>[LogRecord]:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Three concrete log format implementations</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CombinedLogFormat</span>(<span class="title class_ inherited__">BaseLogFormat</span>):</span><br><span class="line">    _pattern = re.<span class="built_in">compile</span>(</span><br><span class="line">        <span class="string">r&#x27;(\S+) (\S+) (\S+) \[(.*?)\] &quot;(\S+) (\S+) (\S+)&quot; (\d+) (\d+) &quot;([^&quot;]*)&quot; &quot;([^&quot;]*)&quot;&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, line: <span class="built_in">str</span></span>) -&gt; <span class="type">Optional</span>[LogRecord]:</span><br><span class="line">        m = <span class="variable language_">self</span>._pattern.<span class="keyword">match</span>(line)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> m:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> LogRecord(</span><br><span class="line">                ip=m.group(<span class="number">1</span>),</span><br><span class="line">                timestamp=m.group(<span class="number">4</span>),</span><br><span class="line">                method=m.group(<span class="number">5</span>),</span><br><span class="line">                url=m.group(<span class="number">6</span>),</span><br><span class="line">                protocol=m.group(<span class="number">7</span>),</span><br><span class="line">                status=<span class="built_in">int</span>(m.group(<span class="number">8</span>)),</span><br><span class="line">                size=<span class="built_in">int</span>(m.group(<span class="number">9</span>)),</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">except</span> (IndexError, ValueError):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommonLogFormat</span>(<span class="title class_ inherited__">BaseLogFormat</span>):</span><br><span class="line">    _pattern = re.<span class="built_in">compile</span>(</span><br><span class="line">        <span class="string">r&#x27;(\S+) (\S+) (\S+) \[(.*?)\] &quot;(\S+) (\S+) (\S+)&quot; (\d+) (\d+)&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, line: <span class="built_in">str</span></span>) -&gt; <span class="type">Optional</span>[LogRecord]:</span><br><span class="line">        m = <span class="variable language_">self</span>._pattern.<span class="keyword">match</span>(line)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> m:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> LogRecord(</span><br><span class="line">                ip=m.group(<span class="number">1</span>),</span><br><span class="line">                timestamp=m.group(<span class="number">4</span>),</span><br><span class="line">                method=m.group(<span class="number">5</span>),</span><br><span class="line">                url=m.group(<span class="number">6</span>),</span><br><span class="line">                protocol=m.group(<span class="number">7</span>),</span><br><span class="line">                status=<span class="built_in">int</span>(m.group(<span class="number">8</span>)),</span><br><span class="line">                size=<span class="built_in">int</span>(m.group(<span class="number">9</span>)),</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NginxLogFormat</span>(<span class="title class_ inherited__">BaseLogFormat</span>):</span><br><span class="line">    _pattern = re.<span class="built_in">compile</span>(</span><br><span class="line">        <span class="string">r&#x27;(\S+) - (\S+) \[(.*?)\] &quot;(\S+) (\S+) (\S+)&quot; (\d+) (\d+) &quot;([^&quot;]*)&quot; &quot;([^&quot;]*)&quot;&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, line: <span class="built_in">str</span></span>) -&gt; <span class="type">Optional</span>[LogRecord]:</span><br><span class="line">        m = <span class="variable language_">self</span>._pattern.<span class="keyword">match</span>(line)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> m:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> LogRecord(</span><br><span class="line">                ip=m.group(<span class="number">1</span>),</span><br><span class="line">                timestamp=m.group(<span class="number">3</span>),</span><br><span class="line">                method=m.group(<span class="number">4</span>),</span><br><span class="line">                url=m.group(<span class="number">5</span>),</span><br><span class="line">                protocol=m.group(<span class="number">6</span>),</span><br><span class="line">                status=<span class="built_in">int</span>(m.group(<span class="number">7</span>)),</span><br><span class="line">                size=<span class="built_in">int</span>(m.group(<span class="number">8</span>)),</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 日志读取器：流式解析</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogReader</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, filepath: <span class="built_in">str</span>, fmt: BaseLogFormat</span>):</span><br><span class="line">        <span class="variable language_">self</span>.filepath = filepath</span><br><span class="line">        <span class="variable language_">self</span>.fmt = fmt</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">records</span>(<span class="params">self</span>) -&gt; Iterator[LogRecord]:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="variable language_">self</span>.filepath, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">                rec = <span class="variable language_">self</span>.fmt.parse(line.strip())</span><br><span class="line">                <span class="keyword">if</span> rec:</span><br><span class="line">                    <span class="keyword">yield</span> rec</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 统计器：插件式，可扩展</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogStatistics</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.total = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.ip = collections.Counter()</span><br><span class="line">        <span class="variable language_">self</span>.urls = collections.Counter()</span><br><span class="line">        <span class="variable language_">self</span>.status = collections.Counter()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">feed</span>(<span class="params">self, rec: LogRecord</span>):</span><br><span class="line">        <span class="variable language_">self</span>.total += <span class="number">1</span></span><br><span class="line">        <span class="variable language_">self</span>.ip[rec.ip] += <span class="number">1</span></span><br><span class="line">        <span class="variable language_">self</span>.urls[rec.url] += <span class="number">1</span></span><br><span class="line">        <span class="variable language_">self</span>.status[rec.status] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">errors</span>(<span class="params">self</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">return</span> &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="variable language_">self</span>.status.items() <span class="keyword">if</span> k &gt;= <span class="number">400</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 可视化模块：与统计模块完全解耦</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogVisualizer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, stats: LogStatistics</span>):</span><br><span class="line">        <span class="variable language_">self</span>.s = stats</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">draw</span>(<span class="params">self, save_path=<span class="literal">None</span></span>):</span><br><span class="line">        fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">2</span>, figsize=(<span class="number">14</span>, <span class="number">12</span>))</span><br><span class="line">        fig.suptitle(<span class="string">&quot;访问日志分析&quot;</span>, fontsize=<span class="number">16</span>, fontweight=<span class="string">&quot;bold&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>._bar_chart(axes[<span class="number">0</span>, <span class="number">0</span>], <span class="variable language_">self</span>.s.ip, <span class="string">&quot;访问最多的 IP&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>._bar_chart(axes[<span class="number">0</span>, <span class="number">1</span>], <span class="variable language_">self</span>.s.urls, <span class="string">&quot;最热门页面&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>._bar_chart(axes[<span class="number">1</span>, <span class="number">0</span>], <span class="variable language_">self</span>.s.status, <span class="string">&quot;HTTP 状态码分布&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>._bar_chart(axes[<span class="number">1</span>, <span class="number">1</span>], <span class="variable language_">self</span>.s.errors, <span class="string">&quot;错误状态码&quot;</span>)</span><br><span class="line"></span><br><span class="line">        plt.tight_layout()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> save_path:</span><br><span class="line">            plt.savefig(save_path, dpi=<span class="number">300</span>, bbox_inches=<span class="string">&quot;tight&quot;</span>)</span><br><span class="line">        plt.show()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_bar_chart</span>(<span class="params">self, ax, counter, title</span>):</span><br><span class="line">        items = counter.most_common(<span class="number">8</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> items:</span><br><span class="line">            ax.set_title(title)</span><br><span class="line">            ax.text(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="string">&#x27;无数据&#x27;</span>, ha=<span class="string">&#x27;center&#x27;</span>, va=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        labels, counts = <span class="built_in">zip</span>(*items)</span><br><span class="line">        ax.bar(labels, counts)</span><br><span class="line">        ax.set_title(title)</span><br><span class="line">        ax.tick_params(axis=<span class="string">&quot;x&quot;</span>, rotation=<span class="number">45</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CLI 主流程</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;高级日志分析器&quot;</span>)</span><br><span class="line"></span><br><span class="line">    parser.add_argument(<span class="string">&quot;file&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;日志文件&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-f&quot;</span>, <span class="string">&quot;--format&quot;</span>, choices=[<span class="string">&quot;combined&quot;</span>, <span class="string">&quot;common&quot;</span>, <span class="string">&quot;nginx&quot;</span>],</span><br><span class="line">                        default=<span class="string">&quot;combined&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-o&quot;</span>, <span class="string">&quot;--output&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;保存图表&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--no-plot&quot;</span>, action=<span class="string">&quot;store_true&quot;</span>)</span><br><span class="line"></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    fmt_class = &#123;</span><br><span class="line">        <span class="string">&quot;combined&quot;</span>: CombinedLogFormat,</span><br><span class="line">        <span class="string">&quot;common&quot;</span>: CommonLogFormat,</span><br><span class="line">        <span class="string">&quot;nginx&quot;</span>: NginxLogFormat,</span><br><span class="line">    &#125;[args.<span class="built_in">format</span>]()</span><br><span class="line"></span><br><span class="line">    reader = LogReader(args.file, fmt_class)</span><br><span class="line">    stats = LogStatistics()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> rec <span class="keyword">in</span> reader.records():</span><br><span class="line">        stats.feed(rec)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出统计</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;总请求数：<span class="subst">&#123;stats.total&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;最热门 IP：&quot;</span>, stats.ip.most_common(<span class="number">5</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;最热门 URL：&quot;</span>, stats.urls.most_common(<span class="number">5</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;状态码统计：&quot;</span>, stats.status)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> args.no_plot:</span><br><span class="line">        viz = LogVisualizer(stats)</span><br><span class="line">        viz.draw(args.output)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li><li><h3 id="文件同步工具"><a href="#文件同步工具" class="headerlink" title="文件同步工具"></a>文件同步工具</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实现两个目录的同步</span></span><br><span class="line"><span class="comment"># 支持单向/双向同步</span></span><br><span class="line"><span class="comment"># 使用hash校验文件一致性</span></span><br><span class="line"><span class="comment"># 生成同步报告</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">高级文件同步工具（专业级结构版本）</span></span><br><span class="line"><span class="string">- 采用目录快照（Directory Snapshot）模型</span></span><br><span class="line"><span class="string">- 支持单向、双向同步</span></span><br><span class="line"><span class="string">- 使用 blake3 作为文件内容校验</span></span><br><span class="line"><span class="string">- 具备冲突检测、操作层抽象、执行器分离（dry-run / real-run）</span></span><br><span class="line"><span class="string">- 可扩展、可测试、可维护</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">List</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> blake3  <span class="comment"># 现代高速哈希</span></span><br><span class="line">    HASH_FUNC = <span class="keyword">lambda</span>: blake3.blake3()</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">import</span> hashlib</span><br><span class="line">    HASH_FUNC = <span class="keyword">lambda</span>: hashlib.md5()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 数据模型</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileMeta</span>:</span><br><span class="line">    <span class="built_in">hash</span>: <span class="built_in">str</span></span><br><span class="line">    size: <span class="built_in">int</span></span><br><span class="line">    mtime: <span class="built_in">float</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileAction</span>:</span><br><span class="line">    action: <span class="built_in">str</span>       <span class="comment"># copy / update / delete / conflict</span></span><br><span class="line">    src: <span class="type">Optional</span>[<span class="built_in">str</span>]</span><br><span class="line">    dst: <span class="type">Optional</span>[<span class="built_in">str</span>]</span><br><span class="line">    relative: <span class="built_in">str</span></span><br><span class="line">    note: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 目录快照：高级同步工具的核心抽象</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DirectorySnapshot</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, path: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.root = Path(path)</span><br><span class="line">        <span class="variable language_">self</span>.files: <span class="type">Dict</span>[<span class="built_in">str</span>, FileMeta] = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> file_path <span class="keyword">in</span> <span class="variable language_">self</span>.root.rglob(<span class="string">&quot;*&quot;</span>):</span><br><span class="line">            <span class="keyword">if</span> file_path.is_file():</span><br><span class="line">                rel = <span class="built_in">str</span>(file_path.relative_to(<span class="variable language_">self</span>.root))</span><br><span class="line">                meta = <span class="variable language_">self</span>._read_file_meta(file_path)</span><br><span class="line">                <span class="variable language_">self</span>.files[rel] = meta</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_hash_file</span>(<span class="params">path: Path, chunk: <span class="built_in">int</span> = <span class="number">65536</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        h = HASH_FUNC()</span><br><span class="line">        <span class="keyword">with</span> path.<span class="built_in">open</span>(<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> chunk_data <span class="keyword">in</span> <span class="built_in">iter</span>(<span class="keyword">lambda</span>: f.read(chunk), <span class="string">b&quot;&quot;</span>):</span><br><span class="line">                h.update(chunk_data)</span><br><span class="line">        <span class="keyword">return</span> h.hexdigest()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_read_file_meta</span>(<span class="params">self, f: Path</span>) -&gt; FileMeta:</span><br><span class="line">        st = f.stat()</span><br><span class="line">        h = <span class="variable language_">self</span>._hash_file(f)</span><br><span class="line">        <span class="keyword">return</span> FileMeta(<span class="built_in">hash</span>=h, size=st.st_size, mtime=st.st_mtime)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 文件同步核心逻辑（不执行，只生成动作）</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileSyncPlanner</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    负责比较两个目录快照，生成 sync plan（动作列表）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, s1: DirectorySnapshot, s2: DirectorySnapshot</span>):</span><br><span class="line">        <span class="variable language_">self</span>.s1 = s1</span><br><span class="line">        <span class="variable language_">self</span>.s2 = s2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">one_way</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成从 s1 → s2 的操作计划&quot;&quot;&quot;</span></span><br><span class="line">        actions: <span class="type">List</span>[FileAction] = []</span><br><span class="line"></span><br><span class="line">        src_files = <span class="variable language_">self</span>.s1.files</span><br><span class="line">        dst_files = <span class="variable language_">self</span>.s2.files</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 需要复制或更新的文件</span></span><br><span class="line">        <span class="keyword">for</span> rel, src_meta <span class="keyword">in</span> src_files.items():</span><br><span class="line">            <span class="keyword">if</span> rel <span class="keyword">not</span> <span class="keyword">in</span> dst_files:</span><br><span class="line">                actions.append(FileAction(<span class="string">&quot;copy&quot;</span>, <span class="built_in">str</span>(<span class="variable language_">self</span>.s1.root), <span class="built_in">str</span>(<span class="variable language_">self</span>.s2.root), rel))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst_meta = dst_files[rel]</span><br><span class="line">                <span class="keyword">if</span> src_meta.<span class="built_in">hash</span> != dst_meta.<span class="built_in">hash</span>:</span><br><span class="line">                    actions.append(FileAction(<span class="string">&quot;update&quot;</span>, <span class="built_in">str</span>(<span class="variable language_">self</span>.s1.root), <span class="built_in">str</span>(<span class="variable language_">self</span>.s2.root), rel))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 需要删除的文件</span></span><br><span class="line">        <span class="keyword">for</span> rel <span class="keyword">in</span> dst_files.keys() - src_files.keys():</span><br><span class="line">            actions.append(FileAction(<span class="string">&quot;delete&quot;</span>, <span class="literal">None</span>, <span class="built_in">str</span>(<span class="variable language_">self</span>.s2.root), rel))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> actions</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">two_way</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成双向同步计划（含冲突检测）&quot;&quot;&quot;</span></span><br><span class="line">        actions: <span class="type">List</span>[FileAction] = []</span><br><span class="line"></span><br><span class="line">        s1f = <span class="variable language_">self</span>.s1.files</span><br><span class="line">        s2f = <span class="variable language_">self</span>.s2.files</span><br><span class="line"></span><br><span class="line">        all_files = <span class="built_in">set</span>(s1f.keys()) | <span class="built_in">set</span>(s2f.keys())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> rel <span class="keyword">in</span> all_files:</span><br><span class="line"></span><br><span class="line">            f1 = s1f.get(rel)</span><br><span class="line">            f2 = s2f.get(rel)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 双方都不存在（理论上不会出现）</span></span><br><span class="line">            <span class="keyword">if</span> f1 <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> f2 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 单方新增</span></span><br><span class="line">            <span class="keyword">if</span> f1 <span class="keyword">and</span> <span class="keyword">not</span> f2:</span><br><span class="line">                actions.append(FileAction(<span class="string">&quot;copy&quot;</span>, <span class="built_in">str</span>(<span class="variable language_">self</span>.s1.root), <span class="built_in">str</span>(<span class="variable language_">self</span>.s2.root), rel))</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> f2 <span class="keyword">and</span> <span class="keyword">not</span> f1:</span><br><span class="line">                actions.append(FileAction(<span class="string">&quot;copy&quot;</span>, <span class="built_in">str</span>(<span class="variable language_">self</span>.s2.root), <span class="built_in">str</span>(<span class="variable language_">self</span>.s1.root), rel))</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 双方存在但 hash 不一致 → 需要冲突判断</span></span><br><span class="line">            <span class="keyword">if</span> f1.<span class="built_in">hash</span> != f2.<span class="built_in">hash</span>:</span><br><span class="line">                <span class="comment"># 修改时间判断谁更新</span></span><br><span class="line">                <span class="keyword">if</span> f1.mtime &gt; f2.mtime:</span><br><span class="line">                    actions.append(FileAction(<span class="string">&quot;update&quot;</span>, <span class="built_in">str</span>(<span class="variable language_">self</span>.s1.root), <span class="built_in">str</span>(<span class="variable language_">self</span>.s2.root), rel, note=<span class="string">&quot;mtime win&quot;</span>))</span><br><span class="line">                <span class="keyword">elif</span> f2.mtime &gt; f1.mtime:</span><br><span class="line">                    actions.append(FileAction(<span class="string">&quot;update&quot;</span>, <span class="built_in">str</span>(<span class="variable language_">self</span>.s2.root), <span class="built_in">str</span>(<span class="variable language_">self</span>.s1.root), rel, note=<span class="string">&quot;mtime win&quot;</span>))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 同时修改 → 冲突</span></span><br><span class="line">                    actions.append(FileAction(</span><br><span class="line">                        <span class="string">&quot;conflict&quot;</span>,</span><br><span class="line">                        <span class="built_in">str</span>(<span class="variable language_">self</span>.s1.root),</span><br><span class="line">                        <span class="built_in">str</span>(<span class="variable language_">self</span>.s2.root),</span><br><span class="line">                        rel,</span><br><span class="line">                        note=<span class="string">&quot;both modified&quot;</span></span><br><span class="line">                    ))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> actions</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 执行层（能 dry-run 也能真正执行）</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileSyncExecutor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, dry_run=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.dry_run = dry_run</span><br><span class="line">        <span class="variable language_">self</span>.logs: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, actions: <span class="type">List</span>[FileAction]</span>):</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> actions:</span><br><span class="line">            <span class="keyword">if</span> a.action == <span class="string">&quot;copy&quot;</span>:</span><br><span class="line">                <span class="variable language_">self</span>._copy(a)</span><br><span class="line">            <span class="keyword">elif</span> a.action == <span class="string">&quot;update&quot;</span>:</span><br><span class="line">                <span class="variable language_">self</span>._copy(a)</span><br><span class="line">            <span class="keyword">elif</span> a.action == <span class="string">&quot;delete&quot;</span>:</span><br><span class="line">                <span class="variable language_">self</span>._delete(a)</span><br><span class="line">            <span class="keyword">elif</span> a.action == <span class="string">&quot;conflict&quot;</span>:</span><br><span class="line">                <span class="variable language_">self</span>._conflict(a)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.logs</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_copy</span>(<span class="params">self, a: FileAction</span>):</span><br><span class="line">        src_file = Path(a.src) / a.relative</span><br><span class="line">        dst_file = Path(a.dst) / a.relative</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>._ensure_dir(dst_file)</span><br><span class="line"></span><br><span class="line">        msg = <span class="string">f&quot;[COPY] <span class="subst">&#123;src_file&#125;</span> → <span class="subst">&#123;dst_file&#125;</span>&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.logs.append(msg)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.dry_run:</span><br><span class="line">            shutil.copy2(src_file, dst_file)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_delete</span>(<span class="params">self, a: FileAction</span>):</span><br><span class="line">        dst = Path(a.dst) / a.relative</span><br><span class="line">        msg = <span class="string">f&quot;[DELETE] <span class="subst">&#123;dst&#125;</span>&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.logs.append(msg)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.dry_run <span class="keyword">and</span> dst.exists():</span><br><span class="line">            dst.unlink()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_conflict</span>(<span class="params">self, a: FileAction</span>):</span><br><span class="line">        msg = <span class="string">f&quot;[CONFLICT] <span class="subst">&#123;a.relative&#125;</span>  note=<span class="subst">&#123;a.note&#125;</span>&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.logs.append(msg)</span><br><span class="line">        <span class="comment"># 若不是 dry-run，可将冲突文件另外备份</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.dry_run:</span><br><span class="line">            conflict_dst = Path(a.dst) / (a.relative + <span class="string">&quot;.conflict&quot;</span>)</span><br><span class="line">            shutil.copy2(Path(a.src) / a.relative, conflict_dst)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_ensure_dir</span>(<span class="params">path: Path</span>):</span><br><span class="line">        path.parent.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CLI 层</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;高级文件同步工具&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;src&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;dst&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--mode&quot;</span>, choices=[<span class="string">&quot;one-way&quot;</span>, <span class="string">&quot;two-way&quot;</span>], default=<span class="string">&quot;one-way&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--dry-run&quot;</span>, action=<span class="string">&quot;store_true&quot;</span>)</span><br><span class="line"></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    s1 = DirectorySnapshot(args.src).build()</span><br><span class="line">    s2 = DirectorySnapshot(args.dst).build()</span><br><span class="line"></span><br><span class="line">    planner = FileSyncPlanner(s1, s2)</span><br><span class="line">    actions = planner.one_way() <span class="keyword">if</span> args.mode == <span class="string">&quot;one-way&quot;</span> <span class="keyword">else</span> planner.two_way()</span><br><span class="line"></span><br><span class="line">    executor = FileSyncExecutor(dry_run=args.dry_run)</span><br><span class="line">    logs = executor.run(actions)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>.join(logs))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li><li><h3 id="网络端口扫描器"><a href="#网络端口扫描器" class="headerlink" title="网络端口扫描器"></a>网络端口扫描器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 扫描指定IP的端口开放情况</span></span><br><span class="line"><span class="comment"># 多线程提高扫描速度</span></span><br><span class="line"><span class="comment"># 识别常见服务</span></span><br><span class="line"><span class="comment"># 输出扫描结果到CSV</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">网络端口扫描器</span></span><br><span class="line"><span class="string">支持多线程扫描、服务识别和CSV输出</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常见端口服务映射</span></span><br><span class="line">COMMON_SERVICES = &#123;</span><br><span class="line">    <span class="number">21</span>: <span class="string">&quot;FTP&quot;</span>, <span class="number">22</span>: <span class="string">&quot;SSH&quot;</span>, <span class="number">23</span>: <span class="string">&quot;Telnet&quot;</span>, <span class="number">25</span>: <span class="string">&quot;SMTP&quot;</span>, <span class="number">53</span>: <span class="string">&quot;DNS&quot;</span>,</span><br><span class="line">    <span class="number">80</span>: <span class="string">&quot;HTTP&quot;</span>, <span class="number">110</span>: <span class="string">&quot;POP3&quot;</span>, <span class="number">111</span>: <span class="string">&quot;RPC&quot;</span>, <span class="number">135</span>: <span class="string">&quot;RPC&quot;</span>, <span class="number">139</span>: <span class="string">&quot;NetBIOS&quot;</span>,</span><br><span class="line">    <span class="number">143</span>: <span class="string">&quot;IMAP&quot;</span>, <span class="number">443</span>: <span class="string">&quot;HTTPS&quot;</span>, <span class="number">993</span>: <span class="string">&quot;IMAPS&quot;</span>, <span class="number">995</span>: <span class="string">&quot;POP3S&quot;</span>,</span><br><span class="line">    <span class="number">1723</span>: <span class="string">&quot;PPTP&quot;</span>, <span class="number">3306</span>: <span class="string">&quot;MySQL&quot;</span>, <span class="number">3389</span>: <span class="string">&quot;RDP&quot;</span>, <span class="number">5432</span>: <span class="string">&quot;PostgreSQL&quot;</span>,</span><br><span class="line">    <span class="number">5900</span>: <span class="string">&quot;VNC&quot;</span>, <span class="number">6379</span>: <span class="string">&quot;Redis&quot;</span>, <span class="number">27017</span>: <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PortScanner</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, target, threads=<span class="number">100</span>, timeout=<span class="number">2</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.target = target</span><br><span class="line">        <span class="variable language_">self</span>.threads = threads</span><br><span class="line">        <span class="variable language_">self</span>.timeout = timeout</span><br><span class="line">        <span class="variable language_">self</span>.ports_queue = Queue()</span><br><span class="line">        <span class="variable language_">self</span>.results = []</span><br><span class="line">        <span class="variable language_">self</span>.lock = threading.Lock()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">resolve_target</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;解析目标主机名或IP地址&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ip = socket.gethostbyname(<span class="variable language_">self</span>.target)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                hostname = socket.gethostbyaddr(ip)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">except</span> socket.herror:</span><br><span class="line">                hostname = <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">            <span class="keyword">return</span> ip, hostname</span><br><span class="line">        <span class="keyword">except</span> socket.gaierror:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;错误：无法解析目标 <span class="subst">&#123;self.target&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">scan_port</span>(<span class="params">self, port</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;扫描单个端口&quot;&quot;&quot;</span></span><br><span class="line">        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        sock.settimeout(<span class="variable language_">self</span>.timeout)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = sock.connect_ex((<span class="variable language_">self</span>.target, port))</span><br><span class="line">            <span class="keyword">if</span> result == <span class="number">0</span>:</span><br><span class="line">                service = <span class="variable language_">self</span>.get_service_info(port, sock)</span><br><span class="line">                <span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">                    <span class="variable language_">self</span>.results.append(&#123;</span><br><span class="line">                        <span class="string">&#x27;port&#x27;</span>: port,</span><br><span class="line">                        <span class="string">&#x27;state&#x27;</span>: <span class="string">&#x27;open&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;service&#x27;</span>: service,</span><br><span class="line">                        <span class="string">&#x27;banner&#x27;</span>: <span class="variable language_">self</span>.get_banner(sock) <span class="keyword">if</span> service != <span class="string">&quot;Unknown&quot;</span> <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;发现开放端口: <span class="subst">&#123;port&#125;</span>/tcp - <span class="subst">&#123;service&#125;</span>&quot;</span>)</span><br><span class="line">            sock.close()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_service_info</span>(<span class="params">self, port, sock</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取服务信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 首先检查常见服务映射</span></span><br><span class="line">        <span class="keyword">if</span> port <span class="keyword">in</span> COMMON_SERVICES:</span><br><span class="line">            <span class="keyword">return</span> COMMON_SERVICES[port]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 尝试通过端口号获取服务名</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            service = socket.getservbyport(port, <span class="string">&#x27;tcp&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> service</span><br><span class="line">        <span class="keyword">except</span> (OSError, socket.error):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_banner</span>(<span class="params">self, sock</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;尝试获取服务banner信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sock.settimeout(<span class="number">1.0</span>)</span><br><span class="line">            <span class="comment"># 发送一些常见协议的探测数据</span></span><br><span class="line">            banner = sock.recv(<span class="number">1024</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>).strip()</span><br><span class="line">            <span class="keyword">return</span> banner[:<span class="number">100</span>]  <span class="comment"># 限制banner长度</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">worker</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;工作线程函数&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                port = <span class="variable language_">self</span>.ports_queue.get(timeout=<span class="number">1</span>)</span><br><span class="line">                <span class="variable language_">self</span>.scan_port(port)</span><br><span class="line">                <span class="variable language_">self</span>.ports_queue.task_done()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">scan_ports</span>(<span class="params">self, ports</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;扫描端口范围&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;开始扫描目标: <span class="subst">&#123;self.target&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;线程数: <span class="subst">&#123;self.threads&#125;</span>, 超时: <span class="subst">&#123;self.timeout&#125;</span>秒&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line">        </span><br><span class="line">        start_time = time.time()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加端口到队列</span></span><br><span class="line">        <span class="keyword">for</span> port <span class="keyword">in</span> ports:</span><br><span class="line">            <span class="variable language_">self</span>.ports_queue.put(port)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 启动工作线程</span></span><br><span class="line">        threads = []</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.threads):</span><br><span class="line">            thread = threading.Thread(target=<span class="variable language_">self</span>.worker)</span><br><span class="line">            thread.daemon = <span class="literal">True</span></span><br><span class="line">            thread.start()</span><br><span class="line">            threads.append(thread)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 等待所有任务完成</span></span><br><span class="line">        <span class="variable language_">self</span>.ports_queue.join()</span><br><span class="line">        </span><br><span class="line">        end_time = time.time()</span><br><span class="line">        scan_duration = end_time - start_time</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;扫描完成! 耗时: <span class="subst">&#123;scan_duration:<span class="number">.2</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;发现 <span class="subst">&#123;<span class="built_in">len</span>(self.results)&#125;</span> 个开放端口&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.results</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_to_csv</span>(<span class="params">self, filename=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;保存结果到CSV文件&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> filename:</span><br><span class="line">            timestamp = datetime.now().strftime(<span class="string">&quot;%Y%m%d_%H%M%S&quot;</span>)</span><br><span class="line">            filename = <span class="string">f&quot;port_scan_<span class="subst">&#123;self.target&#125;</span>_<span class="subst">&#123;timestamp&#125;</span>.csv&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">                fieldnames = [<span class="string">&#x27;port&#x27;</span>, <span class="string">&#x27;state&#x27;</span>, <span class="string">&#x27;service&#x27;</span>, <span class="string">&#x27;banner&#x27;</span>]</span><br><span class="line">                writer = csv.DictWriter(csvfile, fieldnames=fieldnames)</span><br><span class="line">                </span><br><span class="line">                writer.writeheader()</span><br><span class="line">                <span class="keyword">for</span> result <span class="keyword">in</span> <span class="variable language_">self</span>.results:</span><br><span class="line">                    writer.writerow(result)</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;结果已保存到: <span class="subst">&#123;filename&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> filename</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;保存CSV文件时出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_ports</span>(<span class="params">ports_str</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解析端口范围字符串&quot;&quot;&quot;</span></span><br><span class="line">    ports = <span class="built_in">set</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理逗号分隔的端口列表和范围</span></span><br><span class="line">    parts = ports_str.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> part <span class="keyword">in</span> parts:</span><br><span class="line">        part = part.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;-&#x27;</span> <span class="keyword">in</span> part:</span><br><span class="line">            <span class="comment"># 处理端口范围</span></span><br><span class="line">            start, end = part.split(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                start_port = <span class="built_in">int</span>(start.strip())</span><br><span class="line">                end_port = <span class="built_in">int</span>(end.strip())</span><br><span class="line">                ports.update(<span class="built_in">range</span>(start_port, end_port + <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 处理单个端口</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                ports.add(<span class="built_in">int</span>(part))</span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sorted</span>(ports)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;网络端口扫描器&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;target&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;目标IP地址或主机名&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--ports&#x27;</span>, default=<span class="string">&#x27;1-1000&#x27;</span>, </span><br><span class="line">                       <span class="built_in">help</span>=<span class="string">&#x27;端口范围 (例如: 80,443, 1-1000, 默认: 1-1000)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-t&#x27;</span>, <span class="string">&#x27;--threads&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">100</span>,</span><br><span class="line">                       <span class="built_in">help</span>=<span class="string">&#x27;线程数 (默认: 100)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--timeout&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">float</span>, default=<span class="number">2.0</span>,</span><br><span class="line">                       <span class="built_in">help</span>=<span class="string">&#x27;连接超时时间 (默认: 2秒)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-o&#x27;</span>, <span class="string">&#x27;--output&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;输出CSV文件名&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--common&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>,</span><br><span class="line">                       <span class="built_in">help</span>=<span class="string">&#x27;只扫描常见端口&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果选择常见端口，使用预定义的端口列表</span></span><br><span class="line">    <span class="keyword">if</span> args.common:</span><br><span class="line">        ports = <span class="built_in">list</span>(COMMON_SERVICES.keys())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ports = parse_ports(args.ports)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ports:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;错误：未找到有效的端口范围&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;准备扫描 <span class="subst">&#123;<span class="built_in">len</span>(ports)&#125;</span> 个端口...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建扫描器实例</span></span><br><span class="line">    scanner = PortScanner(args.target, args.threads, args.timeout)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 解析目标</span></span><br><span class="line">    ip, hostname = scanner.resolve_target()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ip:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;目标IP: <span class="subst">&#123;ip&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> hostname != <span class="string">&quot;Unknown&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;目标主机名: <span class="subst">&#123;hostname&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 执行扫描</span></span><br><span class="line">    results = scanner.scan_ports(ports)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示结果摘要</span></span><br><span class="line">    <span class="keyword">if</span> results:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n开放端口列表:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;端口\t状态\t服务&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">30</span>)</span><br><span class="line">        <span class="keyword">for</span> result <span class="keyword">in</span> <span class="built_in">sorted</span>(results, key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;port&#x27;</span>]):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;result[<span class="string">&#x27;port&#x27;</span>]&#125;</span>\t<span class="subst">&#123;result[<span class="string">&#x27;state&#x27;</span>]&#125;</span>\t<span class="subst">&#123;result[<span class="string">&#x27;service&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存结果</span></span><br><span class="line">    scanner.save_to_csv(args.output)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li><li><h3 id="自动化部署脚本"><a href="#自动化部署脚本" class="headerlink" title="自动化部署脚本"></a>自动化部署脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从Git仓库拉取代码</span></span><br><span class="line"><span class="comment"># 安装依赖包</span></span><br><span class="line"><span class="comment"># 运行测试</span></span><br><span class="line"><span class="comment"># 部署到指定目录</span></span><br><span class="line"><span class="comment"># 重启相关服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">高级自动化部署脚本示例</span></span><br><span class="line"><span class="string">功能：</span></span><br><span class="line"><span class="string">- 从Git拉取代码（克隆或拉取）</span></span><br><span class="line"><span class="string">- 安装依赖（Python/Node.js/Ruby）</span></span><br><span class="line"><span class="string">- 运行测试</span></span><br><span class="line"><span class="string">- 部署到指定目录（带备份）</span></span><br><span class="line"><span class="string">- 重启服务</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, field</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, <span class="type">List</span></span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================</span></span><br><span class="line"><span class="comment"># 配置管理</span></span><br><span class="line"><span class="comment"># ==========================</span></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DeploymentConfig</span>:</span><br><span class="line">    git_repo: <span class="built_in">str</span></span><br><span class="line">    deploy_dir: Path</span><br><span class="line">    service_names: <span class="type">List</span>[<span class="built_in">str</span>] = field(default_factory=<span class="built_in">list</span>)</span><br><span class="line">    branch: <span class="built_in">str</span> = <span class="string">&quot;main&quot;</span></span><br><span class="line">    exclude_dirs: <span class="type">List</span>[<span class="built_in">str</span>] = field(default_factory=<span class="keyword">lambda</span>: [<span class="string">&#x27;.git&#x27;</span>, <span class="string">&#x27;__pycache__&#x27;</span>, <span class="string">&#x27;node_modules&#x27;</span>, <span class="string">&#x27;.pytest_cache&#x27;</span>])</span><br><span class="line">    backup_suffix_format: <span class="built_in">str</span> = <span class="string">&quot;%Y%m%d_%H%M%S&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================</span></span><br><span class="line"><span class="comment"># 部署主类</span></span><br><span class="line"><span class="comment"># ==========================</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Deployer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config: DeploymentConfig</span>):</span><br><span class="line">        <span class="variable language_">self</span>.config = config</span><br><span class="line">        <span class="variable language_">self</span>.logger = <span class="variable language_">self</span>._setup_logger()</span><br><span class="line">        <span class="variable language_">self</span>.temp_dir = Path(tempfile.mkdtemp(prefix=<span class="string">&quot;deploy_tmp_&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="comment"># 日志初始化</span></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_setup_logger</span>(<span class="params">self</span>) -&gt; logging.Logger:</span><br><span class="line">        logger = logging.getLogger(<span class="string">&quot;Deployer&quot;</span>)</span><br><span class="line">        logger.setLevel(logging.INFO)</span><br><span class="line">        formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 输出到控制台</span></span><br><span class="line">        console = logging.StreamHandler(sys.stdout)</span><br><span class="line">        console.setFormatter(formatter)</span><br><span class="line">        logger.addHandler(console)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 输出到文件</span></span><br><span class="line">        file_handler = logging.FileHandler(<span class="string">&quot;deployment.log&quot;</span>)</span><br><span class="line">        file_handler.setFormatter(formatter)</span><br><span class="line">        logger.addHandler(file_handler)</span><br><span class="line">        <span class="keyword">return</span> logger</span><br><span class="line"></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="comment"># 命令执行</span></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_command</span>(<span class="params">self, command: <span class="built_in">str</span>, cwd: <span class="type">Optional</span>[Path] = <span class="literal">None</span>, shell: <span class="built_in">bool</span> = <span class="literal">True</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;运行命令，捕获输出并记录日志&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.logger.info(<span class="string">f&quot;执行命令: <span class="subst">&#123;command&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = subprocess.run(</span><br><span class="line">                command, cwd=cwd, shell=shell,</span><br><span class="line">                capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>, check=<span class="literal">True</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">if</span> result.stdout:</span><br><span class="line">                <span class="variable language_">self</span>.logger.info(result.stdout.strip())</span><br><span class="line">            <span class="keyword">if</span> result.stderr:</span><br><span class="line">                <span class="variable language_">self</span>.logger.warning(result.stderr.strip())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="variable language_">self</span>.logger.error(<span class="string">f&quot;命令执行失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> e.stderr:</span><br><span class="line">                <span class="variable language_">self</span>.logger.error(e.stderr.strip())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="comment"># Git拉取/克隆</span></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_repo</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">self</span>.temp_dir / <span class="string">&quot;.git&quot;</span>).exists():</span><br><span class="line">            <span class="variable language_">self</span>.logger.info(<span class="string">&quot;检测到已有仓库，执行 git pull&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.run_command(<span class="string">&quot;git pull&quot;</span>, cwd=<span class="variable language_">self</span>.temp_dir)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.logger.info(<span class="string">&quot;克隆仓库到临时目录&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.run_command(<span class="string">f&quot;git clone -b <span class="subst">&#123;self.config.branch&#125;</span> <span class="subst">&#123;self.config.git_repo&#125;</span> <span class="subst">&#123;self.temp_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="comment"># 安装依赖</span></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">install_dependencies</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;支持Python, Node.js, Ruby&quot;&quot;&quot;</span></span><br><span class="line">        requirements = <span class="variable language_">self</span>.temp_dir / <span class="string">&quot;requirements.txt&quot;</span></span><br><span class="line">        package_json = <span class="variable language_">self</span>.temp_dir / <span class="string">&quot;package.json&quot;</span></span><br><span class="line">        gemfile = <span class="variable language_">self</span>.temp_dir / <span class="string">&quot;Gemfile&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> requirements.exists():</span><br><span class="line">            <span class="variable language_">self</span>.logger.info(<span class="string">&quot;检测到 requirements.txt, 安装Python依赖&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.run_command(<span class="string">&quot;pip install -r requirements.txt&quot;</span>, cwd=<span class="variable language_">self</span>.temp_dir)</span><br><span class="line">        <span class="keyword">elif</span> package_json.exists():</span><br><span class="line">            <span class="variable language_">self</span>.logger.info(<span class="string">&quot;检测到 package.json, 安装Node.js依赖&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.run_command(<span class="string">&quot;npm install&quot;</span>, cwd=<span class="variable language_">self</span>.temp_dir)</span><br><span class="line">        <span class="keyword">elif</span> gemfile.exists():</span><br><span class="line">            <span class="variable language_">self</span>.logger.info(<span class="string">&quot;检测到 Gemfile, 安装Ruby依赖&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.run_command(<span class="string">&quot;bundle install&quot;</span>, cwd=<span class="variable language_">self</span>.temp_dir)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.logger.info(<span class="string">&quot;未检测到依赖文件，跳过依赖安装&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="comment"># 运行测试</span></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_tests</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;尝试运行常见测试命令&quot;&quot;&quot;</span></span><br><span class="line">        test_commands = [</span><br><span class="line">            <span class="string">&quot;pytest&quot;</span>, <span class="string">&quot;python -m pytest&quot;</span>, <span class="string">&quot;npm test&quot;</span>,</span><br><span class="line">            <span class="string">&quot;bundle exec rspec&quot;</span>, <span class="string">&quot;phpunit&quot;</span>, <span class="string">&quot;./gradlew test&quot;</span>, <span class="string">&quot;mvn test&quot;</span></span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">for</span> cmd <span class="keyword">in</span> test_commands:</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.run_command(cmd, cwd=<span class="variable language_">self</span>.temp_dir):</span><br><span class="line">                <span class="variable language_">self</span>.logger.info(<span class="string">&quot;测试成功&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="variable language_">self</span>.logger.warning(<span class="string">&quot;未找到可用测试命令，跳过测试&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="comment"># 部署到目标目录</span></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deploy</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        target = <span class="variable language_">self</span>.config.deploy_dir</span><br><span class="line">        target.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">        backup_dir = target.parent / <span class="string">f&quot;<span class="subst">&#123;target.name&#125;</span>_backup_<span class="subst">&#123;datetime.now().strftime(self.config.backup_suffix_format)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">any</span>(target.iterdir()):</span><br><span class="line">            <span class="variable language_">self</span>.logger.info(<span class="string">f&quot;备份当前部署到 <span class="subst">&#123;backup_dir&#125;</span>&quot;</span>)</span><br><span class="line">            shutil.copytree(target, backup_dir)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 清空目标目录</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> target.iterdir():</span><br><span class="line">            <span class="keyword">if</span> item.name <span class="keyword">not</span> <span class="keyword">in</span> [backup_dir.name]:</span><br><span class="line">                <span class="keyword">if</span> item.is_dir():</span><br><span class="line">                    shutil.rmtree(item)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    item.unlink()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 拷贝新代码</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable language_">self</span>.temp_dir.iterdir():</span><br><span class="line">            <span class="keyword">if</span> item.name <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.config.exclude_dirs:</span><br><span class="line">                dest = target / item.name</span><br><span class="line">                <span class="keyword">if</span> item.is_dir():</span><br><span class="line">                    shutil.copytree(item, dest)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    shutil.copy2(item, dest)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.logger.info(<span class="string">&quot;部署完成&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="comment"># 重启服务</span></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">restart_services</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.config.service_names:</span><br><span class="line">            <span class="variable language_">self</span>.logger.info(<span class="string">&quot;未指定服务名称，跳过服务重启&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> service <span class="keyword">in</span> <span class="variable language_">self</span>.config.service_names:</span><br><span class="line">            cmd_list = [</span><br><span class="line">                <span class="string">f&quot;sudo systemctl restart <span class="subst">&#123;service&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">f&quot;sudo service <span class="subst">&#123;service&#125;</span> restart&quot;</span>,</span><br><span class="line">            ]</span><br><span class="line">            <span class="keyword">for</span> cmd <span class="keyword">in</span> cmd_list:</span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.run_command(cmd):</span><br><span class="line">                    <span class="variable language_">self</span>.logger.info(<span class="string">f&quot;服务 <span class="subst">&#123;service&#125;</span> 重启成功&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="variable language_">self</span>.logger.error(<span class="string">f&quot;服务 <span class="subst">&#123;service&#125;</span> 重启失败&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="comment"># 清理临时目录</span></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cleanup</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.temp_dir.exists():</span><br><span class="line">            shutil.rmtree(<span class="variable language_">self</span>.temp_dir)</span><br><span class="line">            <span class="variable language_">self</span>.logger.info(<span class="string">f&quot;已清理临时目录 <span class="subst">&#123;self.temp_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="comment"># 执行完整部署</span></span><br><span class="line">    <span class="comment"># --------------------------</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        steps = [</span><br><span class="line">            (<span class="string">&quot;更新代码&quot;</span>, <span class="variable language_">self</span>.update_repo),</span><br><span class="line">            (<span class="string">&quot;安装依赖&quot;</span>, <span class="variable language_">self</span>.install_dependencies),</span><br><span class="line">            (<span class="string">&quot;运行测试&quot;</span>, <span class="variable language_">self</span>.run_tests),</span><br><span class="line">            (<span class="string">&quot;部署代码&quot;</span>, <span class="variable language_">self</span>.deploy),</span><br><span class="line">            (<span class="string">&quot;重启服务&quot;</span>, <span class="variable language_">self</span>.restart_services)</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> name, func <span class="keyword">in</span> steps:</span><br><span class="line">            <span class="variable language_">self</span>.logger.info(<span class="string">f&quot;=== 执行步骤: <span class="subst">&#123;name&#125;</span> ===&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> func():</span><br><span class="line">                <span class="variable language_">self</span>.logger.error(<span class="string">f&quot;步骤失败: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.cleanup()</span><br><span class="line">        <span class="variable language_">self</span>.logger.info(<span class="string">&quot;=== 部署完成 ===&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================</span></span><br><span class="line"><span class="comment"># 主函数</span></span><br><span class="line"><span class="comment"># ==========================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;高级自动化部署脚本&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--git-repo&quot;</span>, required=<span class="literal">True</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--deploy-dir&quot;</span>, required=<span class="literal">True</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--service-names&quot;</span>, default=<span class="string">&quot;&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;多个服务用逗号分隔&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--branch&quot;</span>, default=<span class="string">&quot;main&quot;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    config = DeploymentConfig(</span><br><span class="line">        git_repo=args.git_repo,</span><br><span class="line">        deploy_dir=Path(args.deploy_dir),</span><br><span class="line">        service_names=[s.strip() <span class="keyword">for</span> s <span class="keyword">in</span> args.service_names.split(<span class="string">&quot;,&quot;</span>) <span class="keyword">if</span> s.strip()],</span><br><span class="line">        branch=args.branch</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    deployer = Deployer(config)</span><br><span class="line">    success = deployer.run()</span><br><span class="line">    sys.exit(<span class="number">0</span> <span class="keyword">if</span> success <span class="keyword">else</span> <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://leccxx-maker.github.io/ccxx">leccxx</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://leccxx-maker.github.io/ccxx/2025/11/17/Ubuntu%20for%20Linux%20%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0/">https://leccxx-maker.github.io/ccxx/2025/11/17/Ubuntu%20for%20Linux%20%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/ccxx/tags/%E7%BB%83%E4%B9%A0/">练习</a></div><div class="post-share"><div class="social-share" data-image="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/ccxx/2025/11/17/K8s%E9%9B%86%E7%BE%A4%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/" title="K8s集群自动化部署与管理平台"><img class="cover" src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='onerror=null,src="/ccxx/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">K8s集群自动化部署与管理平台</div></div><div class="info-2"><div class="info-item-1">K8s集群自动化部署与管理平台涉及技术栈： 容器编排：Kubernetes 1.28, Calico CNI 自动化工具：Helm，kubeadm, kubectl 脚本开发：Python, Shell CI&#x2F;CD: GitLab（模拟实现） 容器运行时：Docker 监控运维：监控脚本 123456Kubernetes（常简称为K8s首次发布2014年6月7日）是用于自动部署...</div></div></div></a><a class="pagination-related" href="/ccxx/2025/11/17/2025-11-18-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0/" title="数据清洗与SQL语法练习"><img class="cover" src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='onerror=null,src="/ccxx/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">数据清洗与SQL语法练习</div></div><div class="info-2"><div class="info-item-1">数据清洗与SQL语法练习初级题目 缺失值处理 编写Python脚本，读取包含学生成绩的CSV文件，检测并处理缺失值: 数值型字段用该列均值填充 文本型字段用”未知”填充 输出处理前后的数据统计信息 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/ccxx/2025/11/17/2025-11-18-Dockerfile-and-YAML-file/" title="Dockerfile and YAML file"><img class="cover" src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-18</div><div class="info-item-2">Dockerfile and YAML file</div></div><div class="info-2"><div class="info-item-1">Dockerfile与YAML文件编写练习Dockerfile编写练习 基础Nginx镜像1234# 基于官方Nginx镜像，添加自定义HTML页面FROM nginx:alpineCOPY index.html /usr/share/nginx/html/EXPOSE 80 Python Flask应用12345678# 构建Python Flask应用镜像FROM python:3.9...</div></div></div></a><a class="pagination-related" href="/ccxx/2025/11/17/2025-11-18-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0/" title="数据清洗与SQL语法练习"><img class="cover" src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-18</div><div class="info-item-2">数据清洗与SQL语法练习</div></div><div class="info-2"><div class="info-item-1">数据清洗与SQL语法练习初级题目 缺失值处理 编写Python脚本，读取包含学生成绩的CSV文件，检测并处理缺失值: 数值型字段用该列均值填充 文本型字段用”未知”填充 输出处理前后的数据统计信息 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152...</div></div></div></a><a class="pagination-related" href="/ccxx/2025/11/19/%E5%AD%A6%E4%B9%A0python/" title="学习Python"><img class="cover" src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-20</div><div class="info-item-2">学习Python</div></div><div class="info-2"><div class="info-item-1">学习python的计划初步规划 计划的时间为2~3个月（开始时间为2024年11月20日到2025年1月20日或者2025年2月20日） 至少要达到中阶左右水平 12345678910111213141516《Python编程从入门到实践（第2版）》：Python入门基础，建议完成书中的项目。《代码整洁之道》：学习良好的代码风格和实践，培养编程规范。数据结构与算法入门《算法（第4版）》：了...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/avatar/avatar.jpg" onerror='this.onerror=null,this.src="/ccxx/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">leccxx</div><div class="author-info-description">Not having dreams that are impossible to achieve.</div><div class="site-data"><a href="/ccxx/archives/"><div class="headline">Articles</div><div class="length-num">5</div></a><a href="/ccxx/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/ccxx/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/leccxx-maker"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/leccxx-maker" target="_blank" title="Github"><i class="fab fa-github" style="color:#24292e"></i></a><a class="social-icon" href="mailto:25225ccxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color:#4a7dbe"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">欢迎来到我的博客！这里记录我在 Python、容器和 Linux 领域的学习笔记。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Ubuntu-for-Linux-%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0"><span class="toc-number">1.</span> <span class="toc-text">Ubuntu for Linux 基础练习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ubuntu%E6%93%8D%E4%BD%9C%E7%BB%83%E4%B9%A0"><span class="toc-number">1.1.</span> <span class="toc-text">Ubuntu操作练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">用户和权限管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.2.</span> <span class="toc-text">软件包管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7"><span class="toc-number">1.1.3.</span> <span class="toc-text">进程和系统监控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.4.</span> <span class="toc-text">网络配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.5.</span> <span class="toc-text">磁盘管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99%E7%BB%83%E4%B9%A0"><span class="toc-number">1.2.</span> <span class="toc-text">Shell脚本编写练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.1.</span> <span class="toc-text">系统信息收集脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.2.</span> <span class="toc-text">日志分析脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.3.</span> <span class="toc-text">备份脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.4.</span> <span class="toc-text">用户管理脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.5.</span> <span class="toc-text">服务监控脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99%E7%BB%83%E4%B9%A0"><span class="toc-number">1.3.</span> <span class="toc-text">Python脚本编写练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%B7%A5%E5%85%B7"><span class="toc-number">1.3.1.</span> <span class="toc-text">系统信息收集工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-number">1.3.2.</span> <span class="toc-text">日志文件解析器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7"><span class="toc-number">1.3.3.</span> <span class="toc-text">文件同步工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E5%99%A8"><span class="toc-number">1.3.4.</span> <span class="toc-text">网络端口扫描器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC"><span class="toc-number">1.3.5.</span> <span class="toc-text">自动化部署脚本</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/ccxx/2025/11/19/%E5%AD%A6%E4%B9%A0python/" title="学习Python"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='this.onerror=null,this.src="/ccxx/img/404.jpg"' alt="学习Python"></a><div class="content"><a class="title" href="/ccxx/2025/11/19/%E5%AD%A6%E4%B9%A0python/" title="学习Python">学习Python</a><time datetime="2025-11-19T16:00:00.000Z" title="Created 2025-11-20 00:00:00">2025-11-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ccxx/2025/11/17/2025-11-18-Dockerfile-and-YAML-file/" title="Dockerfile and YAML file"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='this.onerror=null,this.src="/ccxx/img/404.jpg"' alt="Dockerfile and YAML file"></a><div class="content"><a class="title" href="/ccxx/2025/11/17/2025-11-18-Dockerfile-and-YAML-file/" title="Dockerfile and YAML file">Dockerfile and YAML file</a><time datetime="2025-11-17T16:00:00.000Z" title="Created 2025-11-18 00:00:00">2025-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ccxx/2025/11/17/2025-11-18-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0/" title="数据清洗与SQL语法练习"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='this.onerror=null,this.src="/ccxx/img/404.jpg"' alt="数据清洗与SQL语法练习"></a><div class="content"><a class="title" href="/ccxx/2025/11/17/2025-11-18-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0/" title="数据清洗与SQL语法练习">数据清洗与SQL语法练习</a><time datetime="2025-11-17T16:00:00.000Z" title="Created 2025-11-18 00:00:00">2025-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ccxx/2025/11/17/Ubuntu%20for%20Linux%20%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0/" title="Ubuntu for Linux 基础练习"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='this.onerror=null,this.src="/ccxx/img/404.jpg"' alt="Ubuntu for Linux 基础练习"></a><div class="content"><a class="title" href="/ccxx/2025/11/17/Ubuntu%20for%20Linux%20%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0/" title="Ubuntu for Linux 基础练习">Ubuntu for Linux 基础练习</a><time datetime="2025-11-17T16:00:00.000Z" title="Created 2025-11-18 00:00:00">2025-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ccxx/2025/11/17/K8s%E9%9B%86%E7%BE%A4%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/" title="K8s集群自动化部署与管理平台"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='this.onerror=null,this.src="/ccxx/img/404.jpg"' alt="K8s集群自动化部署与管理平台"></a><div class="content"><a class="title" href="/ccxx/2025/11/17/K8s%E9%9B%86%E7%BE%A4%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/" title="K8s集群自动化部署与管理平台">K8s集群自动化部署与管理平台</a><time datetime="2025-11-17T16:00:00.000Z" title="Created 2025-11-18 00:00:00">2025-11-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/mushrooms-9946579.jpg)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By leccxx</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/ccxx/js/utils.js?v=5.5.2"></script><script src="/ccxx/js/main.js?v=5.5.2"></script><div class="js-pjax"></div><script async data-pjax src="/ccxx/"></script></div></body></html>