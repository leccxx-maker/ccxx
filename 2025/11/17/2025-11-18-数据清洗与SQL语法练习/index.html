<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>数据清洗与SQL语法练习 | leccxx-blogs</title><meta name="author" content="leccxx,25225ccxx@gmail.com"><meta name="copyright" content="leccxx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="数据清洗与SQL语法练习初级题目 缺失值处理 编写Python脚本，读取包含学生成绩的CSV文件，检测并处理缺失值: 数值型字段用该列均值填充 文本型字段用”未知”填充 输出处理前后的数据统计信息    12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535"><meta property="og:type" content="article"><meta property="og:title" content="数据清洗与SQL语法练习"><meta property="og:url" content="https://leccxx-maker.github.io/ccxx/2025/11/17/2025-11-18-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0/index.html"><meta property="og:site_name" content="leccxx-blogs"><meta property="og:description" content="数据清洗与SQL语法练习初级题目 缺失值处理 编写Python脚本，读取包含学生成绩的CSV文件，检测并处理缺失值: 数值型字段用该列均值填充 文本型字段用”未知”填充 输出处理前后的数据统计信息    12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg"><meta property="article:published_time" content="2025-11-17T16:00:00.000Z"><meta property="article:modified_time" content="2025-11-30T14:30:46.209Z"><meta property="article:author" content="leccxx"><meta property="article:tag" content="练习"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "数据清洗与SQL语法练习",
  "url": "https://leccxx-maker.github.io/ccxx/2025/11/17/2025-11-18-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0/",
  "image": "https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg",
  "datePublished": "2025-11-17T16:00:00.000Z",
  "dateModified": "2025-11-30T14:30:46.209Z",
  "author": [
    {
      "@type": "Person",
      "name": "leccxx",
      "url": "https://leccxx-maker.github.io/ccxx"
    }
  ]
}</script><link rel="shortcut icon" href="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/favicon/favicon-16x16.png"><link rel="canonical" href="https://leccxx-maker.github.io/ccxx/2025/11/17/2025-11-18-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/ccxx/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),r=window.matchMedia("(prefers-color-scheme: dark)"),c=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(c.matches)a();else if(r.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}r.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?o():a())})}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>const GLOBAL_CONFIG={root:"/ccxx/",algolia:void 0,localSearch:void 0,translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:300,highlightFullpage:!1,highlightMacStyle:!1},copy:{success:"Copy Successful",error:"Copy Failed",noSupport:"Browser Not Supported"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"Just now",min:"minutes ago",hour:"hours ago",day:"days ago",month:"months ago"},copyright:void 0,lightbox:"null",Snackbar:void 0,infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"Load More"},isPhotoFigcaption:!1,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"数据清洗与SQL语法练习",isHighlightShrink:!0,isToc:!0,pageType:"post"}</script><style>@media screen and (max-width:768px){#page-header{height:55vh!important;background-size:cover!important;background-position:center!important;background-attachment:scroll!important}#site-title{font-size:1.8rem!important;line-height:1.2!important}#site-subtitle{font-size:1rem!important;opacity:.85!important}#content-inner{padding:12px!important}.card-widget,.recent-post-item{border-radius:14px!important;margin-bottom:14px!important}.post-content img{max-width:100%!important;height:auto!important;border-radius:8px}}</style><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image:url(https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/megalith-7683754.jpg)"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/avatar/avatar.jpg" onerror='this.onerror=null,this.src="/ccxx/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/ccxx/archives/"><div class="headline">Articles</div><div class="length-num">5</div></a><a href="/ccxx/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/ccxx/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/ccxx/"><i class="fa-fw fas fa-house-user"></i><span> home</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/archives/"><i class="fa-fw fas fa-box-open"></i><span> archives</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/tags/"><i class="fa-fw fas fa-hashtag"></i><span> tags</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/categories/"><i class="fa-fw fas fa-layer-group"></i><span> categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/ccxx/"><span class="site-name">leccxx-blogs</span></a><a class="nav-page-title" href="/ccxx/"><span class="site-name">数据清洗与SQL语法练习</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/ccxx/"><i class="fa-fw fas fa-house-user"></i><span> home</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/archives/"><i class="fa-fw fas fa-box-open"></i><span> archives</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/tags/"><i class="fa-fw fas fa-hashtag"></i><span> tags</span></a></div><div class="menus_item"><a class="site-page" href="/ccxx/categories/"><i class="fa-fw fas fa-layer-group"></i><span> categories</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">数据清洗与SQL语法练习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-11-17T16:00:00.000Z" title="Created 2025-11-18 00:00:00">2025-11-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-11-30T14:30:46.209Z" title="Updated 2025-11-30 22:30:46">2025-11-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/ccxx/categories/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6/">数据科学</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="数据清洗与SQL语法练习"><a href="#数据清洗与SQL语法练习" class="headerlink" title="数据清洗与SQL语法练习"></a>数据清洗与SQL语法练习</h1><h2 id="初级题目"><a href="#初级题目" class="headerlink" title="初级题目"></a>初级题目</h2><ol><li><h3 id="缺失值处理"><a href="#缺失值处理" class="headerlink" title="缺失值处理"></a>缺失值处理</h3><ul><li>编写Python脚本，读取包含学生成绩的CSV文件，检测并处理缺失值:<ul><li>数值型字段用该列均值填充</li><li>文本型字段用”未知”填充</li><li>输出处理前后的数据统计信息</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_missing_values</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    处理学生成绩数据中的缺失值</span></span><br><span class="line"><span class="string">    - 数值型字段用该列均值填充</span></span><br><span class="line"><span class="string">    - 文本型字段用&quot;未知&quot;填充</span></span><br><span class="line"><span class="string">    - 输出处理前后的数据统计信息</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建测试数据</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="literal">None</span>, <span class="string">&#x27;赵六&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;subject&#x27;</span>: [<span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;score&#x27;</span>: [<span class="number">85</span>, <span class="literal">None</span>, <span class="number">92</span>, <span class="number">78</span>, <span class="number">88</span>],</span><br><span class="line">        <span class="string">&#x27;exam_date&#x27;</span>: [<span class="string">&#x27;2023-06-01&#x27;</span>, <span class="string">&#x27;2023-06-01&#x27;</span>, <span class="literal">None</span>, <span class="string">&#x27;2023-06-01&#x27;</span>, <span class="string">&#x27;2023-06-02&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建DataFrame</span></span><br><span class="line">    df = pd.DataFrame(data)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;原始数据:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(df)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n原始数据信息:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(df.info())</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计缺失值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;缺失值统计:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    missing_before = df.isnull().<span class="built_in">sum</span>()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;处理前缺失值:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> col, count <span class="keyword">in</span> missing_before.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;col&#125;</span>: <span class="subst">&#123;count&#125;</span>个缺失值&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 复制数据用于处理</span></span><br><span class="line">    df_cleaned = df.copy()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理数值型字段的缺失值（用均值填充）</span></span><br><span class="line">    numeric_columns = df_cleaned.select_dtypes(include=[np.number]).columns</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> numeric_columns:</span><br><span class="line">        <span class="keyword">if</span> df_cleaned[col].isnull().<span class="built_in">sum</span>() &gt; <span class="number">0</span>:</span><br><span class="line">            mean_value = df_cleaned[col].mean()</span><br><span class="line">            df_cleaned[col].fillna(mean_value, inplace=<span class="literal">True</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n数值字段 &#x27;<span class="subst">&#123;col&#125;</span>&#x27; 用均值 <span class="subst">&#123;mean_value:<span class="number">.2</span>f&#125;</span> 填充&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理文本型字段的缺失值（用&quot;未知&quot;填充）</span></span><br><span class="line">    text_columns = df_cleaned.select_dtypes(include=[<span class="string">&#x27;object&#x27;</span>]).columns</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> text_columns:</span><br><span class="line">        <span class="keyword">if</span> df_cleaned[col].isnull().<span class="built_in">sum</span>() &gt; <span class="number">0</span>:</span><br><span class="line">            df_cleaned[col].fillna(<span class="string">&#x27;未知&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;文本字段 &#x27;<span class="subst">&#123;col&#125;</span>&#x27; 用 &#x27;未知&#x27; 填充&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计处理后的缺失值</span></span><br><span class="line">    missing_after = df_cleaned.isnull().<span class="built_in">sum</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;处理后的数据:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(df_cleaned)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据统计信息对比:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理前后的描述性统计</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n处理前数据描述:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(df.describe(include=<span class="string">&#x27;all&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n处理后数据描述:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(df_cleaned.describe(include=<span class="string">&#x27;all&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 缺失值处理总结</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;缺失值处理总结:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> df.columns:</span><br><span class="line">        before = missing_before[col]</span><br><span class="line">        after = missing_after[col]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;col&#125;</span>: 处理前 <span class="subst">&#123;before&#125;</span>个缺失值 → 处理后 <span class="subst">&#123;after&#125;</span>个缺失值&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证数据类型</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;处理后数据类型:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(df_cleaned.dtypes)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df, df_cleaned</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_test_data</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;保存测试数据到CSV文件&quot;&quot;&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="literal">None</span>, <span class="string">&#x27;赵六&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;subject&#x27;</span>: [<span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;score&#x27;</span>: [<span class="number">85</span>, <span class="literal">None</span>, <span class="number">92</span>, <span class="number">78</span>, <span class="number">88</span>],</span><br><span class="line">        <span class="string">&#x27;exam_date&#x27;</span>: [<span class="string">&#x27;2023-06-01&#x27;</span>, <span class="string">&#x27;2023-06-01&#x27;</span>, <span class="literal">None</span>, <span class="string">&#x27;2023-06-01&#x27;</span>, <span class="string">&#x27;2023-06-02&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    df = pd.DataFrame(data)</span><br><span class="line">    df.to_csv(<span class="string">&#x27;students.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;测试数据已保存到 &#x27;students.csv&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_and_process_from_file</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;从文件加载并处理数据&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 从CSV文件读取数据</span></span><br><span class="line">        df = pd.read_csv(<span class="string">&#x27;students.csv&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;从文件加载的数据:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(df)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 处理缺失值</span></span><br><span class="line">        df_cleaned = df.copy()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 数值型字段用均值填充</span></span><br><span class="line">        numeric_cols = df_cleaned.select_dtypes(include=[np.number]).columns</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> numeric_cols:</span><br><span class="line">            <span class="keyword">if</span> df_cleaned[col].isnull().<span class="built_in">any</span>():</span><br><span class="line">                mean_val = df_cleaned[col].mean()</span><br><span class="line">                df_cleaned[col].fillna(mean_val, inplace=<span class="literal">True</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;填充数值字段 &#x27;<span class="subst">&#123;col&#125;</span>&#x27;: 均值 = <span class="subst">&#123;mean_val:<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 文本型字段用&quot;未知&quot;填充</span></span><br><span class="line">        text_cols = df_cleaned.select_dtypes(include=[<span class="string">&#x27;object&#x27;</span>]).columns</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> text_cols:</span><br><span class="line">            <span class="keyword">if</span> df_cleaned[col].isnull().<span class="built_in">any</span>():</span><br><span class="line">                df_cleaned[col].fillna(<span class="string">&#x27;未知&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;填充文本字段 &#x27;<span class="subst">&#123;col&#125;</span>&#x27;: 用 &#x27;未知&#x27;&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;文件数据处理结果:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(df_cleaned)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> df_cleaned</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;文件 &#x27;students.csv&#x27; 未找到，请先运行 save_test_data() 创建测试文件&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 保存测试数据</span></span><br><span class="line">    save_test_data()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;主处理程序&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 主要处理逻辑</span></span><br><span class="line">    original_df, cleaned_df = handle_missing_values()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;文件处理测试&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 从文件处理的测试</span></span><br><span class="line">    load_and_process_from_file()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;处理完成！&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br></pre></td></tr></table></figure></li><li><h3 id="重复数据处理"><a href="#重复数据处理" class="headerlink" title="重复数据处理"></a>重复数据处理</h3><ul><li>编写脚本识别并删除完全重复的记录，基于”学号”+”科目”组合删除部分重复记录，保留最新日期的记录</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_test_data</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建测试数据&quot;&quot;&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;student_id&#x27;</span>: [<span class="number">1001</span>, <span class="number">1001</span>, <span class="number">1002</span>, <span class="number">1001</span>, <span class="number">1003</span>, <span class="number">1002</span>, <span class="number">1004</span>, <span class="number">1001</span>, <span class="number">1003</span>],</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;subject&#x27;</span>: [<span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="string">&#x27;物理&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;score&#x27;</span>: [<span class="number">85</span>, <span class="number">90</span>, <span class="number">78</span>, <span class="number">85</span>, <span class="number">92</span>, <span class="number">82</span>, <span class="number">88</span>, <span class="number">87</span>, <span class="number">95</span>],</span><br><span class="line">        <span class="string">&#x27;record_date&#x27;</span>: [<span class="string">&#x27;2023-01-15&#x27;</span>, <span class="string">&#x27;2023-02-20&#x27;</span>, <span class="string">&#x27;2023-01-15&#x27;</span>, <span class="string">&#x27;2023-01-15&#x27;</span>, </span><br><span class="line">                       <span class="string">&#x27;2023-01-16&#x27;</span>, <span class="string">&#x27;2023-02-18&#x27;</span>, <span class="string">&#x27;2023-01-20&#x27;</span>, <span class="string">&#x27;2023-03-10&#x27;</span>, <span class="string">&#x27;2023-02-25&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    df = pd.DataFrame(data)</span><br><span class="line">    df.to_csv(<span class="string">&#x27;student_records.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;测试数据已保存到 &#x27;student_records.csv&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detect_and_remove_duplicates</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    检测和处理重复数据</span></span><br><span class="line"><span class="string">    1. 删除完全重复的记录</span></span><br><span class="line"><span class="string">    2. 基于&quot;学号+科目&quot;组合删除部分重复记录，保留最新日期的记录</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;原始数据:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(df)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n原始数据记录数: <span class="subst">&#123;<span class="built_in">len</span>(df)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 检测完全重复的记录</span></span><br><span class="line">    complete_duplicates = df[df.duplicated(keep=<span class="literal">False</span>)]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;完全重复的记录:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> complete_duplicates.empty:</span><br><span class="line">        <span class="built_in">print</span>(complete_duplicates)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;没有找到完全重复的记录&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 删除完全重复的记录</span></span><br><span class="line">    df_cleaned = df.drop_duplicates()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n删除完全重复记录后，剩余记录数: <span class="subst">&#123;<span class="built_in">len</span>(df_cleaned)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 检测基于&quot;学号+科目&quot;的部分重复记录</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;基于&#x27;学号+科目&#x27;的重复记录分析:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 找出有重复的组合</span></span><br><span class="line">    duplicate_combinations = df_cleaned[df_cleaned.duplicated(subset=[<span class="string">&#x27;student_id&#x27;</span>, <span class="string">&#x27;subject&#x27;</span>], keep=<span class="literal">False</span>)]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> duplicate_combinations.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;发现以下重复组合:&quot;</span>)</span><br><span class="line">        <span class="comment"># 按学号和科目分组显示</span></span><br><span class="line">        grouped = duplicate_combinations.groupby([<span class="string">&#x27;student_id&#x27;</span>, <span class="string">&#x27;subject&#x27;</span>])</span><br><span class="line">        <span class="keyword">for</span> (stu_id, subj), group <span class="keyword">in</span> grouped:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n学号: <span class="subst">&#123;stu_id&#125;</span>, 科目: <span class="subst">&#123;subj&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(group[[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;score&#x27;</span>, <span class="string">&#x27;record_date&#x27;</span>]].to_string(index=<span class="literal">False</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;没有找到基于&#x27;学号+科目&#x27;的重复记录&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 处理部分重复记录：保留每个学号+科目组合中日期最新的记录</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;处理部分重复记录（保留最新日期）:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 确保日期列为datetime类型</span></span><br><span class="line">    df_cleaned[<span class="string">&#x27;record_date&#x27;</span>] = pd.to_datetime(df_cleaned[<span class="string">&#x27;record_date&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 按学号和科目分组，保留每个组内日期最大的记录</span></span><br><span class="line">    df_final = df_cleaned.sort_values(<span class="string">&#x27;record_date&#x27;</span>, ascending=<span class="literal">False</span>).drop_duplicates(</span><br><span class="line">        subset=[<span class="string">&#x27;student_id&#x27;</span>, <span class="string">&#x27;subject&#x27;</span>], </span><br><span class="line">        keep=<span class="string">&#x27;first&#x27;</span></span><br><span class="line">    ).sort_values([<span class="string">&#x27;student_id&#x27;</span>, <span class="string">&#x27;subject&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;处理部分重复后，最终记录数: <span class="subst">&#123;<span class="built_in">len</span>(df_final)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_cleaned, df_final</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_duplicates</span>(<span class="params">df_cleaned, df_final</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;分析重复数据处理结果&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;重复数据处理结果分析:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算各种重复数量</span></span><br><span class="line">    complete_dup_count = <span class="built_in">len</span>(df_cleaned) - <span class="built_in">len</span>(df_cleaned.drop_duplicates())</span><br><span class="line">    partial_dup_count = <span class="built_in">len</span>(df_cleaned) - <span class="built_in">len</span>(df_final)</span><br><span class="line">    total_dup_count = <span class="built_in">len</span>(df_cleaned) - <span class="built_in">len</span>(df_final) + complete_dup_count</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;完全重复记录数: <span class="subst">&#123;complete_dup_count&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;部分重复记录数: <span class="subst">&#123;partial_dup_count&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;总删除记录数: <span class="subst">&#123;total_dup_count&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;最终有效记录数: <span class="subst">&#123;<span class="built_in">len</span>(df_final)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示最终数据</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;最终处理结果:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(df_final.sort_values([<span class="string">&#x27;student_id&#x27;</span>, <span class="string">&#x27;subject&#x27;</span>]).to_string(index=<span class="literal">False</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证处理结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据质量验证:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查是否还有完全重复</span></span><br><span class="line">    remaining_complete_dups = df_final[df_final.duplicated()]</span><br><span class="line">    <span class="keyword">if</span> remaining_complete_dups.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;✓ 没有完全重复记录&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;✗ 仍然存在完全重复记录&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(remaining_complete_dups)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查是否还有部分重复</span></span><br><span class="line">    remaining_partial_dups = df_final[df_final.duplicated(subset=[<span class="string">&#x27;student_id&#x27;</span>, <span class="string">&#x27;subject&#x27;</span>])]</span><br><span class="line">    <span class="keyword">if</span> remaining_partial_dups.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;✓ 没有&#x27;学号+科目&#x27;重复记录&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;✗ 仍然存在&#x27;学号+科目&#x27;重复记录&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(remaining_partial_dups)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> total_dup_count</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_cleaned_data</span>(<span class="params">df_final</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;保存清洗后的数据&quot;&quot;&quot;</span></span><br><span class="line">    df_final[<span class="string">&#x27;record_date&#x27;</span>] = df_final[<span class="string">&#x27;record_date&#x27;</span>].dt.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">    df_final.to_csv(<span class="string">&#x27;student_records_cleaned.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n清洗后的数据已保存到 &#x27;student_records_cleaned.csv&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">advanced_duplicate_detection</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;高级重复检测功能&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;高级重复检测:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检测可能的近似重复（基于姓名和科目）</span></span><br><span class="line">    df[<span class="string">&#x27;name_subject&#x27;</span>] = df[<span class="string">&#x27;name&#x27;</span>] + <span class="string">&#x27;_&#x27;</span> + df[<span class="string">&#x27;subject&#x27;</span>]</span><br><span class="line">    name_subject_duplicates = df[df.duplicated(subset=[<span class="string">&#x27;name_subject&#x27;</span>], keep=<span class="literal">False</span>)]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> name_subject_duplicates.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;基于&#x27;姓名+科目&#x27;的可能重复:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(name_subject_duplicates[[<span class="string">&#x27;student_id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;subject&#x27;</span>, <span class="string">&#x27;score&#x27;</span>, <span class="string">&#x27;record_date&#x27;</span>]].to_string(index=<span class="literal">False</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检测异常分数变化</span></span><br><span class="line">    df_sorted = df.sort_values([<span class="string">&#x27;student_id&#x27;</span>, <span class="string">&#x27;subject&#x27;</span>, <span class="string">&#x27;record_date&#x27;</span>])</span><br><span class="line">    df_sorted[<span class="string">&#x27;score_change&#x27;</span>] = df_sorted.groupby([<span class="string">&#x27;student_id&#x27;</span>, <span class="string">&#x27;subject&#x27;</span>])[<span class="string">&#x27;score&#x27;</span>].diff()</span><br><span class="line">    </span><br><span class="line">    large_changes = df_sorted[np.<span class="built_in">abs</span>(df_sorted[<span class="string">&#x27;score_change&#x27;</span>]) &gt; <span class="number">15</span>]  <span class="comment"># 分数变化超过15分</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> large_changes.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n检测到异常分数变化:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(large_changes[[<span class="string">&#x27;student_id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;subject&#x27;</span>, <span class="string">&#x27;score&#x27;</span>, <span class="string">&#x27;score_change&#x27;</span>, <span class="string">&#x27;record_date&#x27;</span>]].to_string(index=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;重复数据处理脚本&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建测试数据</span></span><br><span class="line">    original_df = create_test_data()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理重复数据</span></span><br><span class="line">    df_cleaned, df_final = detect_and_remove_duplicates(original_df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 分析结果</span></span><br><span class="line">    total_removed = analyze_duplicates(df_cleaned, df_final)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存结果</span></span><br><span class="line">    save_cleaned_data(df_final)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 高级检测</span></span><br><span class="line">    advanced_duplicate_detection(original_df)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;处理完成!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;总共删除了 <span class="subst">&#123;total_removed&#125;</span> 条重复记录&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;数据清洗率: <span class="subst">&#123;total_removed/<span class="built_in">len</span>(original_df)*<span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li><li><h3 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h3><ul><li>编写脚本将数据中的日期字符串转换为datetime对象，数值字符串转换为float类型，处理转换异常</li></ul></li></ol><h2 id="中级题目"><a href="#中级题目" class="headerlink" title="中级题目"></a>中级题目</h2><ol><li><h3 id="异常值检测与处理"><a href="#异常值检测与处理" class="headerlink" title="异常值检测与处理"></a>异常值检测与处理</h3><ul><li>编写脚本检测学生成绩中的异常值（如&lt;0或&gt;100）,用3σ原则或IQR方法识别异常，分别用删除、截断和均值替换三种方式处理</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_test_data</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建包含混合数据类型的测试数据&quot;&quot;&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">        <span class="string">&#x27;date_str&#x27;</span>: [<span class="string">&#x27;2023-01-15&#x27;</span>, <span class="string">&#x27;2023/02/20&#x27;</span>, <span class="string">&#x27;2023-03-25&#x27;</span>, <span class="string">&#x27;invalid_date&#x27;</span>, <span class="string">&#x27;2023-05-10&#x27;</span>, <span class="string">&#x27;15-06-2023&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;price_str&#x27;</span>: [<span class="string">&#x27;125.50&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;78.00&#x27;</span>, <span class="string">&#x27;45.30&#x27;</span>, <span class="string">&#x27;120.00&#x27;</span>, <span class="string">&#x27;99,99&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;quantity&#x27;</span>: [<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;15&#x27;</span>, <span class="string">&#x27;twenty&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;status&#x27;</span>: [<span class="string">&#x27;active&#x27;</span>, <span class="string">&#x27;inactive&#x27;</span>, <span class="string">&#x27;pending&#x27;</span>, <span class="string">&#x27;active&#x27;</span>, <span class="string">&#x27;completed&#x27;</span>, <span class="string">&#x27;active&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;mixed_numeric&#x27;</span>: [<span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;200.5&#x27;</span>, <span class="string">&#x27;300&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>, <span class="string">&#x27;500.75&#x27;</span>, <span class="string">&#x27;600&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    df = pd.DataFrame(data)</span><br><span class="line">    df.to_csv(<span class="string">&#x27;mixed_data.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;测试数据已保存到 &#x27;mixed_data.csv&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_data_types</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;分析数据的当前类型和内容&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据初始状态分析:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(df)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据类型信息:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(df.info())</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;各列唯一值示例:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="keyword">for</span> column <span class="keyword">in</span> df.columns:</span><br><span class="line">        unique_values = df[column].unique()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;column&#125;</span>: <span class="subst">&#123;<span class="built_in">list</span>(unique_values[:<span class="number">5</span>])&#125;</span> <span class="subst">&#123;<span class="string">&#x27;...&#x27;</span> <span class="keyword">if</span> <span class="built_in">len</span>(unique_values) &gt; <span class="number">5</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_date_column</span>(<span class="params">df, column_name</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将日期字符串转换为datetime对象</span></span><br><span class="line"><span class="string">    支持多种日期格式</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n处理日期列: <span class="subst">&#123;column_name&#125;</span>&quot;</span>)</span><br><span class="line">    original_values = df[column_name].copy()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 预处理日期字符串</span></span><br><span class="line">    df[column_name + <span class="string">&#x27;_cleaned&#x27;</span>] = df[column_name].astype(<span class="built_in">str</span>).<span class="built_in">str</span>.strip()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 定义多种日期格式尝试</span></span><br><span class="line">    date_formats = [</span><br><span class="line">        <span class="string">&#x27;%Y-%m-%d&#x27;</span>,     <span class="comment"># 2023-01-15</span></span><br><span class="line">        <span class="string">&#x27;%Y/%m/%d&#x27;</span>,     <span class="comment"># 2023/01/15</span></span><br><span class="line">        <span class="string">&#x27;%d-%m-%Y&#x27;</span>,     <span class="comment"># 15-01-2023</span></span><br><span class="line">        <span class="string">&#x27;%m/%d/%Y&#x27;</span>,     <span class="comment"># 01/15/2023</span></span><br><span class="line">        <span class="string">&#x27;%d.%m.%Y&#x27;</span>,     <span class="comment"># 15.01.2023</span></span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试转换日期</span></span><br><span class="line">    converted_dates = []</span><br><span class="line">    conversion_status = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> df[column_name + <span class="string">&#x27;_cleaned&#x27;</span>]:</span><br><span class="line">        converted = <span class="literal">None</span></span><br><span class="line">        status = <span class="string">&quot;失败&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> pd.isna(value) <span class="keyword">or</span> value.lower() <span class="keyword">in</span> [<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;nan&#x27;</span>, <span class="string">&#x27;none&#x27;</span>, <span class="string">&#x27;invalid_date&#x27;</span>]:</span><br><span class="line">            converted = pd.NaT</span><br><span class="line">            status = <span class="string">&quot;空值&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 尝试每种格式</span></span><br><span class="line">            <span class="keyword">for</span> fmt <span class="keyword">in</span> date_formats:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    converted = datetime.strptime(value, fmt)</span><br><span class="line">                    status = <span class="string">&quot;成功&quot;</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">except</span> ValueError:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        converted_dates.append(converted)</span><br><span class="line">        conversion_status.append(status)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 添加转换结果到DataFrame</span></span><br><span class="line">    df[column_name + <span class="string">&#x27;_converted&#x27;</span>] = converted_dates</span><br><span class="line">    df[column_name + <span class="string">&#x27;_conversion_status&#x27;</span>] = conversion_status</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计转换结果</span></span><br><span class="line">    success_count = conversion_status.count(<span class="string">&quot;成功&quot;</span>)</span><br><span class="line">    failure_count = conversion_status.count(<span class="string">&quot;失败&quot;</span>)</span><br><span class="line">    null_count = conversion_status.count(<span class="string">&quot;空值&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;日期转换结果: 成功=<span class="subst">&#123;success_count&#125;</span>, 失败=<span class="subst">&#123;failure_count&#125;</span>, 空值=<span class="subst">&#123;null_count&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示转换详情</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n日期转换详情:&quot;</span>)</span><br><span class="line">    conversion_details = pd.DataFrame(&#123;</span><br><span class="line">        <span class="string">&#x27;原始值&#x27;</span>: original_values,</span><br><span class="line">        <span class="string">&#x27;转换后&#x27;</span>: df[column_name + <span class="string">&#x27;_converted&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;状态&#x27;</span>: conversion_status</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">print</span>(conversion_details.to_string(index=<span class="literal">False</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_numeric_column</span>(<span class="params">df, column_name</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将数值字符串转换为float类型</span></span><br><span class="line"><span class="string">    处理各种数值格式和异常情况</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n处理数值列: <span class="subst">&#123;column_name&#125;</span>&quot;</span>)</span><br><span class="line">    original_values = df[column_name].copy()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 预处理数值字符串</span></span><br><span class="line">    df[column_name + <span class="string">&#x27;_cleaned&#x27;</span>] = df[column_name].astype(<span class="built_in">str</span>).<span class="built_in">str</span>.strip()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理常见的数值格式问题</span></span><br><span class="line">    df[column_name + <span class="string">&#x27;_cleaned&#x27;</span>] = df[column_name + <span class="string">&#x27;_cleaned&#x27;</span>].<span class="built_in">str</span>.replace(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;.&#x27;</span>)  <span class="comment"># 逗号转点</span></span><br><span class="line">    df[column_name + <span class="string">&#x27;_cleaned&#x27;</span>] = df[column_name + <span class="string">&#x27;_cleaned&#x27;</span>].<span class="built_in">str</span>.replace(<span class="string">r&#x27;[^\d.-]&#x27;</span>, <span class="string">&#x27;&#x27;</span>, regex=<span class="literal">True</span>)  <span class="comment"># 移除非数字字符</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试转换数值</span></span><br><span class="line">    converted_values = []</span><br><span class="line">    conversion_status = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> df[column_name + <span class="string">&#x27;_cleaned&#x27;</span>]:</span><br><span class="line">        converted = <span class="literal">None</span></span><br><span class="line">        status = <span class="string">&quot;失败&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> pd.isna(value) <span class="keyword">or</span> value.lower() <span class="keyword">in</span> [<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;nan&#x27;</span>, <span class="string">&#x27;none&#x27;</span>, <span class="string">&#x27;n/a&#x27;</span>]:</span><br><span class="line">            converted = np.nan</span><br><span class="line">            status = <span class="string">&quot;空值&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 尝试直接转换</span></span><br><span class="line">                converted = <span class="built_in">float</span>(value)</span><br><span class="line">                status = <span class="string">&quot;成功&quot;</span></span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                <span class="comment"># 如果转换失败，尝试提取数字</span></span><br><span class="line">                numbers = re.findall(<span class="string">r&#x27;-?\d+\.?\d*&#x27;</span>, value)</span><br><span class="line">                <span class="keyword">if</span> numbers:</span><br><span class="line">                    converted = <span class="built_in">float</span>(numbers[<span class="number">0</span>])</span><br><span class="line">                    status = <span class="string">&quot;部分成功（提取数字）&quot;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    converted = np.nan</span><br><span class="line">                    status = <span class="string">&quot;失败&quot;</span></span><br><span class="line">        </span><br><span class="line">        converted_values.append(converted)</span><br><span class="line">        conversion_status.append(status)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 添加转换结果到DataFrame</span></span><br><span class="line">    df[column_name + <span class="string">&#x27;_converted&#x27;</span>] = converted_values</span><br><span class="line">    df[column_name + <span class="string">&#x27;_conversion_status&#x27;</span>] = conversion_status</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计转换结果</span></span><br><span class="line">    success_count = conversion_status.count(<span class="string">&quot;成功&quot;</span>) + conversion_status.count(<span class="string">&quot;部分成功（提取数字）&quot;</span>)</span><br><span class="line">    failure_count = conversion_status.count(<span class="string">&quot;失败&quot;</span>)</span><br><span class="line">    null_count = conversion_status.count(<span class="string">&quot;空值&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;数值转换结果: 成功=<span class="subst">&#123;success_count&#125;</span>, 失败=<span class="subst">&#123;failure_count&#125;</span>, 空值=<span class="subst">&#123;null_count&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示转换详情</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n数值转换详情:&quot;</span>)</span><br><span class="line">    conversion_details = pd.DataFrame(&#123;</span><br><span class="line">        <span class="string">&#x27;原始值&#x27;</span>: original_values,</span><br><span class="line">        <span class="string">&#x27;转换后&#x27;</span>: df[column_name + <span class="string">&#x27;_converted&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;状态&#x27;</span>: conversion_status</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">print</span>(conversion_details.to_string(index=<span class="literal">False</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_conversion_errors</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;处理转换错误，提供错误报告和修复建议&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;转换错误报告:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    error_report = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查日期转换错误</span></span><br><span class="line">    date_columns = [col <span class="keyword">for</span> col <span class="keyword">in</span> df.columns <span class="keyword">if</span> <span class="string">&#x27;_conversion_status&#x27;</span> <span class="keyword">in</span> col <span class="keyword">and</span> <span class="string">&#x27;date&#x27;</span> <span class="keyword">in</span> col]</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> date_columns:</span><br><span class="line">        base_col = col.replace(<span class="string">&#x27;_conversion_status&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        failed_mask = df[col] == <span class="string">&#x27;失败&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> failed_mask.<span class="built_in">any</span>():</span><br><span class="line">            failed_data = df[failed_mask][[base_col, base_col + <span class="string">&#x27;_converted&#x27;</span>]]</span><br><span class="line">            <span class="keyword">for</span> idx, row <span class="keyword">in</span> failed_data.iterrows():</span><br><span class="line">                error_report.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;行号&#x27;</span>: idx,</span><br><span class="line">                    <span class="string">&#x27;列名&#x27;</span>: base_col,</span><br><span class="line">                    <span class="string">&#x27;原始值&#x27;</span>: row[base_col],</span><br><span class="line">                    <span class="string">&#x27;问题类型&#x27;</span>: <span class="string">&#x27;日期格式无法识别&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;建议&#x27;</span>: <span class="string">&#x27;检查日期格式是否符合标准格式&#x27;</span></span><br><span class="line">                &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查数值转换错误</span></span><br><span class="line">    numeric_columns = [col <span class="keyword">for</span> col <span class="keyword">in</span> df.columns <span class="keyword">if</span> <span class="string">&#x27;_conversion_status&#x27;</span> <span class="keyword">in</span> col <span class="keyword">and</span> <span class="string">&#x27;date&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> col]</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> numeric_columns:</span><br><span class="line">        base_col = col.replace(<span class="string">&#x27;_conversion_status&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        failed_mask = df[col] == <span class="string">&#x27;失败&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> failed_mask.<span class="built_in">any</span>():</span><br><span class="line">            failed_data = df[failed_mask][[base_col, base_col + <span class="string">&#x27;_converted&#x27;</span>]]</span><br><span class="line">            <span class="keyword">for</span> idx, row <span class="keyword">in</span> failed_data.iterrows():</span><br><span class="line">                error_report.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;行号&#x27;</span>: idx,</span><br><span class="line">                    <span class="string">&#x27;列名&#x27;</span>: base_col,</span><br><span class="line">                    <span class="string">&#x27;原始值&#x27;</span>: row[base_col],</span><br><span class="line">                    <span class="string">&#x27;问题类型&#x27;</span>: <span class="string">&#x27;数值格式无法转换&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;建议&#x27;</span>: <span class="string">&#x27;检查是否包含非数字字符&#x27;</span></span><br><span class="line">                &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> error_report:</span><br><span class="line">        error_df = pd.DataFrame(error_report)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;发现以下转换错误:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(error_df.to_string(index=<span class="literal">False</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未发现转换错误&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> error_report</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_final_dataframe</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建最终的数据框，包含转换后的数据&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;创建最终数据框:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 选择原始列和转换后的列</span></span><br><span class="line">    original_columns = [col <span class="keyword">for</span> col <span class="keyword">in</span> df.columns <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(x <span class="keyword">in</span> col <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">&#x27;_cleaned&#x27;</span>, <span class="string">&#x27;_converted&#x27;</span>, <span class="string">&#x27;_conversion_status&#x27;</span>])]</span><br><span class="line">    converted_columns = [col <span class="keyword">for</span> col <span class="keyword">in</span> df.columns <span class="keyword">if</span> <span class="string">&#x27;_converted&#x27;</span> <span class="keyword">in</span> col <span class="keyword">and</span> <span class="string">&#x27;_conversion_status&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> col]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建最终数据框</span></span><br><span class="line">    final_data = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 添加原始的非转换列</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> original_columns:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;date_str&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> col <span class="keyword">and</span> <span class="string">&#x27;price_str&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> col <span class="keyword">and</span> <span class="string">&#x27;quantity&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> col <span class="keyword">and</span> <span class="string">&#x27;mixed_numeric&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> col:</span><br><span class="line">            final_data[col] = df[col]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 添加转换后的列（重命名为原始列名）</span></span><br><span class="line">    <span class="keyword">for</span> conv_col <span class="keyword">in</span> converted_columns:</span><br><span class="line">        original_name = conv_col.replace(<span class="string">&#x27;_converted&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        final_data[original_name] = df[conv_col]</span><br><span class="line">    </span><br><span class="line">    final_df = pd.DataFrame(final_data)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;最终数据框:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(final_df)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n最终数据类型:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(final_df.dtypes)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> final_df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_conversion_summary</span>(<span class="params">df, final_df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成转换总结报告&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据类型转换总结:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 原始数据类型</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n原始数据类型:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> df.select_dtypes(include=[<span class="built_in">object</span>]).columns:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(x <span class="keyword">in</span> col <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">&#x27;_cleaned&#x27;</span>, <span class="string">&#x27;_converted&#x27;</span>, <span class="string">&#x27;_conversion_status&#x27;</span>]):</span><br><span class="line">            sample = df[col].head(<span class="number">3</span>).tolist()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;col&#125;</span>: <span class="subst">&#123;df[col].dtype&#125;</span> (示例: <span class="subst">&#123;sample&#125;</span>)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 转换后数据类型</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n转换后数据类型:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> final_df.columns:</span><br><span class="line">        sample = final_df[col].head(<span class="number">3</span>).tolist() <span class="keyword">if</span> <span class="built_in">len</span>(final_df) &gt; <span class="number">0</span> <span class="keyword">else</span> []</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;col&#125;</span>: <span class="subst">&#123;final_df[col].dtype&#125;</span> (示例: <span class="subst">&#123;sample&#125;</span>)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 转换统计</span></span><br><span class="line">    date_cols = [col <span class="keyword">for</span> col <span class="keyword">in</span> df.columns <span class="keyword">if</span> <span class="string">&#x27;date_str&#x27;</span> <span class="keyword">in</span> col <span class="keyword">and</span> <span class="string">&#x27;_conversion_status&#x27;</span> <span class="keyword">in</span> col]</span><br><span class="line">    numeric_cols = [col <span class="keyword">for</span> col <span class="keyword">in</span> df.columns <span class="keyword">if</span> <span class="string">&#x27;date_str&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> col <span class="keyword">and</span> <span class="string">&#x27;_conversion_status&#x27;</span> <span class="keyword">in</span> col]</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n转换统计:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> date_cols + numeric_cols:</span><br><span class="line">        base_col = col.replace(<span class="string">&#x27;_conversion_status&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        status_counts = df[col].value_counts()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;base_col&#125;</span>:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> status, count <span class="keyword">in</span> status_counts.items():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;status&#125;</span>: <span class="subst">&#123;count&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_results</span>(<span class="params">final_df, error_report</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;保存转换结果和错误报告&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 保存最终数据</span></span><br><span class="line">    final_df.to_csv(<span class="string">&#x27;converted_data.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n最终数据已保存到 &#x27;converted_data.csv&#x27;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存错误报告</span></span><br><span class="line">    <span class="keyword">if</span> error_report:</span><br><span class="line">        error_df = pd.DataFrame(error_report)</span><br><span class="line">        error_df.to_csv(<span class="string">&#x27;conversion_errors.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;错误报告已保存到 &#x27;conversion_errors.csv&#x27;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存详细转换日志</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;conversion_log.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">&quot;数据类型转换日志\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;=&quot;</span> * <span class="number">50</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;转换时间: <span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)&#125;</span>\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;总记录数: <span class="subst">&#123;<span class="built_in">len</span>(final_df)&#125;</span>\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;\n最终数据类型:\n&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> final_df.columns:</span><br><span class="line">            f.write(<span class="string">f&quot;  <span class="subst">&#123;col&#125;</span>: <span class="subst">&#123;final_df[col].dtype&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据类型转换脚本&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建测试数据</span></span><br><span class="line">    df = create_test_data()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 分析初始数据</span></span><br><span class="line">    analyze_data_types(df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 转换日期列</span></span><br><span class="line">    df = convert_date_column(df, <span class="string">&#x27;date_str&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 转换数值列</span></span><br><span class="line">    df = convert_numeric_column(df, <span class="string">&#x27;price_str&#x27;</span>)</span><br><span class="line">    df = convert_numeric_column(df, <span class="string">&#x27;quantity&#x27;</span>)</span><br><span class="line">    df = convert_numeric_column(df, <span class="string">&#x27;mixed_numeric&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理转换错误</span></span><br><span class="line">    error_report = handle_conversion_errors(df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建最终数据框</span></span><br><span class="line">    final_df = create_final_dataframe(df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 生成总结报告</span></span><br><span class="line">    generate_conversion_summary(df, final_df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存结果</span></span><br><span class="line">    save_results(final_df, error_report)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据类型转换完成!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li><li><h3 id="文本数据清洗"><a href="#文本数据清洗" class="headerlink" title="文本数据清洗"></a>文本数据清洗</h3><ul><li>编写脚本清洗包含用户评价的数据：<ul><li>去除HTML标签和特殊字符</li><li>统一日期格式（如”2023-01-01”）</li><li>标准化手机号格式</li><li>提取电子邮件域名</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_test_data</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建包含各种文本数据问题的测试数据&quot;&quot;&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>],</span><br><span class="line">        <span class="string">&#x27;comment&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;这个产品&lt;em&gt;很好&lt;/em&gt;! 我非常喜欢!!!&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;不满意!!! 质量太差了😡&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;一般般吧，&lt;div&gt;没什么特别&lt;/div&gt;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;&lt;div&gt;推荐购买&lt;/div&gt; 性价比高👍&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;服务态度&lt;strong&gt;极差&lt;/strong&gt;！！！&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;产品不错，但送货&lt;em&gt;太慢&lt;/em&gt;了💔&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;非常满意！会再次购买~&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;phone&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;13812345678&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;135-1234-5678&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;13800138000&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;+86-136-1234-5678&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;1371234abcd&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;139 1234 5678&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;user1@example.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;user2@gmail.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;user3&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;user4@qq.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;test.user@company-domain.org&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;invalid-email&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;admin@website.gov.cn&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;comment_date&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;2023/01/15&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;2023年2月20日&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;2023-03-25&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;2023-04-10&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;2023.05.15&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;15/06/2023&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;July 1, 2023&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    df = pd.DataFrame(data)</span><br><span class="line">    df.to_csv(<span class="string">&#x27;user_comments.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;测试数据已保存到 &#x27;user_comments.csv&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_text_data</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;分析文本数据的初始状态&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;文本数据初始状态分析:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(df)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;各列数据示例:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="keyword">for</span> column <span class="keyword">in</span> df.columns:</span><br><span class="line">        <span class="keyword">if</span> column != <span class="string">&#x27;user_id&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;column&#125;</span>列:&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> i, value <span class="keyword">in</span> <span class="built_in">enumerate</span>(df[column].head(<span class="number">3</span>)):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>. <span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_html_tags</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;去除HTML标签&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> pd.isna(text):</span><br><span class="line">        <span class="keyword">return</span> text</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 方法1: 使用正则表达式</span></span><br><span class="line">    clean_text = re.sub(<span class="string">r&#x27;&lt;[^&gt;]+&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="built_in">str</span>(text))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 方法2: 使用html.unescape处理HTML实体</span></span><br><span class="line">    clean_text = html.unescape(clean_text)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> clean_text</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_special_characters</span>(<span class="params">text, keep_chinese=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    去除特殊字符</span></span><br><span class="line"><span class="string">    keep_chinese: 是否保留中文字符</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> pd.isna(text):</span><br><span class="line">        <span class="keyword">return</span> text</span><br><span class="line">    </span><br><span class="line">    text = <span class="built_in">str</span>(text)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> keep_chinese:</span><br><span class="line">        <span class="comment"># 保留中文、字母、数字、常见标点</span></span><br><span class="line">        pattern = <span class="string">r&#x27;[^\u4e00-\u9fa5a-zA-Z0-9\s\.\,\!\?\;\\/\-\:\@\#\$\%\&amp;\*\(\)\+\=\[\]\&#123;\&#125;\&lt;\&gt;\_\|\~\`\&#x27;\&quot;]&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 只保留字母、数字、空格和基本标点</span></span><br><span class="line">        pattern = <span class="string">r&#x27;[^a-zA-Z0-9\s\.\,\!\?\;\\/\-\:\@\#\$\%\&amp;\*\(\)\+\=\[\]\&#123;\&#125;\&lt;\&gt;\_\|\~\`\&#x27;\&quot;]&#x27;</span></span><br><span class="line">    </span><br><span class="line">    clean_text = re.sub(pattern, <span class="string">&#x27;&#x27;</span>, text)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 去除多余的空格</span></span><br><span class="line">    clean_text = re.sub(<span class="string">r&#x27;\s+&#x27;</span>, <span class="string">&#x27; &#x27;</span>, clean_text).strip()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> clean_text</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_comments</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;清洗评论文本 - 去除HTML标签和特殊字符&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;清洗评论文本:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建副本</span></span><br><span class="line">    df_clean = df.copy()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 去除HTML标签</span></span><br><span class="line">    df_clean[<span class="string">&#x27;comment_clean&#x27;</span>] = df_clean[<span class="string">&#x27;comment&#x27;</span>].apply(remove_html_tags)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 去除特殊字符（保留中文）</span></span><br><span class="line">    df_clean[<span class="string">&#x27;comment_clean&#x27;</span>] = df_clean[<span class="string">&#x27;comment_clean&#x27;</span>].apply(</span><br><span class="line">        <span class="keyword">lambda</span> x: remove_special_characters(x, keep_chinese=<span class="literal">True</span>)</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示清洗前后的对比</span></span><br><span class="line">    comparison = pd.DataFrame(&#123;</span><br><span class="line">        <span class="string">&#x27;原始评论&#x27;</span>: df_clean[<span class="string">&#x27;comment&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;清洗后评论&#x27;</span>: df_clean[<span class="string">&#x27;comment_clean&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;评论清洗前后对比:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> idx, row <span class="keyword">in</span> comparison.iterrows():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n用户 <span class="subst">&#123;idx+<span class="number">1</span>&#125;</span>:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  原始: <span class="subst">&#123;row[<span class="string">&#x27;原始评论&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  清洗: <span class="subst">&#123;row[<span class="string">&#x27;清洗后评论&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_clean</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">standardize_date_format</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;统一日期格式为 YYYY-MM-DD&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> pd.isna(text):</span><br><span class="line">        <span class="keyword">return</span> text</span><br><span class="line">    </span><br><span class="line">    text = <span class="built_in">str</span>(text).strip()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 定义多种日期格式模式</span></span><br><span class="line">    date_patterns = [</span><br><span class="line">        (<span class="string">r&#x27;(\d&#123;4&#125;)[/年\.](\d&#123;1,2&#125;)[/月\.](\d&#123;1,2&#125;)日?&#x27;</span>, <span class="string">&#x27;&#123;&#125;-&#123;:02d&#125;-&#123;:02d&#125;&#x27;</span>),  <span class="comment"># 2023/01/15, 2023年1月15日</span></span><br><span class="line">        (<span class="string">r&#x27;(\d&#123;1,2&#125;)[/月](\d&#123;1,2&#125;)[/日年](\d&#123;4&#125;)&#x27;</span>, <span class="string">&#x27;&#123;&#125;-&#123;:02d&#125;-&#123;:02d&#125;&#x27;</span>),       <span class="comment"># 15/06/2023</span></span><br><span class="line">        (<span class="string">r&#x27;([A-Za-z]+)\s*(\d&#123;1,2&#125;),\s*(\d&#123;4&#125;)&#x27;</span>, <span class="string">&#x27;&#123;&#125;&#x27;</span>),                        <span class="comment"># July 1, 2023</span></span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    month_map = &#123;</span><br><span class="line">        <span class="string">&#x27;january&#x27;</span>: <span class="string">&#x27;01&#x27;</span>, <span class="string">&#x27;february&#x27;</span>: <span class="string">&#x27;02&#x27;</span>, <span class="string">&#x27;march&#x27;</span>: <span class="string">&#x27;03&#x27;</span>, <span class="string">&#x27;april&#x27;</span>: <span class="string">&#x27;04&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;may&#x27;</span>: <span class="string">&#x27;05&#x27;</span>, <span class="string">&#x27;june&#x27;</span>: <span class="string">&#x27;06&#x27;</span>, <span class="string">&#x27;july&#x27;</span>: <span class="string">&#x27;07&#x27;</span>, <span class="string">&#x27;august&#x27;</span>: <span class="string">&#x27;08&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;september&#x27;</span>: <span class="string">&#x27;09&#x27;</span>, <span class="string">&#x27;october&#x27;</span>: <span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;november&#x27;</span>: <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;december&#x27;</span>: <span class="string">&#x27;12&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;jan&#x27;</span>: <span class="string">&#x27;01&#x27;</span>, <span class="string">&#x27;feb&#x27;</span>: <span class="string">&#x27;02&#x27;</span>, <span class="string">&#x27;mar&#x27;</span>: <span class="string">&#x27;03&#x27;</span>, <span class="string">&#x27;apr&#x27;</span>: <span class="string">&#x27;04&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;jun&#x27;</span>: <span class="string">&#x27;06&#x27;</span>, <span class="string">&#x27;jul&#x27;</span>: <span class="string">&#x27;07&#x27;</span>, <span class="string">&#x27;aug&#x27;</span>: <span class="string">&#x27;08&#x27;</span>, <span class="string">&#x27;sep&#x27;</span>: <span class="string">&#x27;09&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;oct&#x27;</span>: <span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;nov&#x27;</span>: <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;dec&#x27;</span>: <span class="string">&#x27;12&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试匹配各种格式</span></span><br><span class="line">    <span class="keyword">for</span> pattern, format_str <span class="keyword">in</span> date_patterns:</span><br><span class="line">        <span class="keyword">match</span> = re.search(pattern, text, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;month&#x27;</span> <span class="keyword">in</span> format_str:  <span class="comment"># 处理英文月份</span></span><br><span class="line">                month_name = <span class="keyword">match</span>.group(<span class="number">1</span>).lower()</span><br><span class="line">                <span class="keyword">if</span> month_name <span class="keyword">in</span> month_map:</span><br><span class="line">                    month = month_map[month_name]</span><br><span class="line">                    day = <span class="keyword">match</span>.group(<span class="number">2</span>).zfill(<span class="number">2</span>)</span><br><span class="line">                    year = <span class="keyword">match</span>.group(<span class="number">3</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;year&#125;</span>-<span class="subst">&#123;month&#125;</span>-<span class="subst">&#123;day&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                groups = <span class="keyword">match</span>.groups()</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(groups) == <span class="number">3</span>:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">len</span>(groups[<span class="number">0</span>]) == <span class="number">4</span>:  <span class="comment"># YYYY-MM-DD 格式</span></span><br><span class="line">                        year, month, day = groups</span><br><span class="line">                    <span class="keyword">else</span>:  <span class="comment"># DD-MM-YYYY 格式</span></span><br><span class="line">                        day, month, year = groups</span><br><span class="line">                    </span><br><span class="line">                    month = month.zfill(<span class="number">2</span>)</span><br><span class="line">                    day = day.zfill(<span class="number">2</span>)</span><br><span class="line">                    <span class="keyword">return</span> format_str.<span class="built_in">format</span>(year, <span class="built_in">int</span>(month), <span class="built_in">int</span>(day))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果无法解析，返回原始值并标记</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;无法解析: <span class="subst">&#123;text&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_dates</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;统一日期格式&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;统一日期格式:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    df_clean = df.copy()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 标准化日期格式</span></span><br><span class="line">    df_clean[<span class="string">&#x27;comment_date_standardized&#x27;</span>] = df_clean[<span class="string">&#x27;comment_date&#x27;</span>].apply(standardize_date_format)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示清洗前后的对比</span></span><br><span class="line">    comparison = pd.DataFrame(&#123;</span><br><span class="line">        <span class="string">&#x27;原始日期&#x27;</span>: df_clean[<span class="string">&#x27;comment_date&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;标准化日期&#x27;</span>: df_clean[<span class="string">&#x27;comment_date_standardized&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;日期格式标准化前后对比:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> idx, row <span class="keyword">in</span> comparison.iterrows():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  用户 <span class="subst">&#123;idx+<span class="number">1</span>&#125;</span>: <span class="subst">&#123;row[<span class="string">&#x27;原始日期&#x27;</span>]&#125;</span> → <span class="subst">&#123;row[<span class="string">&#x27;标准化日期&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_clean</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">standardize_phone_number</span>(<span class="params">phone</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;标准化手机号格式&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> pd.isna(phone):</span><br><span class="line">        <span class="keyword">return</span> phone</span><br><span class="line">    </span><br><span class="line">    phone = <span class="built_in">str</span>(phone)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 移除非数字字符</span></span><br><span class="line">    digits = re.sub(<span class="string">r&#x27;\D&#x27;</span>, <span class="string">&#x27;&#x27;</span>, phone)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查手机号有效性</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(digits) == <span class="number">11</span>:</span><br><span class="line">        <span class="comment"># 中国手机号格式: XXX-XXXX-XXXX</span></span><br><span class="line">        formatted = <span class="string">f&quot;<span class="subst">&#123;digits[:<span class="number">3</span>]&#125;</span>-<span class="subst">&#123;digits[<span class="number">3</span>:<span class="number">7</span>]&#125;</span>-<span class="subst">&#123;digits[<span class="number">7</span>:]&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> formatted</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">len</span>(digits) == <span class="number">10</span>:</span><br><span class="line">        <span class="comment"># 可能是缺少国家码，假设是中国手机号</span></span><br><span class="line">        formatted = <span class="string">f&quot;<span class="subst">&#123;digits[:<span class="number">3</span>]&#125;</span>-<span class="subst">&#123;digits[<span class="number">3</span>:<span class="number">6</span>]&#125;</span>-<span class="subst">&#123;digits[<span class="number">6</span>:]&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> formatted</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;无效号码: <span class="subst">&#123;phone&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_phones</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;标准化手机号格式&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;标准化手机号格式:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    df_clean = df.copy()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 标准化手机号</span></span><br><span class="line">    df_clean[<span class="string">&#x27;phone_standardized&#x27;</span>] = df_clean[<span class="string">&#x27;phone&#x27;</span>].apply(standardize_phone_number)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示清洗前后的对比</span></span><br><span class="line">    comparison = pd.DataFrame(&#123;</span><br><span class="line">        <span class="string">&#x27;原始手机号&#x27;</span>: df_clean[<span class="string">&#x27;phone&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;标准化手机号&#x27;</span>: df_clean[<span class="string">&#x27;phone_standardized&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;手机号标准化前后对比:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> idx, row <span class="keyword">in</span> comparison.iterrows():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  用户 <span class="subst">&#123;idx+<span class="number">1</span>&#125;</span>: <span class="subst">&#123;row[<span class="string">&#x27;原始手机号&#x27;</span>]&#125;</span> → <span class="subst">&#123;row[<span class="string">&#x27;标准化手机号&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计有效手机号</span></span><br><span class="line">    valid_phones = df_clean[<span class="string">&#x27;phone_standardized&#x27;</span>].apply(</span><br><span class="line">        <span class="keyword">lambda</span> x: <span class="keyword">not</span> <span class="built_in">str</span>(x).startswith(<span class="string">&#x27;无效号码&#x27;</span>)</span><br><span class="line">    ).<span class="built_in">sum</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n有效手机号数量: <span class="subst">&#123;valid_phones&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(df_clean)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_clean</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_email_domain</span>(<span class="params">email</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;提取电子邮件域名&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> pd.isna(email):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;无邮箱&quot;</span></span><br><span class="line">    </span><br><span class="line">    email = <span class="built_in">str</span>(email).strip()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证邮箱格式</span></span><br><span class="line">    email_pattern = <span class="string">r&#x27;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,&#125;$&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> re.<span class="keyword">match</span>(email_pattern, email):</span><br><span class="line">        <span class="comment"># 提取域名部分</span></span><br><span class="line">        domain = email.split(<span class="string">&#x27;@&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> domain</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;无效邮箱&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_email_domains</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;提取电子邮件域名&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;提取电子邮件域名:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    df_clean = df.copy()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 提取邮箱域名</span></span><br><span class="line">    df_clean[<span class="string">&#x27;email_domain&#x27;</span>] = df_clean[<span class="string">&#x27;email&#x27;</span>].apply(extract_email_domain)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示提取结果</span></span><br><span class="line">    comparison = pd.DataFrame(&#123;</span><br><span class="line">        <span class="string">&#x27;原始邮箱&#x27;</span>: df_clean[<span class="string">&#x27;email&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;域名&#x27;</span>: df_clean[<span class="string">&#x27;email_domain&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;邮箱域名提取结果:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> idx, row <span class="keyword">in</span> comparison.iterrows():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  用户 <span class="subst">&#123;idx+<span class="number">1</span>&#125;</span>: <span class="subst">&#123;row[<span class="string">&#x27;原始邮箱&#x27;</span>]&#125;</span> → <span class="subst">&#123;row[<span class="string">&#x27;域名&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计域名分布</span></span><br><span class="line">    domain_counts = df_clean[<span class="string">&#x27;email_domain&#x27;</span>].value_counts()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n邮箱域名分布:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> domain, count <span class="keyword">in</span> domain_counts.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;domain&#125;</span>: <span class="subst">&#123;count&#125;</span>个&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_clean</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_final_dataframe</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建最终清洗后的数据框&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;创建最终清洗后的数据:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 选择需要的列</span></span><br><span class="line">    final_columns = &#123;</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;comment_clean&#x27;</span>: <span class="string">&#x27;清洗后评论&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;phone_standardized&#x27;</span>: <span class="string">&#x27;标准化手机号&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;email_domain&#x27;</span>: <span class="string">&#x27;邮箱域名&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;comment_date_standardized&#x27;</span>: <span class="string">&#x27;标准化日期&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建最终数据框</span></span><br><span class="line">    final_data = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> old_col, new_col <span class="keyword">in</span> final_columns.items():</span><br><span class="line">        <span class="keyword">if</span> old_col <span class="keyword">in</span> df.columns:</span><br><span class="line">            final_data[new_col] = df[old_col]</span><br><span class="line">    </span><br><span class="line">    final_df = pd.DataFrame(final_data)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;最终清洗后的数据:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(final_df.to_string(index=<span class="literal">False</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> final_df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_cleaning_report</span>(<span class="params">df, final_df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成数据清洗报告&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;文本数据清洗报告:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算清洗统计</span></span><br><span class="line">    original_comments_length = df[<span class="string">&#x27;comment&#x27;</span>].<span class="built_in">str</span>.<span class="built_in">len</span>().<span class="built_in">sum</span>()</span><br><span class="line">    cleaned_comments_length = final_df[<span class="string">&#x27;清洗后评论&#x27;</span>].<span class="built_in">str</span>.<span class="built_in">len</span>().<span class="built_in">sum</span>()</span><br><span class="line">    </span><br><span class="line">    valid_phones = final_df[<span class="string">&#x27;标准化手机号&#x27;</span>].apply(</span><br><span class="line">        <span class="keyword">lambda</span> x: <span class="keyword">not</span> <span class="built_in">str</span>(x).startswith(<span class="string">&#x27;无效号码&#x27;</span>)</span><br><span class="line">    ).<span class="built_in">sum</span>()</span><br><span class="line">    </span><br><span class="line">    valid_emails = final_df[<span class="string">&#x27;邮箱域名&#x27;</span>].apply(</span><br><span class="line">        <span class="keyword">lambda</span> x: x <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&#x27;无邮箱&#x27;</span>, <span class="string">&#x27;无效邮箱&#x27;</span>]</span><br><span class="line">    ).<span class="built_in">sum</span>()</span><br><span class="line">    </span><br><span class="line">    valid_dates = final_df[<span class="string">&#x27;标准化日期&#x27;</span>].apply(</span><br><span class="line">        <span class="keyword">lambda</span> x: <span class="keyword">not</span> <span class="built_in">str</span>(x).startswith(<span class="string">&#x27;无法解析&#x27;</span>)</span><br><span class="line">    ).<span class="built_in">sum</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;评论文本长度减少: <span class="subst">&#123;original_comments_length&#125;</span> → <span class="subst">&#123;cleaned_comments_length&#125;</span> &quot;</span></span><br><span class="line">          <span class="string">f&quot;(减少 <span class="subst">&#123;((original_comments_length - cleaned_comments_length) / original_comments_length * <span class="number">100</span>):<span class="number">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;有效手机号: <span class="subst">&#123;valid_phones&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(final_df)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;有效邮箱: <span class="subst">&#123;valid_emails&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(final_df)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;有效日期: <span class="subst">&#123;valid_dates&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(final_df)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示数据质量提升</span></span><br><span class="line">    quality_metrics = &#123;</span><br><span class="line">        <span class="string">&#x27;评论清洁度&#x27;</span>: (cleaned_comments_length / original_comments_length) * <span class="number">100</span>,</span><br><span class="line">        <span class="string">&#x27;手机号有效性&#x27;</span>: (valid_phones / <span class="built_in">len</span>(final_df)) * <span class="number">100</span>,</span><br><span class="line">        <span class="string">&#x27;邮箱有效性&#x27;</span>: (valid_emails / <span class="built_in">len</span>(final_df)) * <span class="number">100</span>,</span><br><span class="line">        <span class="string">&#x27;日期标准化&#x27;</span>: (valid_dates / <span class="built_in">len</span>(final_df)) * <span class="number">100</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n数据质量指标:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> metric, score <span class="keyword">in</span> quality_metrics.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;metric&#125;</span>: <span class="subst">&#123;score:<span class="number">.1</span>f&#125;</span>%&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_cleaned_data</span>(<span class="params">final_df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;保存清洗后的数据&quot;&quot;&quot;</span></span><br><span class="line">    final_df.to_csv(<span class="string">&#x27;user_comments_cleaned.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n清洗后的数据已保存到 &#x27;user_comments_cleaned.csv&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;文本数据清洗脚本&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建测试数据</span></span><br><span class="line">    df = create_test_data()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 分析初始数据</span></span><br><span class="line">    analyze_text_data(df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 执行各项清洗任务</span></span><br><span class="line">    df = clean_comments(df)           <span class="comment"># 清洗评论文本</span></span><br><span class="line">    df = clean_dates(df)              <span class="comment"># 统一日期格式</span></span><br><span class="line">    df = clean_phones(df)             <span class="comment"># 标准化手机号</span></span><br><span class="line">    df = extract_email_domains(df)    <span class="comment"># 提取邮箱域名</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建最终数据框</span></span><br><span class="line">    final_df = create_final_dataframe(df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 生成清洗报告</span></span><br><span class="line">    generate_cleaning_report(df, final_df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存结果</span></span><br><span class="line">    save_cleaned_data(final_df)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;文本数据清洗完成!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li><li><h3 id="数据标准化"><a href="#数据标准化" class="headerlink" title="数据标准化"></a>数据标准化</h3><ul><li>编写脚本对数值型数据进行标准化：<ul><li>最小-最大归一化</li><li>Z-score标准化</li><li>小数定标标准化</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler, StandardScaler</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_test_data</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建包含不同尺度和分布的测试数据&quot;&quot;&quot;</span></span><br><span class="line">    np.random.seed(<span class="number">42</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建不同分布的数据</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;product_id&#x27;</span>: <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>),</span><br><span class="line">        <span class="string">&#x27;price&#x27;</span>: np.random.normal(<span class="number">500</span>, <span class="number">200</span>, <span class="number">100</span>).clip(<span class="number">50</span>, <span class="number">1500</span>),  <span class="comment"># 正态分布</span></span><br><span class="line">        <span class="string">&#x27;sales_volume&#x27;</span>: np.random.exponential(<span class="number">500</span>, <span class="number">100</span>).clip(<span class="number">10</span>, <span class="number">3000</span>),  <span class="comment"># 指数分布</span></span><br><span class="line">        <span class="string">&#x27;rating&#x27;</span>: np.random.uniform(<span class="number">1</span>, <span class="number">5</span>, <span class="number">100</span>),  <span class="comment"># 均匀分布</span></span><br><span class="line">        <span class="string">&#x27;profit&#x27;</span>: np.random.lognormal(<span class="number">5</span>, <span class="number">1</span>, <span class="number">100</span>).clip(-<span class="number">100</span>, <span class="number">10000</span>),  <span class="comment"># 对数正态分布</span></span><br><span class="line">        <span class="string">&#x27;customer_count&#x27;</span>: np.random.poisson(<span class="number">500</span>, <span class="number">100</span>)  <span class="comment"># 泊松分布</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 添加一些异常值</span></span><br><span class="line">    data[<span class="string">&#x27;price&#x27;</span>][<span class="number">0</span>] = <span class="number">5000</span>  <span class="comment"># 高异常值</span></span><br><span class="line">    data[<span class="string">&#x27;sales_volume&#x27;</span>][<span class="number">1</span>] = -<span class="number">100</span>  <span class="comment"># 负异常值</span></span><br><span class="line">    data[<span class="string">&#x27;rating&#x27;</span>][<span class="number">2</span>] = <span class="number">10</span>  <span class="comment"># 超出范围的异常值</span></span><br><span class="line">    </span><br><span class="line">    df = pd.DataFrame(data)</span><br><span class="line">    df.to_csv(<span class="string">&#x27;product_data.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;测试数据已保存到 &#x27;product_data.csv&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_original_data</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;分析原始数据的分布和统计特性&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;原始数据分析:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 基本统计信息</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n原始数据基本统计:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(df.describe())</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 选择数值列</span></span><br><span class="line">    numeric_columns = df.select_dtypes(include=[np.number]).columns</span><br><span class="line">    numeric_columns = [col <span class="keyword">for</span> col <span class="keyword">in</span> numeric_columns <span class="keyword">if</span> col != <span class="string">&#x27;product_id&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n数值型列: <span class="subst">&#123;<span class="built_in">list</span>(numeric_columns)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查缺失值</span></span><br><span class="line">    missing_values = df[numeric_columns].isnull().<span class="built_in">sum</span>()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n缺失值统计:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> col, count <span class="keyword">in</span> missing_values.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;col&#125;</span>: <span class="subst">&#123;count&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> numeric_columns</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">min_max_normalization</span>(<span class="params">df, columns</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    最小-最大归一化</span></span><br><span class="line"><span class="string">    将数据缩放到[0, 1]范围</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;最小-最大归一化:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    df_normalized = df.copy()</span><br><span class="line">    scaler = MinMaxScaler()</span><br><span class="line">    </span><br><span class="line">    normalized_data = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> columns:</span><br><span class="line">        <span class="comment"># 处理异常值（在归一化前处理负值和超出范围的值）</span></span><br><span class="line">        original_data = df[col].values.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 使用sklearn的MinMaxScaler</span></span><br><span class="line">        normalized_col = scaler.fit_transform(original_data)</span><br><span class="line">        normalized_col_name = <span class="string">f&quot;<span class="subst">&#123;col&#125;</span>_minmax&quot;</span></span><br><span class="line">        df_normalized[normalized_col_name] = normalized_col.flatten()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 记录转换信息</span></span><br><span class="line">        min_val = df[col].<span class="built_in">min</span>()</span><br><span class="line">        max_val = df[col].<span class="built_in">max</span>()</span><br><span class="line">        normalized_data[col] = &#123;</span><br><span class="line">            <span class="string">&#x27;min&#x27;</span>: min_val,</span><br><span class="line">            <span class="string">&#x27;max&#x27;</span>: max_val,</span><br><span class="line">            <span class="string">&#x27;normalized_min&#x27;</span>: normalized_col.<span class="built_in">min</span>(),</span><br><span class="line">            <span class="string">&#x27;normalized_max&#x27;</span>: normalized_col.<span class="built_in">max</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;col&#125;</span>: 原始范围 [<span class="subst">&#123;min_val:<span class="number">.2</span>f&#125;</span>, <span class="subst">&#123;max_val:<span class="number">.2</span>f&#125;</span>] → 归一化范围 [0, 1]&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示部分归一化结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n归一化结果示例 (前5行):&quot;</span>)</span><br><span class="line">    normalized_columns = [<span class="string">f&quot;<span class="subst">&#123;col&#125;</span>_minmax&quot;</span> <span class="keyword">for</span> col <span class="keyword">in</span> columns]</span><br><span class="line">    <span class="built_in">print</span>(df_normalized[[<span class="string">&#x27;product_id&#x27;</span>] + normalized_columns].head())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_normalized, normalized_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">z_score_standardization</span>(<span class="params">df, columns</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Z-score标准化</span></span><br><span class="line"><span class="string">    将数据转换为均值为0，标准差为1的分布</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Z-score标准化:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    df_standardized = df.copy()</span><br><span class="line">    scaler = StandardScaler()</span><br><span class="line">    </span><br><span class="line">    standardization_data = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> columns:</span><br><span class="line">        original_data = df[col].values.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 使用sklearn的StandardScaler</span></span><br><span class="line">        standardized_col = scaler.fit_transform(original_data)</span><br><span class="line">        standardized_col_name = <span class="string">f&quot;<span class="subst">&#123;col&#125;</span>_zscore&quot;</span></span><br><span class="line">        df_standardized[standardized_col_name] = standardized_col.flatten()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 记录转换信息</span></span><br><span class="line">        mean_val = df[col].mean()</span><br><span class="line">        std_val = df[col].std()</span><br><span class="line">        standardization_data[col] = &#123;</span><br><span class="line">            <span class="string">&#x27;mean&#x27;</span>: mean_val,</span><br><span class="line">            <span class="string">&#x27;std&#x27;</span>: std_val,</span><br><span class="line">            <span class="string">&#x27;standardized_mean&#x27;</span>: standardized_col.mean(),</span><br><span class="line">            <span class="string">&#x27;standardized_std&#x27;</span>: standardized_col.std()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;col&#125;</span>: 原始分布 (均值=<span class="subst">&#123;mean_val:<span class="number">.2</span>f&#125;</span>, 标准差=<span class="subst">&#123;std_val:<span class="number">.2</span>f&#125;</span>) → 标准化分布 (均值≈0, 标准差≈1)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示部分标准化结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n标准化结果示例 (前5行):&quot;</span>)</span><br><span class="line">    standardized_columns = [<span class="string">f&quot;<span class="subst">&#123;col&#125;</span>_zscore&quot;</span> <span class="keyword">for</span> col <span class="keyword">in</span> columns]</span><br><span class="line">    <span class="built_in">print</span>(df_standardized[[<span class="string">&#x27;product_id&#x27;</span>] + standardized_columns].head())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_standardized, standardization_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decimal_scaling_normalization</span>(<span class="params">df, columns</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    小数定标标准化</span></span><br><span class="line"><span class="string">    通过移动小数点位置进行标准化</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;小数定标标准化:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    df_decimal = df.copy()</span><br><span class="line">    decimal_data = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> columns:</span><br><span class="line">        original_data = df[col].values</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 计算每个值所需的小数点移动位数</span></span><br><span class="line">        max_abs_val = np.<span class="built_in">max</span>(np.<span class="built_in">abs</span>(original_data))</span><br><span class="line">        <span class="keyword">if</span> max_abs_val == <span class="number">0</span>:</span><br><span class="line">            k = <span class="number">1</span>  <span class="comment"># 避免除以0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            k = np.ceil(np.log10(max_abs_val))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 应用小数定标标准化</span></span><br><span class="line">        decimal_col = original_data / (<span class="number">10</span> ** k)</span><br><span class="line">        decimal_col_name = <span class="string">f&quot;<span class="subst">&#123;col&#125;</span>_decimal&quot;</span></span><br><span class="line">        df_decimal[decimal_col_name] = decimal_col</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 记录转换信息</span></span><br><span class="line">        decimal_data[col] = &#123;</span><br><span class="line">            <span class="string">&#x27;max_absolute&#x27;</span>: max_abs_val,</span><br><span class="line">            <span class="string">&#x27;k_value&#x27;</span>: k,</span><br><span class="line">            <span class="string">&#x27;divisor&#x27;</span>: <span class="number">10</span> ** k,</span><br><span class="line">            <span class="string">&#x27;decimal_min&#x27;</span>: decimal_col.<span class="built_in">min</span>(),</span><br><span class="line">            <span class="string">&#x27;decimal_max&#x27;</span>: decimal_col.<span class="built_in">max</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;col&#125;</span>: 最大绝对值=<span class="subst">&#123;max_abs_val:<span class="number">.2</span>f&#125;</span>, k=<span class="subst">&#123;k&#125;</span>, 除数=<span class="subst">&#123;<span class="number">10</span>**k:<span class="number">.0</span>f&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;      标准化范围: [<span class="subst">&#123;decimal_col.<span class="built_in">min</span>():<span class="number">.4</span>f&#125;</span>, <span class="subst">&#123;decimal_col.<span class="built_in">max</span>():<span class="number">.4</span>f&#125;</span>]&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示部分小数定标标准化结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n小数定标标准化结果示例 (前5行):&quot;</span>)</span><br><span class="line">    decimal_columns = [<span class="string">f&quot;<span class="subst">&#123;col&#125;</span>_decimal&quot;</span> <span class="keyword">for</span> col <span class="keyword">in</span> columns]</span><br><span class="line">    <span class="built_in">print</span>(df_decimal[[<span class="string">&#x27;product_id&#x27;</span>] + decimal_columns].head())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_decimal, decimal_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compare_normalization_methods</span>(<span class="params">df, numeric_columns</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;比较不同标准化方法的结果&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;标准化方法比较:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    comparison_data = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> numeric_columns:</span><br><span class="line">        original_range = <span class="string">f&quot;[<span class="subst">&#123;df[col].<span class="built_in">min</span>():<span class="number">.2</span>f&#125;</span>, <span class="subst">&#123;df[col].<span class="built_in">max</span>():<span class="number">.2</span>f&#125;</span>]&quot;</span></span><br><span class="line">        original_mean_std = <span class="string">f&quot;μ=<span class="subst">&#123;df[col].mean():<span class="number">.2</span>f&#125;</span>, σ=<span class="subst">&#123;df[col].std():<span class="number">.2</span>f&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        minmax_range = <span class="string">f&quot;[<span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_minmax&#x27;</span>].<span class="built_in">min</span>():<span class="number">.4</span>f&#125;</span>, <span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_minmax&#x27;</span>].<span class="built_in">max</span>():<span class="number">.4</span>f&#125;</span>]&quot;</span></span><br><span class="line">        minmax_mean_std = <span class="string">f&quot;μ=<span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_minmax&#x27;</span>].mean():<span class="number">.4</span>f&#125;</span>, σ=<span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_minmax&#x27;</span>].std():<span class="number">.4</span>f&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        zscore_range = <span class="string">f&quot;[<span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_zscore&#x27;</span>].<span class="built_in">min</span>():<span class="number">.4</span>f&#125;</span>, <span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_zscore&#x27;</span>].<span class="built_in">max</span>():<span class="number">.4</span>f&#125;</span>]&quot;</span></span><br><span class="line">        zscore_mean_std = <span class="string">f&quot;μ=<span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_zscore&#x27;</span>].mean():<span class="number">.4</span>f&#125;</span>, σ=<span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_zscore&#x27;</span>].std():<span class="number">.4</span>f&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        decimal_range = <span class="string">f&quot;[<span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_decimal&#x27;</span>].<span class="built_in">min</span>():<span class="number">.4</span>f&#125;</span>, <span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_decimal&#x27;</span>].<span class="built_in">max</span>():<span class="number">.4</span>f&#125;</span>]&quot;</span></span><br><span class="line">        decimal_mean_std = <span class="string">f&quot;μ=<span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_decimal&#x27;</span>].mean():<span class="number">.4</span>f&#125;</span>, σ=<span class="subst">&#123;df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_decimal&#x27;</span>].std():<span class="number">.4</span>f&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        comparison_data.append(&#123;</span><br><span class="line">            <span class="string">&#x27;Column&#x27;</span>: col,</span><br><span class="line">            <span class="string">&#x27;Original&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;original_range&#125;</span>\n<span class="subst">&#123;original_mean_std&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;Min-Max&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;minmax_range&#125;</span>\n<span class="subst">&#123;minmax_mean_std&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;Z-Score&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;zscore_range&#125;</span>\n<span class="subst">&#123;zscore_mean_std&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;Decimal&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;decimal_range&#125;</span>\n<span class="subst">&#123;decimal_mean_std&#125;</span>&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    comparison_df = pd.DataFrame(comparison_data)</span><br><span class="line">    <span class="built_in">print</span>(comparison_df.to_string(index=<span class="literal">False</span>, max_colwidth=<span class="number">30</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">visualize_normalization</span>(<span class="params">df, numeric_columns</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;可视化标准化前后的数据分布&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;生成数据分布可视化...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 设置图形样式</span></span><br><span class="line">    plt.style.use(<span class="string">&#x27;default&#x27;</span>)</span><br><span class="line">    fig, axes = plt.subplots(<span class="built_in">len</span>(numeric_columns), <span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">5</span>*<span class="built_in">len</span>(numeric_columns)))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(numeric_columns) == <span class="number">1</span>:</span><br><span class="line">        axes = axes.reshape(<span class="number">1</span>, -<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, col <span class="keyword">in</span> <span class="built_in">enumerate</span>(numeric_columns):</span><br><span class="line">        <span class="comment"># 原始数据</span></span><br><span class="line">        axes[i, <span class="number">0</span>].hist(df[col], bins=<span class="number">20</span>, alpha=<span class="number">0.7</span>, color=<span class="string">&#x27;skyblue&#x27;</span>, edgecolor=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">0</span>].set_title(<span class="string">f&#x27;Original <span class="subst">&#123;col&#125;</span>&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">0</span>].set_xlabel(<span class="string">&#x27;Value&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">0</span>].set_ylabel(<span class="string">&#x27;Frequency&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 最小-最大归一化</span></span><br><span class="line">        axes[i, <span class="number">1</span>].hist(df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_minmax&#x27;</span>], bins=<span class="number">20</span>, alpha=<span class="number">0.7</span>, color=<span class="string">&#x27;lightgreen&#x27;</span>, edgecolor=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">1</span>].set_title(<span class="string">f&#x27;Min-Max <span class="subst">&#123;col&#125;</span>&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">1</span>].set_xlabel(<span class="string">&#x27;Normalized Value&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">1</span>].set_ylabel(<span class="string">&#x27;Frequency&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Z-score标准化</span></span><br><span class="line">        axes[i, <span class="number">2</span>].hist(df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_zscore&#x27;</span>], bins=<span class="number">20</span>, alpha=<span class="number">0.7</span>, color=<span class="string">&#x27;lightcoral&#x27;</span>, edgecolor=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">2</span>].set_title(<span class="string">f&#x27;Z-Score <span class="subst">&#123;col&#125;</span>&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">2</span>].set_xlabel(<span class="string">&#x27;Standardized Value&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">2</span>].set_ylabel(<span class="string">&#x27;Frequency&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 小数定标标准化</span></span><br><span class="line">        axes[i, <span class="number">3</span>].hist(df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_decimal&#x27;</span>], bins=<span class="number">20</span>, alpha=<span class="number">0.7</span>, color=<span class="string">&#x27;gold&#x27;</span>, edgecolor=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">3</span>].set_title(<span class="string">f&#x27;Decimal Scaling <span class="subst">&#123;col&#125;</span>&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">3</span>].set_xlabel(<span class="string">&#x27;Decimal Scaled Value&#x27;</span>)</span><br><span class="line">        axes[i, <span class="number">3</span>].set_ylabel(<span class="string">&#x27;Frequency&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    plt.tight_layout()</span><br><span class="line">    plt.savefig(<span class="string">&#x27;normalization_comparison.png&#x27;</span>, dpi=<span class="number">300</span>, bbox_inches=<span class="string">&#x27;tight&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;可视化图表已保存到 &#x27;normalization_comparison.png&#x27;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建箱线图比较</span></span><br><span class="line">    plt.figure(figsize=(<span class="number">15</span>, <span class="number">8</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 为每个数值列创建子图</span></span><br><span class="line">    <span class="keyword">for</span> i, col <span class="keyword">in</span> <span class="built_in">enumerate</span>(numeric_columns):</span><br><span class="line">        plt.subplot(<span class="number">2</span>, <span class="number">3</span>, i+<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 准备比较数据</span></span><br><span class="line">        comparison_data = [</span><br><span class="line">            df[col],</span><br><span class="line">            df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_minmax&#x27;</span>],</span><br><span class="line">            df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_zscore&#x27;</span>],</span><br><span class="line">            df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_decimal&#x27;</span>]</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        plt.boxplot(comparison_data, labels=[<span class="string">&#x27;Original&#x27;</span>, <span class="string">&#x27;Min-Max&#x27;</span>, <span class="string">&#x27;Z-Score&#x27;</span>, <span class="string">&#x27;Decimal&#x27;</span>])</span><br><span class="line">        plt.title(<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span> Distribution Comparison&#x27;</span>)</span><br><span class="line">        plt.xticks(rotation=<span class="number">45</span>)</span><br><span class="line">    </span><br><span class="line">    plt.tight_layout()</span><br><span class="line">    plt.savefig(<span class="string">&#x27;normalization_boxplots.png&#x27;</span>, dpi=<span class="number">300</span>, bbox_inches=<span class="string">&#x27;tight&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;箱线图比较已保存到 &#x27;normalization_boxplots.png&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evaluate_normalization_quality</span>(<span class="params">df, numeric_columns</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;评估标准化质量&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;标准化质量评估:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    evaluation_data = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> numeric_columns:</span><br><span class="line">        <span class="comment"># 原始数据的变异系数</span></span><br><span class="line">        original_cv = df[col].std() / df[col].mean() <span class="keyword">if</span> df[col].mean() != <span class="number">0</span> <span class="keyword">else</span> np.inf</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 评估最小-最大归一化</span></span><br><span class="line">        minmax_range = df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_minmax&#x27;</span>].<span class="built_in">max</span>() - df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_minmax&#x27;</span>].<span class="built_in">min</span>()</span><br><span class="line">        minmax_cv = df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_minmax&#x27;</span>].std() / df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_minmax&#x27;</span>].mean() <span class="keyword">if</span> df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_minmax&#x27;</span>].mean() != <span class="number">0</span> <span class="keyword">else</span> np.inf</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 评估Z-score标准化</span></span><br><span class="line">        zscore_mean = <span class="built_in">abs</span>(df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_zscore&#x27;</span>].mean())</span><br><span class="line">        zscore_std = df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_zscore&#x27;</span>].std()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 评估小数定标标准化</span></span><br><span class="line">        decimal_cv = df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_decimal&#x27;</span>].std() / df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_decimal&#x27;</span>].mean() <span class="keyword">if</span> df[<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span>_decimal&#x27;</span>].mean() != <span class="number">0</span> <span class="keyword">else</span> np.inf</span><br><span class="line">        </span><br><span class="line">        evaluation_data.append(&#123;</span><br><span class="line">            <span class="string">&#x27;Column&#x27;</span>: col,</span><br><span class="line">            <span class="string">&#x27;Original_CV&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;original_cv:<span class="number">.4</span>f&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;MinMax_Range&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;minmax_range:<span class="number">.4</span>f&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;MinMax_CV&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;minmax_cv:<span class="number">.4</span>f&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;ZScore_Mean_Abs&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;zscore_mean:<span class="number">.4</span>f&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;ZScore_Std&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;zscore_std:<span class="number">.4</span>f&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;Decimal_CV&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;decimal_cv:<span class="number">.4</span>f&#125;</span>&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    evaluation_df = pd.DataFrame(evaluation_data)</span><br><span class="line">    <span class="built_in">print</span>(evaluation_df.to_string(index=<span class="literal">False</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 质量总结</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n标准化质量总结:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;- Min-Max归一化: 适合需要固定范围[0,1]的场景&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;- Z-Score标准化: 适合需要标准正态分布的场景&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;- 小数定标标准化: 适合保持原始数据分布形状的场景&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_normalized_data</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;保存标准化后的数据&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 保存完整的标准化数据</span></span><br><span class="line">    df.to_csv(<span class="string">&#x27;product_data_normalized.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n完整标准化数据已保存到 &#x27;product_data_normalized.csv&#x27;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存仅包含标准化列的数据</span></span><br><span class="line">    normalized_columns = [col <span class="keyword">for</span> col <span class="keyword">in</span> df.columns <span class="keyword">if</span> <span class="built_in">any</span>(x <span class="keyword">in</span> col <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">&#x27;_minmax&#x27;</span>, <span class="string">&#x27;_zscore&#x27;</span>, <span class="string">&#x27;_decimal&#x27;</span>])]</span><br><span class="line">    normalized_df = df[[<span class="string">&#x27;product_id&#x27;</span>] + normalized_columns]</span><br><span class="line">    normalized_df.to_csv(<span class="string">&#x27;normalized_columns_only.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;仅标准化列数据已保存到 &#x27;normalized_columns_only.csv&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数值型数据标准化脚本&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建测试数据</span></span><br><span class="line">    df = create_test_data()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 分析原始数据</span></span><br><span class="line">    numeric_columns = analyze_original_data(df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 执行三种标准化</span></span><br><span class="line">    df, minmax_data = min_max_normalization(df, numeric_columns)</span><br><span class="line">    df, zscore_data = z_score_standardization(df, numeric_columns)</span><br><span class="line">    df, decimal_data = decimal_scaling_normalization(df, numeric_columns)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 比较不同方法</span></span><br><span class="line">    compare_normalization_methods(df, numeric_columns)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 评估标准化质量</span></span><br><span class="line">    evaluate_normalization_quality(df, numeric_columns)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 可视化结果</span></span><br><span class="line">    visualize_normalization(df, numeric_columns)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存结果</span></span><br><span class="line">    save_normalized_data(df)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据标准化完成!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li></ol><h2 id="高级题目"><a href="#高级题目" class="headerlink" title="高级题目"></a>高级题目</h2><ol><li><h3 id="多源数据整合"><a href="#多源数据整合" class="headerlink" title="多源数据整合"></a>多源数据整合</h3><ul><li>编写脚本整合来自CSV、Excel和JSON三个不同来源的数据：<ul><li>统一列名和数据类型</li><li>处理时间窗口重叠</li><li>合并后去重</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_test_data</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建CSV、Excel和JSON三个不同来源的测试数据&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># CSV数据 (第一季度)</span></span><br><span class="line">    csv_data = &#123;</span><br><span class="line">        <span class="string">&#x27;order_id&#x27;</span>: [<span class="string">&#x27;Q1-1001&#x27;</span>, <span class="string">&#x27;Q1-1002&#x27;</span>, <span class="string">&#x27;Q1-1003&#x27;</span>, <span class="string">&#x27;Q1-1004&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;customer_id&#x27;</span>: [<span class="string">&#x27;C001&#x27;</span>, <span class="string">&#x27;C002&#x27;</span>, <span class="string">&#x27;C003&#x27;</span>, <span class="string">&#x27;C001&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;product_name&#x27;</span>: [<span class="string">&#x27;产品A&#x27;</span>, <span class="string">&#x27;产品B&#x27;</span>, <span class="string">&#x27;产品C&#x27;</span>, <span class="string">&#x27;产品A&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;amount&#x27;</span>: [<span class="number">299.0</span>, <span class="number">899.0</span>, <span class="number">1599.0</span>, <span class="number">299.0</span>],</span><br><span class="line">        <span class="string">&#x27;order_date&#x27;</span>: [<span class="string">&#x27;2023-01-15&#x27;</span>, <span class="string">&#x27;2023-02-20&#x27;</span>, <span class="string">&#x27;2023-03-10&#x27;</span>, <span class="string">&#x27;2023-03-25&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;region&#x27;</span>: [<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    csv_df = pd.DataFrame(csv_data)</span><br><span class="line">    csv_df.to_csv(<span class="string">&#x27;sales_q1.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Excel数据 (第二季度) - 列名和格式不同</span></span><br><span class="line">    excel_data = &#123;</span><br><span class="line">        <span class="string">&#x27;订单ID&#x27;</span>: [<span class="string">&#x27;Q2-1001&#x27;</span>, <span class="string">&#x27;Q2-1002&#x27;</span>, <span class="string">&#x27;Q2-1003&#x27;</span>, <span class="string">&#x27;Q2-1004&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;客户ID&#x27;</span>: [<span class="string">&#x27;C003&#x27;</span>, <span class="string">&#x27;C004&#x27;</span>, <span class="string">&#x27;C001&#x27;</span>, <span class="string">&#x27;C002&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;产品名称&#x27;</span>: [<span class="string">&#x27;产品C&#x27;</span>, <span class="string">&#x27;产品D&#x27;</span>, <span class="string">&#x27;产品A&#x27;</span>, <span class="string">&#x27;产品B&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;金额&#x27;</span>: [<span class="number">1599.0</span>, <span class="number">499.0</span>, <span class="number">299.0</span>, <span class="number">899.0</span>],</span><br><span class="line">        <span class="string">&#x27;下单日期&#x27;</span>: [<span class="string">&#x27;2023-04-10&#x27;</span>, <span class="string">&#x27;2023-05-15&#x27;</span>, <span class="string">&#x27;2023-06-20&#x27;</span>, <span class="string">&#x27;2023-06-25&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;地区&#x27;</span>: [<span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;深圳&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    excel_df = pd.DataFrame(excel_data)</span><br><span class="line">    excel_df.to_excel(<span class="string">&#x27;sales_q2.xlsx&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># JSON数据 (第三季度) - 结构和格式不同</span></span><br><span class="line">    json_data = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;order_id&quot;</span>: <span class="string">&quot;Q3-1001&quot;</span>,</span><br><span class="line">            <span class="string">&quot;customer_id&quot;</span>: <span class="string">&quot;C002&quot;</span>,</span><br><span class="line">            <span class="string">&quot;product&quot;</span>: <span class="string">&quot;产品B&quot;</span>,</span><br><span class="line">            <span class="string">&quot;price&quot;</span>: <span class="number">899.0</span>,</span><br><span class="line">            <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2023-07-20&quot;</span>,</span><br><span class="line">            <span class="string">&quot;location&quot;</span>: <span class="string">&quot;上海&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;order_id&quot;</span>: <span class="string">&quot;Q3-1002&quot;</span>,</span><br><span class="line">            <span class="string">&quot;customer_id&quot;</span>: <span class="string">&quot;C004&quot;</span>,</span><br><span class="line">            <span class="string">&quot;product&quot;</span>: <span class="string">&quot;产品D&quot;</span>,</span><br><span class="line">            <span class="string">&quot;price&quot;</span>: <span class="number">499.0</span>,</span><br><span class="line">            <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2023-08-15&quot;</span>,</span><br><span class="line">            <span class="string">&quot;location&quot;</span>: <span class="string">&quot;深圳&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;order_id&quot;</span>: <span class="string">&quot;Q3-1003&quot;</span>,</span><br><span class="line">            <span class="string">&quot;customer_id&quot;</span>: <span class="string">&quot;C005&quot;</span>,</span><br><span class="line">            <span class="string">&quot;product&quot;</span>: <span class="string">&quot;产品E&quot;</span>,</span><br><span class="line">            <span class="string">&quot;price&quot;</span>: <span class="number">1299.0</span>,</span><br><span class="line">            <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2023-09-10&quot;</span>,</span><br><span class="line">            <span class="string">&quot;location&quot;</span>: <span class="string">&quot;杭州&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;order_id&quot;</span>: <span class="string">&quot;Q3-1004&quot;</span>,  <span class="comment"># 重复订单，用于测试去重</span></span><br><span class="line">            <span class="string">&quot;customer_id&quot;</span>: <span class="string">&quot;C001&quot;</span>,</span><br><span class="line">            <span class="string">&quot;product&quot;</span>: <span class="string">&quot;产品A&quot;</span>,</span><br><span class="line">            <span class="string">&quot;price&quot;</span>: <span class="number">299.0</span>,</span><br><span class="line">            <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2023-09-20&quot;</span>,</span><br><span class="line">            <span class="string">&quot;location&quot;</span>: <span class="string">&quot;北京&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;sales_q3.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(json_data, f, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;测试数据已创建:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  - sales_q1.csv (CSV格式)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  - sales_q2.xlsx (Excel格式)&quot;</span>) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  - sales_q3.json (JSON格式)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> csv_df, excel_df, pd.DataFrame(json_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_multi_source_data</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;从CSV、Excel、JSON三个来源加载数据&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;加载多源数据:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    data_sources = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 加载CSV数据</span></span><br><span class="line">        csv_df = pd.read_csv(<span class="string">&#x27;sales_q1.csv&#x27;</span>)</span><br><span class="line">        data_sources[<span class="string">&#x27;csv&#x27;</span>] = &#123;</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span>: csv_df,</span><br><span class="line">            <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;sales_q1.csv&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;CSV&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;CSV数据加载成功: <span class="subst">&#123;<span class="built_in">len</span>(csv_df)&#125;</span> 条记录&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;CSV列名: <span class="subst">&#123;<span class="built_in">list</span>(csv_df.columns)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;CSV数据加载失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 加载Excel数据</span></span><br><span class="line">        excel_df = pd.read_excel(<span class="string">&#x27;sales_q2.xlsx&#x27;</span>)</span><br><span class="line">        data_sources[<span class="string">&#x27;excel&#x27;</span>] = &#123;</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span>: excel_df,</span><br><span class="line">            <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;sales_q2.xlsx&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;Excel&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Excel数据加载成功: <span class="subst">&#123;<span class="built_in">len</span>(excel_df)&#125;</span> 条记录&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Excel列名: <span class="subst">&#123;<span class="built_in">list</span>(excel_df.columns)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Excel数据加载失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 加载JSON数据</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;sales_q3.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json_data = json.load(f)</span><br><span class="line">        json_df = pd.DataFrame(json_data)</span><br><span class="line">        data_sources[<span class="string">&#x27;json&#x27;</span>] = &#123;</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span>: json_df,</span><br><span class="line">            <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;sales_q3.json&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;JSON&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;JSON数据加载成功: <span class="subst">&#123;<span class="built_in">len</span>(json_df)&#125;</span> 条记录&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;JSON列名: <span class="subst">&#123;<span class="built_in">list</span>(json_df.columns)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;JSON数据加载失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data_sources</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_source_data</span>(<span class="params">data_sources</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;分析各数据源的结构和内容&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据源分析:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> source_name, source_info <span class="keyword">in</span> data_sources.items():</span><br><span class="line">        df = source_info[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;source_info[<span class="string">&#x27;format&#x27;</span>]&#125;</span>数据 (<span class="subst">&#123;source_info[<span class="string">&#x27;source&#x27;</span>]&#125;</span>):&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  记录数: <span class="subst">&#123;<span class="built_in">len</span>(df)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  列数: <span class="subst">&#123;<span class="built_in">len</span>(df.columns)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  数据类型:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> col, dtype <span class="keyword">in</span> df.dtypes.items():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    <span class="subst">&#123;col&#125;</span>: <span class="subst">&#123;dtype&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  前3行数据:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(df.head(<span class="number">3</span>).to_string(index=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unify_column_names</span>(<span class="params">data_sources</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;统一各数据源的列名&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;统一列名:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 定义标准列名映射</span></span><br><span class="line">    column_mapping = &#123;</span><br><span class="line">        <span class="comment"># CSV列名映射 (已经是标准格式)</span></span><br><span class="line">        <span class="string">&#x27;order_id&#x27;</span>: <span class="string">&#x27;order_id&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;customer_id&#x27;</span>: <span class="string">&#x27;customer_id&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;product_name&#x27;</span>: <span class="string">&#x27;product&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;amount&#x27;</span>: <span class="string">&#x27;amount&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;order_date&#x27;</span>: <span class="string">&#x27;order_date&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;region&#x27;</span>: <span class="string">&#x27;region&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Excel列名映射</span></span><br><span class="line">        <span class="string">&#x27;订单ID&#x27;</span>: <span class="string">&#x27;order_id&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;客户ID&#x27;</span>: <span class="string">&#x27;customer_id&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;产品名称&#x27;</span>: <span class="string">&#x27;product&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;金额&#x27;</span>: <span class="string">&#x27;amount&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;下单日期&#x27;</span>: <span class="string">&#x27;order_date&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;地区&#x27;</span>: <span class="string">&#x27;region&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># JSON列名映射</span></span><br><span class="line">        <span class="string">&#x27;price&#x27;</span>: <span class="string">&#x27;amount&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;order_date&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;location&#x27;</span>: <span class="string">&#x27;region&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    unified_data = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> source_name, source_info <span class="keyword">in</span> data_sources.items():</span><br><span class="line">        df = source_info[<span class="string">&#x27;data&#x27;</span>].copy()</span><br><span class="line">        original_columns = <span class="built_in">list</span>(df.columns)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 应用列名映射</span></span><br><span class="line">        df.rename(columns=column_mapping, inplace=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 确保所有数据源都有相同的列</span></span><br><span class="line">        expected_columns = [<span class="string">&#x27;order_id&#x27;</span>, <span class="string">&#x27;customer_id&#x27;</span>, <span class="string">&#x27;product&#x27;</span>, <span class="string">&#x27;amount&#x27;</span>, <span class="string">&#x27;order_date&#x27;</span>, <span class="string">&#x27;region&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> expected_columns:</span><br><span class="line">            <span class="keyword">if</span> col <span class="keyword">not</span> <span class="keyword">in</span> df.columns:</span><br><span class="line">                df[col] = <span class="literal">None</span>  <span class="comment"># 添加缺失列</span></span><br><span class="line">        </span><br><span class="line">        unified_data[source_name] = &#123;</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span>: df[expected_columns],  <span class="comment"># 按标准顺序排列列</span></span><br><span class="line">            <span class="string">&#x27;source&#x27;</span>: source_info[<span class="string">&#x27;source&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;format&#x27;</span>: source_info[<span class="string">&#x27;format&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;original_columns&#x27;</span>: original_columns</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;source_info[<span class="string">&#x27;format&#x27;</span>]&#125;</span>数据列名统一:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  原始列名: <span class="subst">&#123;original_columns&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  统一后列名: <span class="subst">&#123;<span class="built_in">list</span>(df[expected_columns].columns)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> unified_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unify_data_types</span>(<span class="params">unified_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;统一各数据源的数据类型&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;统一数据类型:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> source_name, source_info <span class="keyword">in</span> unified_data.items():</span><br><span class="line">        df = source_info[<span class="string">&#x27;data&#x27;</span>].copy()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 记录原始数据类型</span></span><br><span class="line">        original_dtypes = df.dtypes.to_dict()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 统一数据类型</span></span><br><span class="line">        df[<span class="string">&#x27;order_id&#x27;</span>] = df[<span class="string">&#x27;order_id&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line">        df[<span class="string">&#x27;customer_id&#x27;</span>] = df[<span class="string">&#x27;customer_id&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line">        df[<span class="string">&#x27;product&#x27;</span>] = df[<span class="string">&#x27;product&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line">        df[<span class="string">&#x27;amount&#x27;</span>] = pd.to_numeric(df[<span class="string">&#x27;amount&#x27;</span>], errors=<span class="string">&#x27;coerce&#x27;</span>)</span><br><span class="line">        df[<span class="string">&#x27;order_date&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;order_date&#x27;</span>], errors=<span class="string">&#x27;coerce&#x27;</span>)</span><br><span class="line">        df[<span class="string">&#x27;region&#x27;</span>] = df[<span class="string">&#x27;region&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新数据</span></span><br><span class="line">        unified_data[source_name][<span class="string">&#x27;data&#x27;</span>] = df</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;source_info[<span class="string">&#x27;format&#x27;</span>]&#125;</span>数据类型统一:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> df.columns:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;col&#125;</span>: <span class="subst">&#123;original_dtypes[col]&#125;</span> → <span class="subst">&#123;df[col].dtype&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> unified_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge_data_sources</span>(<span class="params">unified_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;合并所有数据源&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;合并数据源:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 合并所有数据</span></span><br><span class="line">    all_data = []</span><br><span class="line">    source_info_list = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> source_name, source_info <span class="keyword">in</span> unified_data.items():</span><br><span class="line">        df = source_info[<span class="string">&#x27;data&#x27;</span>].copy()</span><br><span class="line">        df[<span class="string">&#x27;data_source&#x27;</span>] = source_info[<span class="string">&#x27;format&#x27;</span>]</span><br><span class="line">        df[<span class="string">&#x27;original_source&#x27;</span>] = source_info[<span class="string">&#x27;source&#x27;</span>]</span><br><span class="line">        all_data.append(df)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;添加 <span class="subst">&#123;source_info[<span class="string">&#x27;format&#x27;</span>]&#125;</span> 数据: <span class="subst">&#123;<span class="built_in">len</span>(df)&#125;</span> 条记录&quot;</span>)</span><br><span class="line">        source_info_list.append(&#123;</span><br><span class="line">            <span class="string">&#x27;source&#x27;</span>: source_info[<span class="string">&#x27;format&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;records&#x27;</span>: <span class="built_in">len</span>(df)</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 合并数据框</span></span><br><span class="line">    merged_df = pd.concat(all_data, ignore_index=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n合并后总记录数: <span class="subst">&#123;<span class="built_in">len</span>(merged_df)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;合并后列名: <span class="subst">&#123;<span class="built_in">list</span>(merged_df.columns)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> merged_df, source_info_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detect_time_overlaps</span>(<span class="params">df, time_column=<span class="string">&#x27;order_date&#x27;</span>, group_columns=[<span class="string">&#x27;customer_id&#x27;</span>, <span class="string">&#x27;product&#x27;</span>]</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检测时间窗口重叠&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;检测时间窗口重叠:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 确保日期列是datetime类型</span></span><br><span class="line">    df[time_column] = pd.to_datetime(df[time_column])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 按客户和产品分组，检查时间重叠</span></span><br><span class="line">    overlaps_detected = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (customer, product), group <span class="keyword">in</span> df.groupby(group_columns):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(group) &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># 按时间排序</span></span><br><span class="line">            group = group.sort_values(time_column)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查连续订单之间的时间间隔</span></span><br><span class="line">            time_diffs = group[time_column].diff().dt.days</span><br><span class="line">            short_intervals = time_diffs[time_diffs &lt; <span class="number">30</span>]  <span class="comment"># 30天内视为可能重叠</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(short_intervals) &gt; <span class="number">0</span>:</span><br><span class="line">                overlaps_detected.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;customer_id&#x27;</span>: customer,</span><br><span class="line">                    <span class="string">&#x27;product&#x27;</span>: product,</span><br><span class="line">                    <span class="string">&#x27;records&#x27;</span>: <span class="built_in">len</span>(group),</span><br><span class="line">                    <span class="string">&#x27;date_range&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;group[time_column].<span class="built_in">min</span>().strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)&#125;</span> 至 <span class="subst">&#123;group[time_column].<span class="built_in">max</span>().strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)&#125;</span>&quot;</span>,</span><br><span class="line">                    <span class="string">&#x27;time_intervals&#x27;</span>: <span class="built_in">list</span>(time_diffs[time_diffs.notna()])</span><br><span class="line">                &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> overlaps_detected:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;发现时间窗口重叠:&quot;</span>)</span><br><span class="line">        overlap_df = pd.DataFrame(overlaps_detected)</span><br><span class="line">        <span class="built_in">print</span>(overlap_df.to_string(index=<span class="literal">False</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 显示重叠详情</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n重叠详情:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> overlap <span class="keyword">in</span> overlaps_detected:</span><br><span class="line">            customer_data = df[(df[<span class="string">&#x27;customer_id&#x27;</span>] == overlap[<span class="string">&#x27;customer_id&#x27;</span>]) &amp; </span><br><span class="line">                              (df[<span class="string">&#x27;product&#x27;</span>] == overlap[<span class="string">&#x27;product&#x27;</span>])]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n客户 <span class="subst">&#123;overlap[<span class="string">&#x27;customer_id&#x27;</span>]&#125;</span> - 产品 <span class="subst">&#123;overlap[<span class="string">&#x27;product&#x27;</span>]&#125;</span>:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(customer_data[[<span class="string">&#x27;order_id&#x27;</span>, <span class="string">&#x27;order_date&#x27;</span>, <span class="string">&#x27;amount&#x27;</span>, <span class="string">&#x27;data_source&#x27;</span>]].to_string(index=<span class="literal">False</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未发现时间窗口重叠&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> overlaps_detected</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_duplicates</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;处理重复数据&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;处理重复数据:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检测完全重复的记录</span></span><br><span class="line">    duplicate_mask = df.duplicated(subset=[<span class="string">&#x27;order_id&#x27;</span>, <span class="string">&#x27;customer_id&#x27;</span>, <span class="string">&#x27;product&#x27;</span>, <span class="string">&#x27;order_date&#x27;</span>, <span class="string">&#x27;amount&#x27;</span>])</span><br><span class="line">    complete_duplicates = df[duplicate_mask]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(complete_duplicates) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;发现 <span class="subst">&#123;<span class="built_in">len</span>(complete_duplicates)&#125;</span> 条完全重复记录:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(complete_duplicates[[<span class="string">&#x27;order_id&#x27;</span>, <span class="string">&#x27;customer_id&#x27;</span>, <span class="string">&#x27;product&#x27;</span>, <span class="string">&#x27;order_date&#x27;</span>, <span class="string">&#x27;data_source&#x27;</span>]].to_string(index=<span class="literal">False</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未发现完全重复记录&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检测基于订单ID的部分重复（不同数据源可能有相同订单）</span></span><br><span class="line">    order_id_duplicates = df[df.duplicated(subset=[<span class="string">&#x27;order_id&#x27;</span>], keep=<span class="literal">False</span>)]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(order_id_duplicates) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n发现 <span class="subst">&#123;<span class="built_in">len</span>(order_id_duplicates)&#125;</span> 条基于订单ID的重复记录:&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 按订单ID分组显示重复</span></span><br><span class="line">        <span class="keyword">for</span> order_id, group <span class="keyword">in</span> order_id_duplicates.groupby(<span class="string">&#x27;order_id&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(group) &gt; <span class="number">1</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n订单 <span class="subst">&#123;order_id&#125;</span> 的重复记录:&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(group[[<span class="string">&#x27;customer_id&#x27;</span>, <span class="string">&#x27;product&#x27;</span>, <span class="string">&#x27;order_date&#x27;</span>, <span class="string">&#x27;amount&#x27;</span>, <span class="string">&#x27;data_source&#x27;</span>]].to_string(index=<span class="literal">False</span>))</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 保留最新数据源的记录（假设JSON是最新的）</span></span><br><span class="line">                source_priority = &#123;<span class="string">&#x27;JSON&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;Excel&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;CSV&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line">                group[<span class="string">&#x27;source_priority&#x27;</span>] = group[<span class="string">&#x27;data_source&#x27;</span>].<span class="built_in">map</span>(source_priority)</span><br><span class="line">                keep_record = group.loc[group[<span class="string">&#x27;source_priority&#x27;</span>].idxmin()]</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;保留记录: <span class="subst">&#123;keep_record[<span class="string">&#x27;data_source&#x27;</span>]&#125;</span> 数据源&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 移除完全重复的记录</span></span><br><span class="line">    df_cleaned = df.drop_duplicates(subset=[<span class="string">&#x27;order_id&#x27;</span>, <span class="string">&#x27;customer_id&#x27;</span>, <span class="string">&#x27;product&#x27;</span>, <span class="string">&#x27;order_date&#x27;</span>, <span class="string">&#x27;amount&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 对于订单ID重复的记录，保留优先级最高的数据源</span></span><br><span class="line">    df_cleaned = df_cleaned.sort_values(<span class="string">&#x27;data_source&#x27;</span>, key=<span class="keyword">lambda</span> x: x.<span class="built_in">map</span>(&#123;<span class="string">&#x27;JSON&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;Excel&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;CSV&#x27;</span>: <span class="number">3</span>&#125;))</span><br><span class="line">    df_cleaned = df_cleaned.drop_duplicates(subset=[<span class="string">&#x27;order_id&#x27;</span>], keep=<span class="string">&#x27;first&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n去重前记录数: <span class="subst">&#123;<span class="built_in">len</span>(df)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;去重后记录数: <span class="subst">&#123;<span class="built_in">len</span>(df_cleaned)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;移除重复记录: <span class="subst">&#123;<span class="built_in">len</span>(df) - <span class="built_in">len</span>(df_cleaned)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_cleaned</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_merged_data</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;分析合并后的数据&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;合并数据统计分析:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 基本统计</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;总记录数: <span class="subst">&#123;<span class="built_in">len</span>(df)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;唯一客户数: <span class="subst">&#123;df[<span class="string">&#x27;customer_id&#x27;</span>].nunique()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;产品种类: <span class="subst">&#123;df[<span class="string">&#x27;product&#x27;</span>].nunique()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;地区数量: <span class="subst">&#123;df[<span class="string">&#x27;region&#x27;</span>].nunique()&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 数据源分布</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n数据源分布:&quot;</span>)</span><br><span class="line">    source_dist = df[<span class="string">&#x27;data_source&#x27;</span>].value_counts()</span><br><span class="line">    <span class="keyword">for</span> source, count <span class="keyword">in</span> source_dist.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;source&#125;</span>: <span class="subst">&#123;count&#125;</span> 条记录 (<span class="subst">&#123;count/<span class="built_in">len</span>(df)*<span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 时间范围</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n时间范围:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  最早订单: <span class="subst">&#123;df[<span class="string">&#x27;order_date&#x27;</span>].<span class="built_in">min</span>().strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  最晚订单: <span class="subst">&#123;df[<span class="string">&#x27;order_date&#x27;</span>].<span class="built_in">max</span>().strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  时间跨度: <span class="subst">&#123;(df[<span class="string">&#x27;order_date&#x27;</span>].<span class="built_in">max</span>() - df[<span class="string">&#x27;order_date&#x27;</span>].<span class="built_in">min</span>()).days&#125;</span> 天&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 金额统计</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n金额统计:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  总金额: <span class="subst">&#123;df[<span class="string">&#x27;amount&#x27;</span>].<span class="built_in">sum</span>():<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  平均金额: <span class="subst">&#123;df[<span class="string">&#x27;amount&#x27;</span>].mean():<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  最小金额: <span class="subst">&#123;df[<span class="string">&#x27;amount&#x27;</span>].<span class="built_in">min</span>():<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  最大金额: <span class="subst">&#123;df[<span class="string">&#x27;amount&#x27;</span>].<span class="built_in">max</span>():<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 热门产品</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n热门产品 (按销售次数):&quot;</span>)</span><br><span class="line">    product_counts = df[<span class="string">&#x27;product&#x27;</span>].value_counts()</span><br><span class="line">    <span class="keyword">for</span> product, count <span class="keyword">in</span> product_counts.items():</span><br><span class="line">        product_amount = df[df[<span class="string">&#x27;product&#x27;</span>] == product][<span class="string">&#x27;amount&#x27;</span>].<span class="built_in">sum</span>()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;product&#125;</span>: <span class="subst">&#123;count&#125;</span> 次, 总金额 <span class="subst">&#123;product_amount:<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 地区分布</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n地区分布:&quot;</span>)</span><br><span class="line">    region_counts = df[<span class="string">&#x27;region&#x27;</span>].value_counts()</span><br><span class="line">    <span class="keyword">for</span> region, count <span class="keyword">in</span> region_counts.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;region&#125;</span>: <span class="subst">&#123;count&#125;</span> 条记录&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_integrated_data</span>(<span class="params">df, output_file=<span class="string">&#x27;integrated_sales_data.csv&#x27;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;保存整合后的数据&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;保存整合数据:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存为CSV</span></span><br><span class="line">    df.to_csv(output_file, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;整合数据已保存到: <span class="subst">&#123;output_file&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存统计报告</span></span><br><span class="line">    report_file = <span class="string">&#x27;integration_report.txt&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(report_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">&quot;多源数据整合报告\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;=&quot;</span> * <span class="number">50</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;生成时间: <span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)&#125;</span>\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;总记录数: <span class="subst">&#123;<span class="built_in">len</span>(df)&#125;</span>\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;数据源: CSV, Excel, JSON\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;输出文件: <span class="subst">&#123;output_file&#125;</span>\n\n&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        f.write(<span class="string">&quot;数据源统计:\n&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> source, count <span class="keyword">in</span> df[<span class="string">&#x27;data_source&#x27;</span>].value_counts().items():</span><br><span class="line">            f.write(<span class="string">f&quot;  <span class="subst">&#123;source&#125;</span>: <span class="subst">&#123;count&#125;</span> 条记录\n&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;整合报告已保存到: <span class="subst">&#123;report_file&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;多源数据整合脚本&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建测试数据</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;创建测试数据...&quot;</span>)</span><br><span class="line">    create_test_data()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 加载多源数据</span></span><br><span class="line">    data_sources = load_multi_source_data()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data_sources:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;数据加载失败，请检查文件路径和格式&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 分析源数据</span></span><br><span class="line">    analyze_source_data(data_sources)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统一列名</span></span><br><span class="line">    unified_data = unify_column_names(data_sources)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统一数据类型</span></span><br><span class="line">    unified_data = unify_data_types(unified_data)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 合并数据</span></span><br><span class="line">    merged_df, source_info = merge_data_sources(unified_data)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检测时间重叠</span></span><br><span class="line">    overlaps = detect_time_overlaps(merged_df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理重复数据</span></span><br><span class="line">    final_df = handle_duplicates(merged_df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 分析整合后的数据</span></span><br><span class="line">    analyze_merged_data(final_df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存结果</span></span><br><span class="line">    save_integrated_data(final_df)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;多源数据整合完成!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li><li><h3 id="复杂规则清洗"><a href="#复杂规则清洗" class="headerlink" title="复杂规则清洗"></a>复杂规则清洗</h3><ul><li>编写脚本实现业务规则验证：<ul><li>验证身份证号格式和有效性</li><li>检查数据逻辑关系（如结束日期&gt;开始日期）</li><li>验证数据完整性约束</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_test_data</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建包含各种业务规则问题的测试数据&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>],</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;钱七&#x27;</span>, <span class="string">&#x27;孙八&#x27;</span>, <span class="string">&#x27;周九&#x27;</span>, <span class="string">&#x27;吴十&#x27;</span>, <span class="string">&#x27;郑十一&#x27;</span>, <span class="literal">None</span>],</span><br><span class="line">        <span class="string">&#x27;id_card&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;110101199001011234&#x27;</span>,  <span class="comment"># 有效</span></span><br><span class="line">            <span class="string">&#x27;11010119900101123X&#x27;</span>,  <span class="comment"># 有效，最后一位X</span></span><br><span class="line">            <span class="string">&#x27;123456789012345678&#x27;</span>,  <span class="comment"># 格式正确但校验码错误</span></span><br><span class="line">            <span class="string">&#x27;110101900101123&#x27;</span>,     <span class="comment"># 位数不足</span></span><br><span class="line">            <span class="string">&#x27;110101199013011234&#x27;</span>,  <span class="comment"># 月份错误</span></span><br><span class="line">            <span class="string">&#x27;110101199001321234&#x27;</span>,  <span class="comment"># 日期错误</span></span><br><span class="line">            <span class="string">&#x27;110101189001011234&#x27;</span>,  <span class="comment"># 年份太早</span></span><br><span class="line">            <span class="string">&#x27;110101210001011234&#x27;</span>,  <span class="comment"># 年份未来</span></span><br><span class="line">            <span class="string">&#x27;ABCDEFGHIJKLMNOPQR&#x27;</span>,  <span class="comment"># 包含字母</span></span><br><span class="line">            <span class="string">&#x27;110101199001011235&#x27;</span>   <span class="comment"># 校验码错误</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;start_date&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;2023-01-01&#x27;</span>, <span class="string">&#x27;2023-02-01&#x27;</span>, <span class="string">&#x27;2023-03-01&#x27;</span>, <span class="string">&#x27;2023-04-01&#x27;</span>, <span class="string">&#x27;2023-05-01&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;2023-06-01&#x27;</span>, <span class="string">&#x27;2023-07-01&#x27;</span>, <span class="string">&#x27;2023-08-01&#x27;</span>, <span class="string">&#x27;2023-09-01&#x27;</span>, <span class="string">&#x27;2023-10-01&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;end_date&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;2023-12-31&#x27;</span>, <span class="string">&#x27;2023-01-15&#x27;</span>,  <span class="comment"># 结束早于开始</span></span><br><span class="line">            <span class="string">&#x27;2023-06-30&#x27;</span>, <span class="string">&#x27;2023-03-15&#x27;</span>,  <span class="comment"># 结束早于开始</span></span><br><span class="line">            <span class="string">&#x27;2024-05-31&#x27;</span>, <span class="string">&#x27;2023-05-30&#x27;</span>,  <span class="comment"># 结束早于开始</span></span><br><span class="line">            <span class="string">&#x27;2024-07-31&#x27;</span>, <span class="string">&#x27;2023-07-15&#x27;</span>,  <span class="comment"># 结束早于开始</span></span><br><span class="line">            <span class="string">&#x27;2024-09-30&#x27;</span>, <span class="string">&#x27;2023-08-31&#x27;</span>   <span class="comment"># 结束早于开始</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>: [<span class="number">25</span>, <span class="number">30</span>, -<span class="number">5</span>, <span class="number">150</span>, <span class="number">35</span>, <span class="number">28</span>, <span class="number">42</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">26</span>],  <span class="comment"># 包含异常年龄</span></span><br><span class="line">        <span class="string">&#x27;salary&#x27;</span>: [<span class="number">5000</span>, <span class="number">8000</span>, <span class="number">12000</span>, -<span class="number">1000</span>, <span class="number">7500</span>, <span class="number">6000</span>, <span class="number">9500</span>, <span class="number">11000</span>, <span class="number">6800</span>, <span class="number">7200</span>],  <span class="comment"># 包含负工资</span></span><br><span class="line">        <span class="string">&#x27;department&#x27;</span>: [<span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="literal">None</span>, <span class="string">&#x27;人力资源部&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="string">&#x27;运营部&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;manager_id&#x27;</span>: [<span class="literal">None</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>],  <span class="comment"># 包含循环引用</span></span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;zhangsan@company.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;lisi@company.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;invalid-email&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;zhaoliu@company.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;qianqi@&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;sunba@company.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;zhoujiu@company.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;wushi@company.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;zhengshiyi@company.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;missing@company.com&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;phone&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;13812345678&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;13512345678&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;12345678901&#x27;</span>,  <span class="comment"># 无效号段</span></span><br><span class="line">            <span class="string">&#x27;13612345678&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;1391234567&#x27;</span>,   <span class="comment"># 位数不足</span></span><br><span class="line">            <span class="string">&#x27;13712345678&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;15012345678&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;15112345678&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;15212345678&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;15312345678&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    df = pd.DataFrame(data)</span><br><span class="line">    df.to_csv(<span class="string">&#x27;business_data.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;测试数据已保存到 &#x27;business_data.csv&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_initial_data</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;分析初始数据状态&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;初始数据分析:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;数据维度: <span class="subst">&#123;df.shape[<span class="number">0</span>]&#125;</span> 行, <span class="subst">&#123;df.shape[<span class="number">1</span>]&#125;</span> 列&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n数据类型:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(df.dtypes)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n缺失值统计:&quot;</span>)</span><br><span class="line">    missing_data = df.isnull().<span class="built_in">sum</span>()</span><br><span class="line">    <span class="keyword">for</span> col, count <span class="keyword">in</span> missing_data.items():</span><br><span class="line">        <span class="keyword">if</span> count &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;col&#125;</span>: <span class="subst">&#123;count&#125;</span> 个缺失值&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n数据示例:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(df.head())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_id_card</span>(<span class="params">id_card</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    验证身份证号格式和有效性</span></span><br><span class="line"><span class="string">    支持18位身份证号码验证</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> pd.isna(id_card):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;身份证号为空&quot;</span></span><br><span class="line">    </span><br><span class="line">    id_card = <span class="built_in">str</span>(id_card).strip()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 基本格式验证</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(id_card) != <span class="number">18</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">f&quot;身份证号长度应为18位，当前为<span class="subst">&#123;<span class="built_in">len</span>(id_card)&#125;</span>位&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">r&#x27;^\d&#123;17&#125;[\dXx]$&#x27;</span>, id_card):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;身份证号格式不正确，前17位应为数字，最后一位为数字或X&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 地区码验证（简单验证前6位）</span></span><br><span class="line">    area_codes = [<span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;15&#x27;</span>, <span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;22&#x27;</span>, <span class="string">&#x27;23&#x27;</span>, <span class="string">&#x27;31&#x27;</span>, <span class="string">&#x27;32&#x27;</span>, <span class="string">&#x27;33&#x27;</span>, </span><br><span class="line">                  <span class="string">&#x27;34&#x27;</span>, <span class="string">&#x27;35&#x27;</span>, <span class="string">&#x27;36&#x27;</span>, <span class="string">&#x27;37&#x27;</span>, <span class="string">&#x27;41&#x27;</span>, <span class="string">&#x27;42&#x27;</span>, <span class="string">&#x27;43&#x27;</span>, <span class="string">&#x27;44&#x27;</span>, <span class="string">&#x27;45&#x27;</span>, <span class="string">&#x27;46&#x27;</span>, <span class="string">&#x27;50&#x27;</span>, </span><br><span class="line">                  <span class="string">&#x27;51&#x27;</span>, <span class="string">&#x27;52&#x27;</span>, <span class="string">&#x27;53&#x27;</span>, <span class="string">&#x27;54&#x27;</span>, <span class="string">&#x27;61&#x27;</span>, <span class="string">&#x27;62&#x27;</span>, <span class="string">&#x27;63&#x27;</span>, <span class="string">&#x27;64&#x27;</span>, <span class="string">&#x27;65&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> id_card[:<span class="number">2</span>] <span class="keyword">not</span> <span class="keyword">in</span> area_codes:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;身份证地区码无效&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 出生日期验证</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        year = <span class="built_in">int</span>(id_card[<span class="number">6</span>:<span class="number">10</span>])</span><br><span class="line">        month = <span class="built_in">int</span>(id_card[<span class="number">10</span>:<span class="number">12</span>])</span><br><span class="line">        day = <span class="built_in">int</span>(id_card[<span class="number">12</span>:<span class="number">14</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查年份范围（1900-当前年份）</span></span><br><span class="line">        current_year = datetime.now().year</span><br><span class="line">        <span class="keyword">if</span> year &lt; <span class="number">1900</span> <span class="keyword">or</span> year &gt; current_year:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">f&quot;出生年份<span class="subst">&#123;year&#125;</span>超出有效范围&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查月份</span></span><br><span class="line">        <span class="keyword">if</span> month &lt; <span class="number">1</span> <span class="keyword">or</span> month &gt; <span class="number">12</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">f&quot;出生月份<span class="subst">&#123;month&#125;</span>无效&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查日期</span></span><br><span class="line">        <span class="keyword">if</span> day &lt; <span class="number">1</span> <span class="keyword">or</span> day &gt; <span class="number">31</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">f&quot;出生日期<span class="subst">&#123;day&#125;</span>无效&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 验证具体日期有效性</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            birth_date = datetime(year, month, day)</span><br><span class="line">            <span class="keyword">if</span> birth_date &gt; datetime.now():</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;出生日期不能晚于当前日期&quot;</span></span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;出生日期无效（如2月30日）&quot;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;出生日期部分包含无效数字&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 校验码验证</span></span><br><span class="line">    factors = [<span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>]</span><br><span class="line">    check_codes = [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;2&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>):</span><br><span class="line">        total += <span class="built_in">int</span>(id_card[i]) * factors[i]</span><br><span class="line">    </span><br><span class="line">    check_index = total % <span class="number">11</span></span><br><span class="line">    expected_check_code = check_codes[check_index]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> id_card[<span class="number">17</span>].upper() != expected_check_code:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">f&quot;校验码错误，应为<span class="subst">&#123;expected_check_code&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">&quot;身份证号有效&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_id_cards</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;批量验证身份证号&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;身份证号验证:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    validation_results = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> idx, row <span class="keyword">in</span> df.iterrows():</span><br><span class="line">        is_valid, message = validate_id_card(row[<span class="string">&#x27;id_card&#x27;</span>])</span><br><span class="line">        validation_results.append(&#123;</span><br><span class="line">            <span class="string">&#x27;user_id&#x27;</span>: row[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;id_card&#x27;</span>: row[<span class="string">&#x27;id_card&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;is_valid&#x27;</span>: is_valid,</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: message</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> is_valid:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;用户 <span class="subst">&#123;row[<span class="string">&#x27;user_id&#x27;</span>]&#125;</span>: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计验证结果</span></span><br><span class="line">    valid_count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> result <span class="keyword">in</span> validation_results <span class="keyword">if</span> result[<span class="string">&#x27;is_valid&#x27;</span>])</span><br><span class="line">    invalid_count = <span class="built_in">len</span>(validation_results) - valid_count</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n身份证验证统计:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  有效: <span class="subst">&#123;valid_count&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  无效: <span class="subst">&#123;invalid_count&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  有效率: <span class="subst">&#123;valid_count/<span class="built_in">len</span>(validation_results)*<span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> validation_results</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_logical_relationships</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查数据逻辑关系&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据逻辑关系检查:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    logical_issues = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 检查日期逻辑：结束日期 &gt; 开始日期</span></span><br><span class="line">    df[<span class="string">&#x27;start_date&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;start_date&#x27;</span>])</span><br><span class="line">    df[<span class="string">&#x27;end_date&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;end_date&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">    date_issues = df[df[<span class="string">&#x27;end_date&#x27;</span>] &lt;= df[<span class="string">&#x27;start_date&#x27;</span>]]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> date_issues.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;发现日期逻辑问题 (结束日期 &lt;= 开始日期):&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> idx, row <span class="keyword">in</span> date_issues.iterrows():</span><br><span class="line">            issue = &#123;</span><br><span class="line">                <span class="string">&#x27;user_id&#x27;</span>: row[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;issue_type&#x27;</span>: <span class="string">&#x27;日期逻辑&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;description&#x27;</span>: <span class="string">f&quot;结束日期(<span class="subst">&#123;row[<span class="string">&#x27;end_date&#x27;</span>].strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)&#125;</span>) &lt;= 开始日期(<span class="subst">&#123;row[<span class="string">&#x27;start_date&#x27;</span>].strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)&#125;</span>)&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;severity&#x27;</span>: <span class="string">&#x27;高&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            logical_issues.append(issue)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  用户 <span class="subst">&#123;row[<span class="string">&#x27;user_id&#x27;</span>]&#125;</span>: <span class="subst">&#123;issue[<span class="string">&#x27;description&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 检查年龄合理性 (0-150)</span></span><br><span class="line">    age_issues = df[(df[<span class="string">&#x27;age&#x27;</span>] &lt; <span class="number">0</span>) | (df[<span class="string">&#x27;age&#x27;</span>] &gt; <span class="number">150</span>)]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> age_issues.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n发现年龄逻辑问题 (年龄 &lt; 0 或 &gt; 150):&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> idx, row <span class="keyword">in</span> age_issues.iterrows():</span><br><span class="line">            issue = &#123;</span><br><span class="line">                <span class="string">&#x27;user_id&#x27;</span>: row[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;issue_type&#x27;</span>: <span class="string">&#x27;年龄逻辑&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;description&#x27;</span>: <span class="string">f&quot;年龄值异常: <span class="subst">&#123;row[<span class="string">&#x27;age&#x27;</span>]&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;severity&#x27;</span>: <span class="string">&#x27;高&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            logical_issues.append(issue)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  用户 <span class="subst">&#123;row[<span class="string">&#x27;user_id&#x27;</span>]&#125;</span>: <span class="subst">&#123;issue[<span class="string">&#x27;description&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 检查工资合理性 (&gt;= 0)</span></span><br><span class="line">    salary_issues = df[df[<span class="string">&#x27;salary&#x27;</span>] &lt; <span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> salary_issues.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n发现工资逻辑问题 (工资 &lt; 0):&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> idx, row <span class="keyword">in</span> salary_issues.iterrows():</span><br><span class="line">            issue = &#123;</span><br><span class="line">                <span class="string">&#x27;user_id&#x27;</span>: row[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;issue_type&#x27;</span>: <span class="string">&#x27;工资逻辑&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;description&#x27;</span>: <span class="string">f&quot;工资值异常: <span class="subst">&#123;row[<span class="string">&#x27;salary&#x27;</span>]&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;severity&#x27;</span>: <span class="string">&#x27;高&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            logical_issues.append(issue)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  用户 <span class="subst">&#123;row[<span class="string">&#x27;user_id&#x27;</span>]&#125;</span>: <span class="subst">&#123;issue[<span class="string">&#x27;description&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 检查邮箱格式</span></span><br><span class="line">    email_pattern = <span class="string">r&#x27;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,&#125;$&#x27;</span></span><br><span class="line">    email_issues = df[~df[<span class="string">&#x27;email&#x27;</span>].<span class="built_in">str</span>.<span class="keyword">match</span>(email_pattern, na=<span class="literal">False</span>)]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> email_issues.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n发现邮箱格式问题:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> idx, row <span class="keyword">in</span> email_issues.iterrows():</span><br><span class="line">            issue = &#123;</span><br><span class="line">                <span class="string">&#x27;user_id&#x27;</span>: row[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;issue_type&#x27;</span>: <span class="string">&#x27;邮箱格式&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;description&#x27;</span>: <span class="string">f&quot;邮箱格式无效: <span class="subst">&#123;row[<span class="string">&#x27;email&#x27;</span>]&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;severity&#x27;</span>: <span class="string">&#x27;中&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            logical_issues.append(issue)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  用户 <span class="subst">&#123;row[<span class="string">&#x27;user_id&#x27;</span>]&#125;</span>: <span class="subst">&#123;issue[<span class="string">&#x27;description&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. 检查手机号格式</span></span><br><span class="line">    phone_pattern = <span class="string">r&#x27;^1[3-9]\d&#123;9&#125;$&#x27;</span></span><br><span class="line">    phone_issues = df[~df[<span class="string">&#x27;phone&#x27;</span>].<span class="built_in">str</span>.<span class="keyword">match</span>(phone_pattern, na=<span class="literal">False</span>)]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> phone_issues.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n发现手机号格式问题:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> idx, row <span class="keyword">in</span> phone_issues.iterrows():</span><br><span class="line">            issue = &#123;</span><br><span class="line">                <span class="string">&#x27;user_id&#x27;</span>: row[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;issue_type&#x27;</span>: <span class="string">&#x27;手机号格式&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;description&#x27;</span>: <span class="string">f&quot;手机号格式无效: <span class="subst">&#123;row[<span class="string">&#x27;phone&#x27;</span>]&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;severity&#x27;</span>: <span class="string">&#x27;中&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            logical_issues.append(issue)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  用户 <span class="subst">&#123;row[<span class="string">&#x27;user_id&#x27;</span>]&#125;</span>: <span class="subst">&#123;issue[<span class="string">&#x27;description&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计逻辑问题</span></span><br><span class="line">    <span class="keyword">if</span> logical_issues:</span><br><span class="line">        issue_df = pd.DataFrame(logical_issues)</span><br><span class="line">        severity_counts = issue_df[<span class="string">&#x27;severity&#x27;</span>].value_counts()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n逻辑问题严重性统计:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> severity, count <span class="keyword">in</span> severity_counts.items():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;severity&#125;</span>: <span class="subst">&#123;count&#125;</span> 个问题&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未发现逻辑关系问题&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> logical_issues</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_integrity_constraints</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;验证数据完整性约束&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据完整性约束验证:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    integrity_issues = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 非空约束检查</span></span><br><span class="line">    required_columns = [<span class="string">&#x27;user_id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id_card&#x27;</span>, <span class="string">&#x27;department&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> required_columns:</span><br><span class="line">        null_count = df[col].isnull().<span class="built_in">sum</span>()</span><br><span class="line">        <span class="keyword">if</span> null_count &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;非空约束违反 - <span class="subst">&#123;col&#125;</span>: <span class="subst">&#123;null_count&#125;</span> 个空值&quot;</span>)</span><br><span class="line">            null_rows = df[df[col].isnull()]</span><br><span class="line">            <span class="keyword">for</span> idx, row <span class="keyword">in</span> null_rows.iterrows():</span><br><span class="line">                issue = &#123;</span><br><span class="line">                    <span class="string">&#x27;user_id&#x27;</span>: row[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;issue_type&#x27;</span>: <span class="string">&#x27;非空约束&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;description&#x27;</span>: <span class="string">f&quot;字段 &#x27;<span class="subst">&#123;col&#125;</span>&#x27; 不能为空&quot;</span>,</span><br><span class="line">                    <span class="string">&#x27;severity&#x27;</span>: <span class="string">&#x27;高&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">                integrity_issues.append(issue)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 唯一性约束检查</span></span><br><span class="line">    <span class="comment"># 用户ID唯一性</span></span><br><span class="line">    duplicate_users = df[df.duplicated(subset=[<span class="string">&#x27;user_id&#x27;</span>], keep=<span class="literal">False</span>)]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> duplicate_users.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;唯一性约束违反 - user_id: <span class="subst">&#123;<span class="built_in">len</span>(duplicate_users)&#125;</span> 个重复值&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> user_id, group <span class="keyword">in</span> duplicate_users.groupby(<span class="string">&#x27;user_id&#x27;</span>):</span><br><span class="line">            issue = &#123;</span><br><span class="line">                <span class="string">&#x27;user_id&#x27;</span>: user_id,</span><br><span class="line">                <span class="string">&#x27;issue_type&#x27;</span>: <span class="string">&#x27;唯一性约束&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;description&#x27;</span>: <span class="string">f&quot;用户ID &#x27;<span class="subst">&#123;user_id&#125;</span>&#x27; 重复出现&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;severity&#x27;</span>: <span class="string">&#x27;高&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            integrity_issues.append(issue)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 身份证号唯一性</span></span><br><span class="line">    duplicate_id_cards = df[df.duplicated(subset=[<span class="string">&#x27;id_card&#x27;</span>], keep=<span class="literal">False</span>)]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> duplicate_id_cards.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;唯一性约束违反 - id_card: <span class="subst">&#123;<span class="built_in">len</span>(duplicate_id_cards)&#125;</span> 个重复值&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> id_card, group <span class="keyword">in</span> duplicate_id_cards.groupby(<span class="string">&#x27;id_card&#x27;</span>):</span><br><span class="line">            issue = &#123;</span><br><span class="line">                <span class="string">&#x27;user_id&#x27;</span>: group.iloc[<span class="number">0</span>][<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;issue_type&#x27;</span>: <span class="string">&#x27;唯一性约束&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;description&#x27;</span>: <span class="string">f&quot;身份证号 &#x27;<span class="subst">&#123;id_card&#125;</span>&#x27; 重复出现&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;severity&#x27;</span>: <span class="string">&#x27;高&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            integrity_issues.append(issue)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 外键约束检查 (manager_id 必须存在于 user_id 中)</span></span><br><span class="line">    valid_manager_ids = <span class="built_in">set</span>(df[<span class="string">&#x27;user_id&#x27;</span>].dropna())</span><br><span class="line">    invalid_managers = df[~df[<span class="string">&#x27;manager_id&#x27;</span>].isin(valid_manager_ids) &amp; df[<span class="string">&#x27;manager_id&#x27;</span>].notna()]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> invalid_managers.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;外键约束违反 - manager_id: <span class="subst">&#123;<span class="built_in">len</span>(invalid_managers)&#125;</span> 个无效经理ID&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> idx, row <span class="keyword">in</span> invalid_managers.iterrows():</span><br><span class="line">            issue = &#123;</span><br><span class="line">                <span class="string">&#x27;user_id&#x27;</span>: row[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;issue_type&#x27;</span>: <span class="string">&#x27;外键约束&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;description&#x27;</span>: <span class="string">f&quot;经理ID &#x27;<span class="subst">&#123;row[<span class="string">&#x27;manager_id&#x27;</span>]&#125;</span>&#x27; 不存在&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;severity&#x27;</span>: <span class="string">&#x27;中&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            integrity_issues.append(issue)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 检查循环引用 (manager_id 不能指向自己)</span></span><br><span class="line">    self_reference = df[df[<span class="string">&#x27;user_id&#x27;</span>] == df[<span class="string">&#x27;manager_id&#x27;</span>]]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self_reference.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;循环引用问题: <span class="subst">&#123;<span class="built_in">len</span>(self_reference)&#125;</span> 个自引用&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> idx, row <span class="keyword">in</span> self_reference.iterrows():</span><br><span class="line">            issue = &#123;</span><br><span class="line">                <span class="string">&#x27;user_id&#x27;</span>: row[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;issue_type&#x27;</span>: <span class="string">&#x27;循环引用&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;description&#x27;</span>: <span class="string">f&quot;经理ID指向自己&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;severity&#x27;</span>: <span class="string">&#x27;中&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            integrity_issues.append(issue)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. 业务规则：部门一致性检查</span></span><br><span class="line">    <span class="comment"># 假设同一部门的员工应该有相似的工资范围</span></span><br><span class="line">    dept_salary_stats = df.groupby(<span class="string">&#x27;department&#x27;</span>)[<span class="string">&#x27;salary&#x27;</span>].agg([<span class="string">&#x27;mean&#x27;</span>, <span class="string">&#x27;std&#x27;</span>]).fillna(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> dept, stats <span class="keyword">in</span> dept_salary_stats.iterrows():</span><br><span class="line">        <span class="keyword">if</span> stats[<span class="string">&#x27;std&#x27;</span>] &gt; <span class="number">0</span>:  <span class="comment"># 有标准差才检查</span></span><br><span class="line">            lower_bound = stats[<span class="string">&#x27;mean&#x27;</span>] - <span class="number">2</span> * stats[<span class="string">&#x27;std&#x27;</span>]</span><br><span class="line">            upper_bound = stats[<span class="string">&#x27;mean&#x27;</span>] + <span class="number">2</span> * stats[<span class="string">&#x27;std&#x27;</span>]</span><br><span class="line">            outliers = df[(df[<span class="string">&#x27;department&#x27;</span>] == dept) &amp; </span><br><span class="line">                         ((df[<span class="string">&#x27;salary&#x27;</span>] &lt; lower_bound) | (df[<span class="string">&#x27;salary&#x27;</span>] &gt; upper_bound))]</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> outliers.empty:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;业务规则违反 - <span class="subst">&#123;dept&#125;</span>部门工资异常: <span class="subst">&#123;<span class="built_in">len</span>(outliers)&#125;</span> 个异常值&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> idx, row <span class="keyword">in</span> outliers.iterrows():</span><br><span class="line">                    issue = &#123;</span><br><span class="line">                        <span class="string">&#x27;user_id&#x27;</span>: row[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                        <span class="string">&#x27;issue_type&#x27;</span>: <span class="string">&#x27;业务规则&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;description&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;dept&#125;</span>部门工资异常: <span class="subst">&#123;row[<span class="string">&#x27;salary&#x27;</span>]&#125;</span> (范围: <span class="subst">&#123;lower_bound:<span class="number">.0</span>f&#125;</span>-<span class="subst">&#123;upper_bound:<span class="number">.0</span>f&#125;</span>)&quot;</span>,</span><br><span class="line">                        <span class="string">&#x27;severity&#x27;</span>: <span class="string">&#x27;低&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    integrity_issues.append(issue)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 统计完整性问题</span></span><br><span class="line">    <span class="keyword">if</span> integrity_issues:</span><br><span class="line">        issue_df = pd.DataFrame(integrity_issues)</span><br><span class="line">        issue_type_counts = issue_df[<span class="string">&#x27;issue_type&#x27;</span>].value_counts()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n完整性约束问题统计:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> issue_type, count <span class="keyword">in</span> issue_type_counts.items():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;issue_type&#125;</span>: <span class="subst">&#123;count&#125;</span> 个问题&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未发现完整性约束问题&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> integrity_issues</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_cleaning_suggestions</span>(<span class="params">df, id_validation_results, logical_issues, integrity_issues</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成数据清洗建议&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据清洗建议:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    cleaning_plan = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 身份证号清洗建议</span></span><br><span class="line">    invalid_id_cards = [result <span class="keyword">for</span> result <span class="keyword">in</span> id_validation_results <span class="keyword">if</span> <span class="keyword">not</span> result[<span class="string">&#x27;is_valid&#x27;</span>]]</span><br><span class="line">    <span class="keyword">if</span> invalid_id_cards:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n身份证号清洗建议:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> result <span class="keyword">in</span> invalid_id_cards:</span><br><span class="line">            suggestion = &#123;</span><br><span class="line">                <span class="string">&#x27;user_id&#x27;</span>: result[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;field&#x27;</span>: <span class="string">&#x27;id_card&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;issue&#x27;</span>: result[<span class="string">&#x27;message&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;suggestion&#x27;</span>: <span class="string">&#x27;需要人工核实并修正身份证号&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;priority&#x27;</span>: <span class="string">&#x27;高&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            cleaning_plan.append(suggestion)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  用户 <span class="subst">&#123;result[<span class="string">&#x27;user_id&#x27;</span>]&#125;</span>: <span class="subst">&#123;result[<span class="string">&#x27;message&#x27;</span>]&#125;</span> → 需要人工核实&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 逻辑问题清洗建议</span></span><br><span class="line">    <span class="keyword">if</span> logical_issues:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n逻辑问题清洗建议:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> issue <span class="keyword">in</span> logical_issues:</span><br><span class="line">            <span class="keyword">if</span> issue[<span class="string">&#x27;issue_type&#x27;</span>] == <span class="string">&#x27;日期逻辑&#x27;</span>:</span><br><span class="line">                suggestion = &#123;</span><br><span class="line">                    <span class="string">&#x27;user_id&#x27;</span>: issue[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;field&#x27;</span>: <span class="string">&#x27;start_date/end_date&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;issue&#x27;</span>: issue[<span class="string">&#x27;description&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;suggestion&#x27;</span>: <span class="string">&#x27;检查并修正日期顺序，确保结束日期晚于开始日期&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;priority&#x27;</span>: issue[<span class="string">&#x27;severity&#x27;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">elif</span> issue[<span class="string">&#x27;issue_type&#x27;</span>] == <span class="string">&#x27;年龄逻辑&#x27;</span>:</span><br><span class="line">                suggestion = &#123;</span><br><span class="line">                    <span class="string">&#x27;user_id&#x27;</span>: issue[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;field&#x27;</span>: <span class="string">&#x27;age&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;issue&#x27;</span>: issue[<span class="string">&#x27;description&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;suggestion&#x27;</span>: <span class="string">&#x27;将年龄修正为合理范围 (0-150)&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;priority&#x27;</span>: issue[<span class="string">&#x27;severity&#x27;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">elif</span> issue[<span class="string">&#x27;issue_type&#x27;</span>] == <span class="string">&#x27;工资逻辑&#x27;</span>:</span><br><span class="line">                suggestion = &#123;</span><br><span class="line">                    <span class="string">&#x27;user_id&#x27;</span>: issue[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;field&#x27;</span>: <span class="string">&#x27;salary&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;issue&#x27;</span>: issue[<span class="string">&#x27;description&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;suggestion&#x27;</span>: <span class="string">&#x27;将工资修正为非负值&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;priority&#x27;</span>: issue[<span class="string">&#x27;severity&#x27;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                suggestion = &#123;</span><br><span class="line">                    <span class="string">&#x27;user_id&#x27;</span>: issue[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;field&#x27;</span>: issue[<span class="string">&#x27;issue_type&#x27;</span>].replace(<span class="string">&#x27;格式&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">                    <span class="string">&#x27;issue&#x27;</span>: issue[<span class="string">&#x27;description&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;suggestion&#x27;</span>: <span class="string">&#x27;修正格式以符合规范&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;priority&#x27;</span>: issue[<span class="string">&#x27;severity&#x27;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            cleaning_plan.append(suggestion)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  用户 <span class="subst">&#123;issue[<span class="string">&#x27;user_id&#x27;</span>]&#125;</span>: <span class="subst">&#123;issue[<span class="string">&#x27;description&#x27;</span>]&#125;</span> → <span class="subst">&#123;suggestion[<span class="string">&#x27;suggestion&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 完整性约束清洗建议</span></span><br><span class="line">    <span class="keyword">if</span> integrity_issues:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n完整性约束清洗建议:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> issue <span class="keyword">in</span> integrity_issues:</span><br><span class="line">            <span class="keyword">if</span> issue[<span class="string">&#x27;issue_type&#x27;</span>] == <span class="string">&#x27;非空约束&#x27;</span>:</span><br><span class="line">                suggestion = &#123;</span><br><span class="line">                    <span class="string">&#x27;user_id&#x27;</span>: issue[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;field&#x27;</span>: <span class="string">&#x27;相关字段&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;issue&#x27;</span>: issue[<span class="string">&#x27;description&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;suggestion&#x27;</span>: <span class="string">&#x27;补充缺失的必要字段数据&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;priority&#x27;</span>: issue[<span class="string">&#x27;severity&#x27;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">elif</span> issue[<span class="string">&#x27;issue_type&#x27;</span>] == <span class="string">&#x27;唯一性约束&#x27;</span>:</span><br><span class="line">                suggestion = &#123;</span><br><span class="line">                    <span class="string">&#x27;user_id&#x27;</span>: issue[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;field&#x27;</span>: <span class="string">&#x27;相关字段&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;issue&#x27;</span>: issue[<span class="string">&#x27;description&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;suggestion&#x27;</span>: <span class="string">&#x27;移除重复记录或修正重复值&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;priority&#x27;</span>: issue[<span class="string">&#x27;severity&#x27;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">elif</span> issue[<span class="string">&#x27;issue_type&#x27;</span>] == <span class="string">&#x27;外键约束&#x27;</span>:</span><br><span class="line">                suggestion = &#123;</span><br><span class="line">                    <span class="string">&#x27;user_id&#x27;</span>: issue[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;field&#x27;</span>: <span class="string">&#x27;manager_id&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;issue&#x27;</span>: issue[<span class="string">&#x27;description&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;suggestion&#x27;</span>: <span class="string">&#x27;修正为有效的经理ID或设置为空&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;priority&#x27;</span>: issue[<span class="string">&#x27;severity&#x27;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                suggestion = &#123;</span><br><span class="line">                    <span class="string">&#x27;user_id&#x27;</span>: issue[<span class="string">&#x27;user_id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;field&#x27;</span>: <span class="string">&#x27;相关字段&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;issue&#x27;</span>: issue[<span class="string">&#x27;description&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;suggestion&#x27;</span>: <span class="string">&#x27;根据业务规则进行修正&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;priority&#x27;</span>: issue[<span class="string">&#x27;severity&#x27;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            cleaning_plan.append(suggestion)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  用户 <span class="subst">&#123;issue[<span class="string">&#x27;user_id&#x27;</span>]&#125;</span>: <span class="subst">&#123;issue[<span class="string">&#x27;description&#x27;</span>]&#125;</span> → <span class="subst">&#123;suggestion[<span class="string">&#x27;suggestion&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cleaning_plan</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">apply_data_cleaning</span>(<span class="params">df, cleaning_plan</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;应用数据清洗&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;应用数据清洗:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    df_cleaned = df.copy()</span><br><span class="line">    applied_fixes = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 按优先级排序清洗建议（高优先级先处理）</span></span><br><span class="line">    high_priority = [item <span class="keyword">for</span> item <span class="keyword">in</span> cleaning_plan <span class="keyword">if</span> item[<span class="string">&#x27;priority&#x27;</span>] == <span class="string">&#x27;高&#x27;</span>]</span><br><span class="line">    medium_priority = [item <span class="keyword">for</span> item <span class="keyword">in</span> cleaning_plan <span class="keyword">if</span> item[<span class="string">&#x27;priority&#x27;</span>] == <span class="string">&#x27;中&#x27;</span>]</span><br><span class="line">    low_priority = [item <span class="keyword">for</span> item <span class="keyword">in</span> cleaning_plan <span class="keyword">if</span> item[<span class="string">&#x27;priority&#x27;</span>] == <span class="string">&#x27;低&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    sorted_plan = high_priority + medium_priority + low_priority</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> suggestion <span class="keyword">in</span> sorted_plan:</span><br><span class="line">        user_id = suggestion[<span class="string">&#x27;user_id&#x27;</span>]</span><br><span class="line">        field = suggestion[<span class="string">&#x27;field&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 根据问题类型应用不同的清洗策略</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;身份证&#x27;</span> <span class="keyword">in</span> suggestion[<span class="string">&#x27;issue&#x27;</span>]:</span><br><span class="line">            <span class="comment"># 对于身份证问题，标记为需要人工检查</span></span><br><span class="line">            df_cleaned.loc[df_cleaned[<span class="string">&#x27;user_id&#x27;</span>] == user_id, <span class="string">&#x27;id_card_status&#x27;</span>] = <span class="string">&#x27;需人工核查&#x27;</span></span><br><span class="line">            applied_fixes.append(<span class="string">f&quot;用户 <span class="subst">&#123;user_id&#125;</span>: 标记身份证需人工核查&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;年龄&#x27;</span> <span class="keyword">in</span> suggestion[<span class="string">&#x27;issue&#x27;</span>]:</span><br><span class="line">            <span class="comment"># 修正异常年龄为平均值</span></span><br><span class="line">            avg_age = df_cleaned[df_cleaned[<span class="string">&#x27;age&#x27;</span>].between(<span class="number">0</span>, <span class="number">150</span>)][<span class="string">&#x27;age&#x27;</span>].mean()</span><br><span class="line">            df_cleaned.loc[df_cleaned[<span class="string">&#x27;user_id&#x27;</span>] == user_id, <span class="string">&#x27;age&#x27;</span>] = <span class="built_in">round</span>(avg_age)</span><br><span class="line">            applied_fixes.append(<span class="string">f&quot;用户 <span class="subst">&#123;user_id&#125;</span>: 年龄修正为 <span class="subst">&#123;<span class="built_in">round</span>(avg_age)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;工资&#x27;</span> <span class="keyword">in</span> suggestion[<span class="string">&#x27;issue&#x27;</span>] <span class="keyword">and</span> <span class="string">&#x27;负&#x27;</span> <span class="keyword">in</span> suggestion[<span class="string">&#x27;issue&#x27;</span>]:</span><br><span class="line">            <span class="comment"># 修正负工资为部门平均工资</span></span><br><span class="line">            user_dept = df_cleaned.loc[df_cleaned[<span class="string">&#x27;user_id&#x27;</span>] == user_id, <span class="string">&#x27;department&#x27;</span>].iloc[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> user_dept:</span><br><span class="line">                dept_avg_salary = df_cleaned[</span><br><span class="line">                    (df_cleaned[<span class="string">&#x27;department&#x27;</span>] == user_dept) &amp; </span><br><span class="line">                    (df_cleaned[<span class="string">&#x27;salary&#x27;</span>] &gt;= <span class="number">0</span>)</span><br><span class="line">                ][<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line">                df_cleaned.loc[df_cleaned[<span class="string">&#x27;user_id&#x27;</span>] == user_id, <span class="string">&#x27;salary&#x27;</span>] = dept_avg_salary</span><br><span class="line">                applied_fixes.append(<span class="string">f&quot;用户 <span class="subst">&#123;user_id&#125;</span>: 工资修正为部门平均值 <span class="subst">&#123;dept_avg_salary:<span class="number">.0</span>f&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;日期逻辑&#x27;</span> <span class="keyword">in</span> suggestion[<span class="string">&#x27;issue&#x27;</span>]:</span><br><span class="line">            <span class="comment"># 交换开始日期和结束日期</span></span><br><span class="line">            user_data = df_cleaned[df_cleaned[<span class="string">&#x27;user_id&#x27;</span>] == user_id]</span><br><span class="line">            start_date = user_data[<span class="string">&#x27;start_date&#x27;</span>].iloc[<span class="number">0</span>]</span><br><span class="line">            end_date = user_data[<span class="string">&#x27;end_date&#x27;</span>].iloc[<span class="number">0</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> start_date &gt; end_date:</span><br><span class="line">                df_cleaned.loc[df_cleaned[<span class="string">&#x27;user_id&#x27;</span>] == user_id, <span class="string">&#x27;start_date&#x27;</span>] = end_date</span><br><span class="line">                df_cleaned.loc[df_cleaned[<span class="string">&#x27;user_id&#x27;</span>] == user_id, <span class="string">&#x27;end_date&#x27;</span>] = start_date</span><br><span class="line">                applied_fixes.append(<span class="string">f&quot;用户 <span class="subst">&#123;user_id&#125;</span>: 交换开始日期和结束日期&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;非空约束&#x27;</span> <span class="keyword">in</span> suggestion[<span class="string">&#x27;issue&#x27;</span>] <span class="keyword">and</span> <span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> suggestion[<span class="string">&#x27;issue&#x27;</span>]:</span><br><span class="line">            <span class="comment"># 为缺失姓名生成占位符</span></span><br><span class="line">            df_cleaned.loc[df_cleaned[<span class="string">&#x27;user_id&#x27;</span>] == user_id, <span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;未知用户&#x27;</span></span><br><span class="line">            applied_fixes.append(<span class="string">f&quot;用户 <span class="subst">&#123;user_id&#125;</span>: 缺失姓名设置为&#x27;未知用户&#x27;&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;非空约束&#x27;</span> <span class="keyword">in</span> suggestion[<span class="string">&#x27;issue&#x27;</span>] <span class="keyword">and</span> <span class="string">&#x27;department&#x27;</span> <span class="keyword">in</span> suggestion[<span class="string">&#x27;issue&#x27;</span>]:</span><br><span class="line">            <span class="comment"># 为缺失部门设置默认值</span></span><br><span class="line">            df_cleaned.loc[df_cleaned[<span class="string">&#x27;user_id&#x27;</span>] == user_id, <span class="string">&#x27;department&#x27;</span>] = <span class="string">&#x27;未分配部门&#x27;</span></span><br><span class="line">            applied_fixes.append(<span class="string">f&quot;用户 <span class="subst">&#123;user_id&#125;</span>: 缺失部门设置为&#x27;未分配部门&#x27;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示应用的修复</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;已应用的自动修复:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> fix <span class="keyword">in</span> applied_fixes:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  ✓ <span class="subst">&#123;fix&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_cleaned</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_quality_report</span>(<span class="params">df, df_cleaned, id_validation_results, logical_issues, integrity_issues</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成数据质量报告&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据质量报告:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算质量指标</span></span><br><span class="line">    original_records = <span class="built_in">len</span>(df)</span><br><span class="line">    cleaned_records = <span class="built_in">len</span>(df_cleaned)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 身份证有效性</span></span><br><span class="line">    id_valid_rate = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> result <span class="keyword">in</span> id_validation_results <span class="keyword">if</span> result[<span class="string">&#x27;is_valid&#x27;</span>]) / <span class="built_in">len</span>(id_validation_results) * <span class="number">100</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 逻辑问题数量</span></span><br><span class="line">    logical_issue_count = <span class="built_in">len</span>(logical_issues)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 完整性问题数量</span></span><br><span class="line">    integrity_issue_count = <span class="built_in">len</span>(integrity_issues)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 缺失值改善</span></span><br><span class="line">    original_missing = df.isnull().<span class="built_in">sum</span>().<span class="built_in">sum</span>()</span><br><span class="line">    cleaned_missing = df_cleaned.isnull().<span class="built_in">sum</span>().<span class="built_in">sum</span>()</span><br><span class="line">    missing_improvement = original_missing - cleaned_missing</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;数据质量指标:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 总记录数: <span class="subst">&#123;original_records&#125;</span> → <span class="subst">&#123;cleaned_records&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 身份证有效率: <span class="subst">&#123;id_valid_rate:<span class="number">.1</span>f&#125;</span>%&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 逻辑问题数: <span class="subst">&#123;logical_issue_count&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 完整性问题数: <span class="subst">&#123;integrity_issue_count&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 缺失值减少: <span class="subst">&#123;missing_improvement&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 质量评分 (简化计算)</span></span><br><span class="line">    quality_score = <span class="number">100</span></span><br><span class="line">    quality_score -= (<span class="number">100</span> - id_valid_rate) * <span class="number">0.3</span>  <span class="comment"># 身份证有效性权重30%</span></span><br><span class="line">    quality_score -= <span class="built_in">min</span>(logical_issue_count * <span class="number">5</span>, <span class="number">30</span>)  <span class="comment"># 逻辑问题权重</span></span><br><span class="line">    quality_score -= <span class="built_in">min</span>(integrity_issue_count * <span class="number">3</span>, <span class="number">20</span>)  <span class="comment"># 完整性问题权重</span></span><br><span class="line">    quality_score = <span class="built_in">max</span>(quality_score, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 数据质量评分: <span class="subst">&#123;quality_score:<span class="number">.1</span>f&#125;</span>/100&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 质量等级</span></span><br><span class="line">    <span class="keyword">if</span> quality_score &gt;= <span class="number">90</span>:</span><br><span class="line">        grade = <span class="string">&quot;优秀&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> quality_score &gt;= <span class="number">80</span>:</span><br><span class="line">        grade = <span class="string">&quot;良好&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> quality_score &gt;= <span class="number">70</span>:</span><br><span class="line">        grade = <span class="string">&quot;一般&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> quality_score &gt;= <span class="number">60</span>:</span><br><span class="line">        grade = <span class="string">&quot;及格&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        grade = <span class="string">&quot;不及格&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 质量等级: <span class="subst">&#123;grade&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> quality_score, grade</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_cleaned_data</span>(<span class="params">df_cleaned, quality_score, grade</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;保存清洗后的数据&quot;&quot;&quot;</span></span><br><span class="line">    output_file = <span class="string">&#x27;business_data_cleaned.csv&#x27;</span></span><br><span class="line">    df_cleaned.to_csv(output_file, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n清洗后的数据已保存到: <span class="subst">&#123;output_file&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存质量报告</span></span><br><span class="line">    report_file = <span class="string">&#x27;data_quality_report.txt&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(report_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">&quot;业务数据质量报告\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;=&quot;</span> * <span class="number">50</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;生成时间: <span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)&#125;</span>\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;数据质量评分: <span class="subst">&#123;quality_score:<span class="number">.1</span>f&#125;</span>/100\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;质量等级: <span class="subst">&#123;grade&#125;</span>\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;输出文件: <span class="subst">&#123;output_file&#125;</span>\n\n&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        f.write(<span class="string">&quot;清洗总结:\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;  • 验证了身份证号格式和有效性\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;  • 检查了数据逻辑关系（日期、年龄、工资等）\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;  • 验证了数据完整性约束（非空、唯一性、外键等）\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;  • 应用了自动数据清洗规则\n&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;质量报告已保存到: <span class="subst">&#123;report_file&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;复杂规则清洗脚本&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">100</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建测试数据</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;创建测试数据...&quot;</span>)</span><br><span class="line">    df = create_test_data()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 分析初始数据</span></span><br><span class="line">    analyze_initial_data(df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证身份证号</span></span><br><span class="line">    id_validation_results = validate_id_cards(df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查逻辑关系</span></span><br><span class="line">    logical_issues = check_logical_relationships(df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证完整性约束</span></span><br><span class="line">    integrity_issues = validate_integrity_constraints(df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 生成清洗建议</span></span><br><span class="line">    cleaning_plan = generate_cleaning_suggestions(df, id_validation_results, logical_issues, integrity_issues)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 应用数据清洗</span></span><br><span class="line">    df_cleaned = apply_data_cleaning(df, cleaning_plan)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 生成质量报告</span></span><br><span class="line">    quality_score, grade = generate_quality_report(df, df_cleaned, id_validation_results, logical_issues, integrity_issues)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存结果</span></span><br><span class="line">    save_cleaned_data(df_cleaned, quality_score, grade)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">100</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;复杂规则清洗完成!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li><li><h3 id="非结构化数据清洗"><a href="#非结构化数据清洗" class="headerlink" title="非结构化数据清洗"></a>非结构化数据清洗</h3><ul><li>编写脚本处理半结构化日志数据：</li><li>使用正则表达式提取关键信息</li><li>解析嵌套JSON结构</li><li>处理不完整记录</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">List</span>, <span class="type">Any</span>, <span class="type">Optional</span></span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_test_log_data</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建包含各种半结构化日志数据的测试文件&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    log_entries = [</span><br><span class="line">        <span class="comment"># 标准格式日志</span></span><br><span class="line">        <span class="string">&#x27;2023-10-15 08:30:15 [INFO] User login successful. &#123;&quot;user_id&quot;: &quot;U1001&quot;, &quot;ip&quot;: &quot;192.168.1.100&quot;, &quot;session_id&quot;: &quot;SESS001&quot;, &quot;user_agent&quot;: &quot;Mozilla/5.0&quot;&#125;&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 嵌套JSON结构</span></span><br><span class="line">        <span class="string">&#x27;2023-10-15 08:31:22 [ERROR] Database connection failed. &#123;&quot;error&quot;: &#123;&quot;code&quot;: 500, &quot;message&quot;: &quot;Connection timeout&quot;&#125;, &quot;context&quot;: &#123;&quot;database&quot;: &quot;users_db&quot;, &quot;retry_count&quot;: 3, &quot;last_success&quot;: &quot;2023-10-15 08:25:00&quot;&#125;&#125;&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 不完整记录 - 缺少时间戳</span></span><br><span class="line">        <span class="string">&#x27;[WARN] High memory usage detected. &#123;&quot;memory_usage&quot;: 85, &quot;process&quot;: &quot;web_server&quot;, &quot;recommendation&quot;: &quot;restart service&quot;&#125;&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 混合格式日志</span></span><br><span class="line">        <span class="string">&#x27;2023-10-15 08:32:45 [INFO] Order created. User: U1002, OrderID: ORD001, Amount: $150.75, Items: [&#123;&quot;product_id&quot;: &quot;P001&quot;, &quot;quantity&quot;: 2&#125;, &#123;&quot;product_id&quot;: &quot;P005&quot;, &quot;quantity&quot;: 1&#125;]&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 损坏的JSON</span></span><br><span class="line">        <span class="string">&#x27;2023-10-15 08:33:10 [ERROR] Payment processing failed. &#123;&quot;transaction_id&quot;: &quot;TXN1001&quot;, &quot;status&quot;: &quot;failed&quot;, &quot;reason&quot;: &quot;insufficient funds&quot;, &quot;amount&quot;: 75.50, invalid json here&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 多行日志</span></span><br><span class="line">        <span class="string">&#x27;2023-10-15 08:34:20 [DEBUG] Stack trace: \n  File &quot;app.py&quot;, line 150\n  File &quot;utils.py&quot;, line 45\nException: Division by zero\n&#123;&quot;trace_id&quot;: &quot;TRACE001&quot;, &quot;component&quot;: &quot;calculator&quot;&#125;&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 无JSON的纯文本日志</span></span><br><span class="line">        <span class="string">&#x27;2023-10-15 08:35:30 [INFO] Server started successfully on port 8080&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 复杂的嵌套结构</span></span><br><span class="line">        <span class="string">&#x27;2023-10-15 08:36:40 [INFO] API response. &#123;&quot;request&quot;: &#123;&quot;method&quot;: &quot;POST&quot;, &quot;endpoint&quot;: &quot;/api/users&quot;, &quot;headers&quot;: &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;&#125;, &quot;response&quot;: &#123;&quot;status&quot;: 201, &quot;body&quot;: &#123;&quot;user&quot;: &#123;&quot;id&quot;: &quot;U1003&quot;, &quot;profile&quot;: &#123;&quot;name&quot;: &quot;John Doe&quot;, &quot;preferences&quot;: &#123;&quot;theme&quot;: &quot;dark&quot;, &quot;language&quot;: &quot;en&quot;&#125;&#125;&#125;&#125;&#125;&#125;&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 不完整记录 - 缺少日志级别</span></span><br><span class="line">        <span class="string">&#x27;2023-10-15 08:37:55 User logout. &#123;&quot;user_id&quot;: &quot;U1001&quot;, &quot;session_duration&quot;: 1800&#125;&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 格式混乱的日志</span></span><br><span class="line">        <span class="string">&#x27;ERROR 2023-10-15 08:38:12 Cache miss for key: user_profile_U1004 TTL: 300&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 包含数组的JSON</span></span><br><span class="line">        <span class="string">&#x27;2023-10-15 08:39:25 [INFO] Batch processing completed. &#123;&quot;batch_id&quot;: &quot;BATCH001&quot;, &quot;processed_items&quot;: 1500, &quot;results&quot;: [&#123;&quot;item_id&quot;: &quot;I001&quot;, &quot;status&quot;: &quot;success&quot;&#125;, &#123;&quot;item_id&quot;: &quot;I002&quot;, &quot;status&quot;: &quot;failed&quot;, &quot;error&quot;: &quot;timeout&quot;&#125;]&#125;&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 不完整记录 - 只有JSON</span></span><br><span class="line">        <span class="string">&#x27;&#123;&quot;timestamp&quot;: &quot;2023-10-15 08:40:00&quot;, &quot;event&quot;: &quot;heartbeat&quot;, &quot;service&quot;: &quot;auth_service&quot;, &quot;status&quot;: &quot;healthy&quot;&#125;&#x27;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 特殊字符和编码问题</span></span><br><span class="line">        <span class="string">&#x27;2023-10-15 08:41:15 [INFO] User input received. &#123;&quot;user_id&quot;: &quot;U1005&quot;, &quot;input&quot;: &quot;Hello &amp; Welcome! &lt;script&gt;alert(\&#x27;test\&#x27;)&lt;/script&gt;&quot;, &quot;encoding&quot;: &quot;UTF-8&quot;&#125;&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 写入日志文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;application.log&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> entry <span class="keyword">in</span> log_entries:</span><br><span class="line">            f.write(entry + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;测试日志数据已创建到 &#x27;application.log&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> log_entries</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_log_structure</span>(<span class="params">log_entries</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;分析日志数据的结构和模式&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;日志结构分析:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    patterns = &#123;</span><br><span class="line">        <span class="string">&#x27;timestamp&#x27;</span>: <span class="string">r&#x27;\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125; \d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;log_level&#x27;</span>: <span class="string">r&#x27;\[(INFO|ERROR|WARN|DEBUG)\]&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;json_object&#x27;</span>: <span class="string">r&#x27;\&#123;.*\&#125;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;json_array&#x27;</span>: <span class="string">r&#x27;\[.*\]&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    stats = &#123;</span><br><span class="line">        <span class="string">&#x27;total_entries&#x27;</span>: <span class="built_in">len</span>(log_entries),</span><br><span class="line">        <span class="string">&#x27;has_timestamp&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;has_log_level&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;has_json&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;has_nested_json&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;incomplete_records&#x27;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, entry <span class="keyword">in</span> <span class="built_in">enumerate</span>(log_entries):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n条目 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  内容: <span class="subst">&#123;entry[:<span class="number">100</span>]&#125;</span><span class="subst">&#123;<span class="string">&#x27;...&#x27;</span> <span class="keyword">if</span> <span class="built_in">len</span>(entry) &gt; <span class="number">100</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        has_timestamp = <span class="built_in">bool</span>(re.search(patterns[<span class="string">&#x27;timestamp&#x27;</span>], entry))</span><br><span class="line">        has_log_level = <span class="built_in">bool</span>(re.search(patterns[<span class="string">&#x27;log_level&#x27;</span>], entry))</span><br><span class="line">        has_json = <span class="built_in">bool</span>(re.search(patterns[<span class="string">&#x27;json_object&#x27;</span>], entry))</span><br><span class="line">        </span><br><span class="line">        stats[<span class="string">&#x27;has_timestamp&#x27;</span>] += <span class="number">1</span> <span class="keyword">if</span> has_timestamp <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        stats[<span class="string">&#x27;has_log_level&#x27;</span>] += <span class="number">1</span> <span class="keyword">if</span> has_log_level <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        stats[<span class="string">&#x27;has_json&#x27;</span>] += <span class="number">1</span> <span class="keyword">if</span> has_json <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查嵌套JSON</span></span><br><span class="line">        <span class="keyword">if</span> has_json:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                json_match = re.search(<span class="string">r&#x27;(\&#123;.*\&#125;)&#x27;</span>, entry, re.DOTALL)</span><br><span class="line">                <span class="keyword">if</span> json_match:</span><br><span class="line">                    json_str = json_match.group(<span class="number">1</span>)</span><br><span class="line">                    parsed = json.loads(json_str)</span><br><span class="line">                    <span class="keyword">if</span> has_nested_structure(parsed):</span><br><span class="line">                        stats[<span class="string">&#x27;has_nested_json&#x27;</span>] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查完整性</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> has_timestamp <span class="keyword">or</span> <span class="keyword">not</span> has_log_level:</span><br><span class="line">            stats[<span class="string">&#x27;incomplete_records&#x27;</span>] += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  时间戳: <span class="subst">&#123;<span class="string">&#x27;✓&#x27;</span> <span class="keyword">if</span> has_timestamp <span class="keyword">else</span> <span class="string">&#x27;✗&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  日志级别: <span class="subst">&#123;<span class="string">&#x27;✓&#x27;</span> <span class="keyword">if</span> has_log_level <span class="keyword">else</span> <span class="string">&#x27;✗&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  JSON数据: <span class="subst">&#123;<span class="string">&#x27;✓&#x27;</span> <span class="keyword">if</span> has_json <span class="keyword">else</span> <span class="string">&#x27;✗&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n统计摘要:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  总日志条目: <span class="subst">&#123;stats[<span class="string">&#x27;total_entries&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  包含时间戳: <span class="subst">&#123;stats[<span class="string">&#x27;has_timestamp&#x27;</span>]&#125;</span> (<span class="subst">&#123;stats[<span class="string">&#x27;has_timestamp&#x27;</span>]/stats[<span class="string">&#x27;total_entries&#x27;</span>]*<span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  包含日志级别: <span class="subst">&#123;stats[<span class="string">&#x27;has_log_level&#x27;</span>]&#125;</span> (<span class="subst">&#123;stats[<span class="string">&#x27;has_log_level&#x27;</span>]/stats[<span class="string">&#x27;total_entries&#x27;</span>]*<span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  包含JSON: <span class="subst">&#123;stats[<span class="string">&#x27;has_json&#x27;</span>]&#125;</span> (<span class="subst">&#123;stats[<span class="string">&#x27;has_json&#x27;</span>]/stats[<span class="string">&#x27;total_entries&#x27;</span>]*<span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  包含嵌套JSON: <span class="subst">&#123;stats[<span class="string">&#x27;has_nested_json&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  不完整记录: <span class="subst">&#123;stats[<span class="string">&#x27;incomplete_records&#x27;</span>]&#125;</span> (<span class="subst">&#123;stats[<span class="string">&#x27;incomplete_records&#x27;</span>]/stats[<span class="string">&#x27;total_entries&#x27;</span>]*<span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> stats</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">has_nested_structure</span>(<span class="params">obj, depth=<span class="number">0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查JSON对象是否有嵌套结构&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> depth &gt; <span class="number">3</span>:  <span class="comment"># 防止无限递归</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">dict</span>):</span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> obj.values():</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, (<span class="built_in">dict</span>, <span class="built_in">list</span>)):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">elif</span> has_nested_structure(value, depth + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">list</span>):</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> obj:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(item, (<span class="built_in">dict</span>, <span class="built_in">list</span>)):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">elif</span> has_nested_structure(item, depth + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_with_regex</span>(<span class="params">log_entries</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用正则表达式提取关键信息&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正则表达式提取:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 定义提取模式</span></span><br><span class="line">    patterns = &#123;</span><br><span class="line">        <span class="string">&#x27;timestamp&#x27;</span>: <span class="string">r&#x27;(\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125; \d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;)&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;log_level&#x27;</span>: <span class="string">r&#x27;\[(INFO|ERROR|WARN|DEBUG|WARNING)\]&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;json_data&#x27;</span>: <span class="string">r&#x27;(\&#123;.*\&#125;)&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: <span class="string">r&#x27;user[_\s]?id[:\s&quot;]*([^\s,&quot;&#125;]+)&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ip_address&#x27;</span>: <span class="string">r&#x27;(\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;)&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;error_code&#x27;</span>: <span class="string">r&#x27;error[_\s]?code[:\s&quot;]*(\d+)&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;amount&#x27;</span>: <span class="string">r&#x27;amount[:\s\$]*([\d.]+)&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;order_id&#x27;</span>: <span class="string">r&#x27;order[_\s]?id[:\s&quot;]*([^\s,&quot;&#125;]+)&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    extracted_data = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, entry <span class="keyword">in</span> <span class="built_in">enumerate</span>(log_entries):</span><br><span class="line">        entry_data = &#123;</span><br><span class="line">            <span class="string">&#x27;line_number&#x27;</span>: i + <span class="number">1</span>,</span><br><span class="line">            <span class="string">&#x27;original_entry&#x27;</span>: entry,</span><br><span class="line">            <span class="string">&#x27;extracted_fields&#x27;</span>: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 提取各个字段</span></span><br><span class="line">        <span class="keyword">for</span> field, pattern <span class="keyword">in</span> patterns.items():</span><br><span class="line">            matches = re.findall(pattern, entry, re.IGNORECASE)</span><br><span class="line">            <span class="keyword">if</span> matches:</span><br><span class="line">                entry_data[<span class="string">&#x27;extracted_fields&#x27;</span>][field] = matches[<span class="number">0</span>] <span class="keyword">if</span> <span class="built_in">len</span>(matches) == <span class="number">1</span> <span class="keyword">else</span> matches</span><br><span class="line">        </span><br><span class="line">        extracted_data.append(entry_data)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示提取结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正则表达式提取结果:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> extracted_data[:<span class="number">5</span>]:  <span class="comment"># 显示前5个结果</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n行号 <span class="subst">&#123;data[<span class="string">&#x27;line_number&#x27;</span>]&#125;</span>:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  原始: <span class="subst">&#123;data[<span class="string">&#x27;original_entry&#x27;</span>][:<span class="number">80</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;extracted_fields&#x27;</span>]:</span><br><span class="line">            <span class="keyword">for</span> field, value <span class="keyword">in</span> data[<span class="string">&#x27;extracted_fields&#x27;</span>].items():</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;field&#125;</span>: <span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;  无提取字段&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> extracted_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_json_structures</span>(<span class="params">log_entries</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解析嵌套JSON结构&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;JSON结构解析:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    parsed_data = []</span><br><span class="line">    json_parse_stats = &#123;</span><br><span class="line">        <span class="string">&#x27;successful_parses&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;failed_parses&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;nested_structures&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;array_structures&#x27;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, entry <span class="keyword">in</span> <span class="built_in">enumerate</span>(log_entries):</span><br><span class="line">        entry_data = &#123;</span><br><span class="line">            <span class="string">&#x27;line_number&#x27;</span>: i + <span class="number">1</span>,</span><br><span class="line">            <span class="string">&#x27;original_entry&#x27;</span>: entry,</span><br><span class="line">            <span class="string">&#x27;json_data&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&#x27;parse_success&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">&#x27;parse_error&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&#x27;flattened_fields&#x27;</span>: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 尝试提取和解析JSON</span></span><br><span class="line">        json_match = re.search(<span class="string">r&#x27;(\&#123;.*\&#125;)&#x27;</span>, entry, re.DOTALL)</span><br><span class="line">        <span class="keyword">if</span> json_match:</span><br><span class="line">            json_str = json_match.group(<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 尝试解析JSON</span></span><br><span class="line">                parsed_json = json.loads(json_str)</span><br><span class="line">                entry_data[<span class="string">&#x27;json_data&#x27;</span>] = parsed_json</span><br><span class="line">                entry_data[<span class="string">&#x27;parse_success&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">                json_parse_stats[<span class="string">&#x27;successful_parses&#x27;</span>] += <span class="number">1</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 检查嵌套结构</span></span><br><span class="line">                <span class="keyword">if</span> has_nested_structure(parsed_json):</span><br><span class="line">                    json_parse_stats[<span class="string">&#x27;nested_structures&#x27;</span>] += <span class="number">1</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 展平嵌套结构</span></span><br><span class="line">                flattened = flatten_json(parsed_json)</span><br><span class="line">                entry_data[<span class="string">&#x27;flattened_fields&#x27;</span>] = flattened</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 检查数组结构</span></span><br><span class="line">                <span class="keyword">if</span> has_array_structure(parsed_json):</span><br><span class="line">                    json_parse_stats[<span class="string">&#x27;array_structures&#x27;</span>] += <span class="number">1</span></span><br><span class="line">                </span><br><span class="line">            <span class="keyword">except</span> json.JSONDecodeError <span class="keyword">as</span> e:</span><br><span class="line">                entry_data[<span class="string">&#x27;parse_error&#x27;</span>] = <span class="built_in">str</span>(e)</span><br><span class="line">                json_parse_stats[<span class="string">&#x27;failed_parses&#x27;</span>] += <span class="number">1</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 尝试修复常见的JSON格式错误</span></span><br><span class="line">                fixed_json = try_fix_json(json_str)</span><br><span class="line">                <span class="keyword">if</span> fixed_json:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        parsed_json = json.loads(fixed_json)</span><br><span class="line">                        entry_data[<span class="string">&#x27;json_data&#x27;</span>] = parsed_json</span><br><span class="line">                        entry_data[<span class="string">&#x27;parse_success&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">                        entry_data[<span class="string">&#x27;flattened_fields&#x27;</span>] = flatten_json(parsed_json)</span><br><span class="line">                        json_parse_stats[<span class="string">&#x27;successful_parses&#x27;</span>] += <span class="number">1</span></span><br><span class="line">                        json_parse_stats[<span class="string">&#x27;failed_parses&#x27;</span>] -= <span class="number">1</span></span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;行 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: JSON修复成功&quot;</span>)</span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">        parsed_data.append(entry_data)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示解析统计</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;JSON解析统计:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  成功解析: <span class="subst">&#123;json_parse_stats[<span class="string">&#x27;successful_parses&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  解析失败: <span class="subst">&#123;json_parse_stats[<span class="string">&#x27;failed_parses&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  嵌套结构: <span class="subst">&#123;json_parse_stats[<span class="string">&#x27;nested_structures&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  数组结构: <span class="subst">&#123;json_parse_stats[<span class="string">&#x27;array_structures&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示解析示例</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\nJSON解析示例:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> parsed_data[:<span class="number">3</span>]:</span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;parse_success&#x27;</span>] <span class="keyword">and</span> data[<span class="string">&#x27;flattened_fields&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n行号 <span class="subst">&#123;data[<span class="string">&#x27;line_number&#x27;</span>]&#125;</span>:&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> key, value <span class="keyword">in</span> <span class="built_in">list</span>(data[<span class="string">&#x27;flattened_fields&#x27;</span>].items())[:<span class="number">5</span>]:  <span class="comment"># 显示前5个字段</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;key&#125;</span>: <span class="subst">&#123;<span class="built_in">str</span>(value)[:<span class="number">50</span>]&#125;</span><span class="subst">&#123;<span class="string">&#x27;...&#x27;</span> <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">str</span>(value)) &gt; <span class="number">50</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> parsed_data, json_parse_stats</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flatten_json</span>(<span class="params">obj, parent_key=<span class="string">&#x27;&#x27;</span>, sep=<span class="string">&#x27;_&#x27;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;展平嵌套JSON结构&quot;&quot;&quot;</span></span><br><span class="line">    items = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">dict</span>):</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> obj.items():</span><br><span class="line">            new_key = <span class="string">f&quot;<span class="subst">&#123;parent_key&#125;</span><span class="subst">&#123;sep&#125;</span><span class="subst">&#123;k&#125;</span>&quot;</span> <span class="keyword">if</span> parent_key <span class="keyword">else</span> k</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(v, <span class="built_in">dict</span>):</span><br><span class="line">                items.update(flatten_json(v, new_key, sep=sep))</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(v, <span class="built_in">list</span>):</span><br><span class="line">                <span class="comment"># 处理数组 - 转换为字符串或进一步处理</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">all</span>(<span class="built_in">isinstance</span>(item, (<span class="built_in">str</span>, <span class="built_in">int</span>, <span class="built_in">float</span>)) <span class="keyword">for</span> item <span class="keyword">in</span> v):</span><br><span class="line">                    items[new_key] = <span class="string">&#x27;, &#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, v))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 对于复杂数组，只取第一个元素进行展平（简化处理）</span></span><br><span class="line">                    <span class="keyword">if</span> v <span class="keyword">and</span> <span class="built_in">isinstance</span>(v[<span class="number">0</span>], <span class="built_in">dict</span>):</span><br><span class="line">                        items.update(flatten_json(v[<span class="number">0</span>], <span class="string">f&quot;<span class="subst">&#123;new_key&#125;</span>_item0&quot;</span>, sep=sep))</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        items[new_key] = <span class="built_in">str</span>(v)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                items[new_key] = v</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        items[parent_key] = obj</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> items</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">has_array_structure</span>(<span class="params">obj</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查对象是否包含数组结构&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">list</span>) <span class="keyword">and</span> <span class="built_in">len</span>(obj) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">dict</span>):</span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> obj.values():</span><br><span class="line">            <span class="keyword">if</span> has_array_structure(value):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">try_fix_json</span>(<span class="params">json_str</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;尝试修复常见的JSON格式错误&quot;&quot;&quot;</span></span><br><span class="line">    fixes = [</span><br><span class="line">        <span class="comment"># 修复缺少引号的键</span></span><br><span class="line">        (<span class="string">r&#x27;(\w+):&#x27;</span>, <span class="string">r&#x27;&quot;\1&quot;:&#x27;</span>),</span><br><span class="line">        <span class="comment"># 修复单引号</span></span><br><span class="line">        (<span class="string">r&quot;&#x27;&quot;</span>, <span class="string">&#x27;&quot;&#x27;</span>),</span><br><span class="line">        <span class="comment"># 修复尾随逗号</span></span><br><span class="line">        (<span class="string">r&#x27;,\s*&#125;&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>),</span><br><span class="line">        (<span class="string">r&#x27;,\s*]&#x27;</span>, <span class="string">&#x27;]&#x27;</span>),</span><br><span class="line">        <span class="comment"># 修复未转义的控制字符</span></span><br><span class="line">        (<span class="string">r&#x27;\n&#x27;</span>, <span class="string">&#x27;\\n&#x27;</span>),</span><br><span class="line">        (<span class="string">r&#x27;\t&#x27;</span>, <span class="string">&#x27;\\t&#x27;</span>),</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    fixed = json_str</span><br><span class="line">    <span class="keyword">for</span> pattern, replacement <span class="keyword">in</span> fixes:</span><br><span class="line">        fixed = re.sub(pattern, replacement, fixed)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> fixed</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_incomplete_records</span>(<span class="params">parsed_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;处理不完整记录&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;不完整记录处理:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    incomplete_records = []</span><br><span class="line">    completion_strategies = &#123;</span><br><span class="line">        <span class="string">&#x27;missing_timestamp&#x27;</span>: <span class="string">&#x27;从上下文推断或使用当前时间&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;missing_log_level&#x27;</span>: <span class="string">&#x27;根据内容推断级别&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;malformed_json&#x27;</span>: <span class="string">&#x27;尝试修复或提取可用部分&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;partial_data&#x27;</span>: <span class="string">&#x27;标记为不完整但保留可用信息&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> parsed_data:</span><br><span class="line">        entry = data[<span class="string">&#x27;original_entry&#x27;</span>]</span><br><span class="line">        issues = []</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检测问题</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(<span class="string">r&#x27;\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125; \d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;&#x27;</span>, entry):</span><br><span class="line">            issues.append(<span class="string">&#x27;missing_timestamp&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(<span class="string">r&#x27;\[(INFO|ERROR|WARN|DEBUG)\]&#x27;</span>, entry):</span><br><span class="line">            issues.append(<span class="string">&#x27;missing_log_level&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data[<span class="string">&#x27;parse_success&#x27;</span>] <span class="keyword">and</span> re.search(<span class="string">r&#x27;\&#123;.*\&#125;&#x27;</span>, entry):</span><br><span class="line">            issues.append(<span class="string">&#x27;malformed_json&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(entry.strip()) &lt; <span class="number">10</span>:  <span class="comment"># 非常短的记录</span></span><br><span class="line">            issues.append(<span class="string">&#x27;partial_data&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> issues:</span><br><span class="line">            record_info = &#123;</span><br><span class="line">                <span class="string">&#x27;line_number&#x27;</span>: data[<span class="string">&#x27;line_number&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;original_entry&#x27;</span>: entry,</span><br><span class="line">                <span class="string">&#x27;issues&#x27;</span>: issues,</span><br><span class="line">                <span class="string">&#x27;suggested_fixes&#x27;</span>: [completion_strategies[issue] <span class="keyword">for</span> issue <span class="keyword">in</span> issues],</span><br><span class="line">                <span class="string">&#x27;repaired_entry&#x27;</span>: repair_incomplete_record(data, issues)</span><br><span class="line">            &#125;</span><br><span class="line">            incomplete_records.append(record_info)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示不完整记录</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;发现 <span class="subst">&#123;<span class="built_in">len</span>(incomplete_records)&#125;</span> 个不完整记录:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> record <span class="keyword">in</span> incomplete_records[:<span class="number">5</span>]:  <span class="comment"># 显示前5个</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n行号 <span class="subst">&#123;record[<span class="string">&#x27;line_number&#x27;</span>]&#125;</span>:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  问题: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(record[<span class="string">&#x27;issues&#x27;</span>])&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  原始: <span class="subst">&#123;record[<span class="string">&#x27;original_entry&#x27;</span>][:<span class="number">80</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  修复建议: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(record[<span class="string">&#x27;suggested_fixes&#x27;</span>])&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> record[<span class="string">&#x27;repaired_entry&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  修复后: <span class="subst">&#123;record[<span class="string">&#x27;repaired_entry&#x27;</span>][:<span class="number">80</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> incomplete_records</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">repair_incomplete_record</span>(<span class="params">data, issues</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;修复不完整记录&quot;&quot;&quot;</span></span><br><span class="line">    entry = data[<span class="string">&#x27;original_entry&#x27;</span>]</span><br><span class="line">    repaired = entry</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 修复缺失的时间戳</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;missing_timestamp&#x27;</span> <span class="keyword">in</span> issues:</span><br><span class="line">        <span class="comment"># 尝试从JSON中提取时间戳</span></span><br><span class="line">        <span class="keyword">if</span> data.get(<span class="string">&#x27;json_data&#x27;</span>) <span class="keyword">and</span> <span class="string">&#x27;timestamp&#x27;</span> <span class="keyword">in</span> data[<span class="string">&#x27;json_data&#x27;</span>]:</span><br><span class="line">            timestamp = data[<span class="string">&#x27;json_data&#x27;</span>][<span class="string">&#x27;timestamp&#x27;</span>]</span><br><span class="line">            repaired = <span class="string">f&quot;<span class="subst">&#123;timestamp&#125;</span> <span class="subst">&#123;repaired&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 使用当前时间作为占位符</span></span><br><span class="line">            current_time = datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">            repaired = <span class="string">f&quot;<span class="subst">&#123;current_time&#125;</span> <span class="subst">&#123;repaired&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 修复缺失的日志级别</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;missing_log_level&#x27;</span> <span class="keyword">in</span> issues:</span><br><span class="line">        <span class="comment"># 根据内容推断日志级别</span></span><br><span class="line">        entry_lower = entry.lower()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">any</span>(word <span class="keyword">in</span> entry_lower <span class="keyword">for</span> word <span class="keyword">in</span> [<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;failed&#x27;</span>, <span class="string">&#x27;exception&#x27;</span>]):</span><br><span class="line">            log_level = <span class="string">&#x27;[ERROR]&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">any</span>(word <span class="keyword">in</span> entry_lower <span class="keyword">for</span> word <span class="keyword">in</span> [<span class="string">&#x27;warn&#x27;</span>, <span class="string">&#x27;warning&#x27;</span>]):</span><br><span class="line">            log_level = <span class="string">&#x27;[WARN]&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">any</span>(word <span class="keyword">in</span> entry_lower <span class="keyword">for</span> word <span class="keyword">in</span> [<span class="string">&#x27;debug&#x27;</span>, <span class="string">&#x27;trace&#x27;</span>]):</span><br><span class="line">            log_level = <span class="string">&#x27;[DEBUG]&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            log_level = <span class="string">&#x27;[INFO]&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 插入日志级别</span></span><br><span class="line">        <span class="keyword">if</span> re.search(<span class="string">r&#x27;\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125; \d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;&#x27;</span>, repaired):</span><br><span class="line">            repaired = re.sub(<span class="string">r&#x27;(\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125; \d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;)&#x27;</span>, <span class="string">r&#x27;\1 &#x27;</span> + log_level, repaired)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            repaired = <span class="string">f&quot;<span class="subst">&#123;log_level&#125;</span> <span class="subst">&#123;repaired&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 修复格式错误的JSON</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;malformed_json&#x27;</span> <span class="keyword">in</span> issues <span class="keyword">and</span> data.get(<span class="string">&#x27;parse_error&#x27;</span>):</span><br><span class="line">        json_match = re.search(<span class="string">r&#x27;(\&#123;.*\&#125;)&#x27;</span>, entry, re.DOTALL)</span><br><span class="line">        <span class="keyword">if</span> json_match:</span><br><span class="line">            original_json = json_match.group(<span class="number">1</span>)</span><br><span class="line">            fixed_json = try_fix_json(original_json)</span><br><span class="line">            repaired = repaired.replace(original_json, fixed_json)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> repaired</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_structured_dataframe</span>(<span class="params">parsed_data, incomplete_records</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建结构化的DataFrame&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;创建结构化数据:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    structured_data = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> parsed_data:</span><br><span class="line">        record = &#123;</span><br><span class="line">            <span class="string">&#x27;line_number&#x27;</span>: data[<span class="string">&#x27;line_number&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&#x27;log_level&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&#x27;has_json&#x27;</span>: data[<span class="string">&#x27;parse_success&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;is_complete&#x27;</span>: data[<span class="string">&#x27;line_number&#x27;</span>] <span class="keyword">not</span> <span class="keyword">in</span> [r[<span class="string">&#x27;line_number&#x27;</span>] <span class="keyword">for</span> r <span class="keyword">in</span> incomplete_records]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 提取基础字段</span></span><br><span class="line">        timestamp_match = re.search(<span class="string">r&#x27;(\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125; \d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;)&#x27;</span>, data[<span class="string">&#x27;original_entry&#x27;</span>])</span><br><span class="line">        <span class="keyword">if</span> timestamp_match:</span><br><span class="line">            record[<span class="string">&#x27;timestamp&#x27;</span>] = timestamp_match.group(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        log_level_match = re.search(<span class="string">r&#x27;\[(INFO|ERROR|WARN|DEBUG)\]&#x27;</span>, data[<span class="string">&#x27;original_entry&#x27;</span>])</span><br><span class="line">        <span class="keyword">if</span> log_level_match:</span><br><span class="line">            record[<span class="string">&#x27;log_level&#x27;</span>] = log_level_match.group(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 提取消息部分（去除时间戳和日志级别）</span></span><br><span class="line">        message = data[<span class="string">&#x27;original_entry&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> timestamp_match:</span><br><span class="line">            message = message.replace(timestamp_match.group(<span class="number">0</span>), <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">        <span class="keyword">if</span> log_level_match:</span><br><span class="line">            message = message.replace(<span class="string">f&#x27;[<span class="subst">&#123;log_level_match.group(<span class="number">1</span>)&#125;</span>]&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">        record[<span class="string">&#x27;message&#x27;</span>] = message</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加展平的JSON字段</span></span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;flattened_fields&#x27;</span>]:</span><br><span class="line">            <span class="keyword">for</span> key, value <span class="keyword">in</span> data[<span class="string">&#x27;flattened_fields&#x27;</span>].items():</span><br><span class="line">                <span class="comment"># 简化键名，避免太长的列名</span></span><br><span class="line">                simple_key = re.sub(<span class="string">r&#x27;[^a-zA-Z0-9_]&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, key)</span><br><span class="line">                simple_key = re.sub(<span class="string">r&#x27;_+&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, simple_key).strip(<span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">                record[<span class="string">f&#x27;json_<span class="subst">&#123;simple_key&#125;</span>&#x27;</span>] = value</span><br><span class="line">        </span><br><span class="line">        structured_data.append(record)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建DataFrame</span></span><br><span class="line">    df = pd.DataFrame(structured_data)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;结构化数据维度: <span class="subst">&#123;df.shape[<span class="number">0</span>]&#125;</span> 行, <span class="subst">&#123;df.shape[<span class="number">1</span>]&#125;</span> 列&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;包含JSON的记录: <span class="subst">&#123;df[<span class="string">&#x27;has_json&#x27;</span>].<span class="built_in">sum</span>()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;完整记录: <span class="subst">&#123;df[<span class="string">&#x27;is_complete&#x27;</span>].<span class="built_in">sum</span>()&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示DataFrame的前几行</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n结构化数据示例:&quot;</span>)</span><br><span class="line">    display_columns = [<span class="string">&#x27;line_number&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;log_level&#x27;</span>, <span class="string">&#x27;message&#x27;</span>, <span class="string">&#x27;has_json&#x27;</span>, <span class="string">&#x27;is_complete&#x27;</span>]</span><br><span class="line">    json_columns = [col <span class="keyword">for</span> col <span class="keyword">in</span> df.columns <span class="keyword">if</span> col.startswith(<span class="string">&#x27;json_&#x27;</span>)]</span><br><span class="line">    <span class="keyword">if</span> json_columns:</span><br><span class="line">        display_columns.extend(json_columns[:<span class="number">3</span>])  <span class="comment"># 显示前3个JSON字段</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(df[display_columns].head().to_string(index=<span class="literal">False</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_cleaning_report</span>(<span class="params">stats, json_parse_stats, incomplete_records, df</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成数据清洗报告&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;非结构化数据清洗报告:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    total_records = stats[<span class="string">&#x27;total_entries&#x27;</span>]</span><br><span class="line">    complete_records = df[<span class="string">&#x27;is_complete&#x27;</span>].<span class="built_in">sum</span>()</span><br><span class="line">    records_with_json = df[<span class="string">&#x27;has_json&#x27;</span>].<span class="built_in">sum</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;清洗统计:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 总日志记录: <span class="subst">&#123;total_records&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 成功解析JSON: <span class="subst">&#123;json_parse_stats[<span class="string">&#x27;successful_parses&#x27;</span>]&#125;</span> (<span class="subst">&#123;json_parse_stats[<span class="string">&#x27;successful_parses&#x27;</span>]/total_records*<span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 处理不完整记录: <span class="subst">&#123;<span class="built_in">len</span>(incomplete_records)&#125;</span> (<span class="subst">&#123;<span class="built_in">len</span>(incomplete_records)/total_records*<span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 最终完整记录: <span class="subst">&#123;complete_records&#125;</span> (<span class="subst">&#123;complete_records/total_records*<span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 包含结构化数据: <span class="subst">&#123;records_with_json&#125;</span> (<span class="subst">&#123;records_with_json/total_records*<span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 数据质量评分</span></span><br><span class="line">    quality_score = <span class="number">0</span></span><br><span class="line">    quality_score += (json_parse_stats[<span class="string">&#x27;successful_parses&#x27;</span>] / total_records) * <span class="number">40</span>  <span class="comment"># JSON解析权重</span></span><br><span class="line">    quality_score += (complete_records / total_records) * <span class="number">40</span>  <span class="comment"># 完整性权重</span></span><br><span class="line">    quality_score += (stats[<span class="string">&#x27;has_timestamp&#x27;</span>] / total_records) * <span class="number">10</span>  <span class="comment"># 时间戳权重</span></span><br><span class="line">    quality_score += (stats[<span class="string">&#x27;has_log_level&#x27;</span>] / total_records) * <span class="number">10</span>  <span class="comment"># 日志级别权重</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 数据质量评分: <span class="subst">&#123;quality_score:<span class="number">.1</span>f&#125;</span>/100&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> quality_score &gt;= <span class="number">80</span>:</span><br><span class="line">        grade = <span class="string">&quot;优秀&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> quality_score &gt;= <span class="number">70</span>:</span><br><span class="line">        grade = <span class="string">&quot;良好&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> quality_score &gt;= <span class="number">60</span>:</span><br><span class="line">        grade = <span class="string">&quot;一般&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        grade = <span class="string">&quot;需要改进&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  • 质量等级: <span class="subst">&#123;grade&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> quality_score, grade</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_cleaned_data</span>(<span class="params">df, quality_score, grade</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;保存清洗后的数据&quot;&quot;&quot;</span></span><br><span class="line">    output_file = <span class="string">&#x27;cleaned_log_data.csv&#x27;</span></span><br><span class="line">    df.to_csv(output_file, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n清洗后的数据已保存到: <span class="subst">&#123;output_file&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存JSON字段单独的文件（如果有的话）</span></span><br><span class="line">    json_columns = [col <span class="keyword">for</span> col <span class="keyword">in</span> df.columns <span class="keyword">if</span> col.startswith(<span class="string">&#x27;json_&#x27;</span>)]</span><br><span class="line">    <span class="keyword">if</span> json_columns:</span><br><span class="line">        json_df = df[[<span class="string">&#x27;line_number&#x27;</span>] + json_columns]</span><br><span class="line">        json_output_file = <span class="string">&#x27;extracted_json_fields.csv&#x27;</span></span><br><span class="line">        json_df.to_csv(json_output_file, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;提取的JSON字段已保存到: <span class="subst">&#123;json_output_file&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存清洗报告</span></span><br><span class="line">    report_file = <span class="string">&#x27;log_cleaning_report.txt&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(report_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">&quot;非结构化日志数据清洗报告\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;=&quot;</span> * <span class="number">50</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;生成时间: <span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)&#125;</span>\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;数据质量评分: <span class="subst">&#123;quality_score:<span class="number">.1</span>f&#125;</span>/100\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;质量等级: <span class="subst">&#123;grade&#125;</span>\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">f&quot;输出文件: <span class="subst">&#123;output_file&#125;</span>\n\n&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        f.write(<span class="string">&quot;清洗总结:\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;  • 使用正则表达式提取了关键信息\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;  • 解析了嵌套JSON结构并展平\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;  • 处理了不完整记录并尝试修复\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;  • 创建了结构化的数据表\n&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;清洗报告已保存到: <span class="subst">&#123;report_file&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;非结构化数据清洗脚本&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">100</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建测试数据</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;创建测试日志数据...&quot;</span>)</span><br><span class="line">    log_entries = create_test_log_data()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 分析日志结构</span></span><br><span class="line">    stats = analyze_log_structure(log_entries)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用正则表达式提取信息</span></span><br><span class="line">    extracted_data = extract_with_regex(log_entries)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 解析JSON结构</span></span><br><span class="line">    parsed_data, json_parse_stats = parse_json_structures(log_entries)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理不完整记录</span></span><br><span class="line">    incomplete_records = handle_incomplete_records(parsed_data)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建结构化数据</span></span><br><span class="line">    df = create_structured_dataframe(parsed_data, incomplete_records)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 生成清洗报告</span></span><br><span class="line">    quality_score, grade = generate_cleaning_report(stats, json_parse_stats, incomplete_records, df)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存结果</span></span><br><span class="line">    save_cleaned_data(df, quality_score, grade)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">100</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;非结构化数据清洗完成!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li><li><h3 id="数据质量评估报告"><a href="#数据质量评估报告" class="headerlink" title="数据质量评估报告"></a>数据质量评估报告</h3><ul><li>编写脚本生成数据质量评估报告：<ul><li>计算完整性、准确性、一致性指标</li><li>可视化数据分布和异常</li><li>输出清洗建议</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> stats</span><br><span class="line"><span class="keyword">import</span> missingno <span class="keyword">as</span> msno</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> IsolationForest</span><br><span class="line"><span class="keyword">import</span> plotly.express <span class="keyword">as</span> px</span><br><span class="line"><span class="keyword">import</span> plotly.graph_objects <span class="keyword">as</span> go</span><br><span class="line"><span class="keyword">from</span> plotly.subplots <span class="keyword">import</span> make_subplots</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">plt.style.use(<span class="string">&#x27;default&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataQualityAnalyzer</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;数据质量分析器&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, df, name=<span class="string">&quot;数据集&quot;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.df = df.copy()</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.quality_metrics = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.visualizations = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.cleaning_recommendations = []</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_sample_data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;创建包含各种数据质量问题的测试数据&quot;&quot;&quot;</span></span><br><span class="line">        np.random.seed(<span class="number">42</span>)</span><br><span class="line">        </span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;customer_id&#x27;</span>: <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1001</span>),</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: [<span class="string">f&#x27;Customer_<span class="subst">&#123;i&#125;</span>&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1001</span>)],</span><br><span class="line">            <span class="string">&#x27;age&#x27;</span>: np.random.normal(<span class="number">35</span>, <span class="number">10</span>, <span class="number">1000</span>).clip(<span class="number">18</span>, <span class="number">80</span>).astype(<span class="built_in">int</span>),</span><br><span class="line">            <span class="string">&#x27;email&#x27;</span>: [<span class="string">f&#x27;user<span class="subst">&#123;i&#125;</span>@example.com&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1001</span>)],</span><br><span class="line">            <span class="string">&#x27;phone&#x27;</span>: [<span class="string">f&#x27;138<span class="subst">&#123;<span class="built_in">str</span>(i).zfill(<span class="number">8</span>)&#125;</span>&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1001</span>)],</span><br><span class="line">            <span class="string">&#x27;registration_date&#x27;</span>: pd.date_range(<span class="string">&#x27;2020-01-01&#x27;</span>, periods=<span class="number">1000</span>, freq=<span class="string">&#x27;D&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;last_login&#x27;</span>: pd.date_range(<span class="string">&#x27;2023-01-01&#x27;</span>, periods=<span class="number">1000</span>, freq=<span class="string">&#x27;H&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;total_spent&#x27;</span>: np.random.exponential(<span class="number">100</span>, <span class="number">1000</span>),</span><br><span class="line">            <span class="string">&#x27;order_count&#x27;</span>: np.random.poisson(<span class="number">5</span>, <span class="number">1000</span>),</span><br><span class="line">            <span class="string">&#x27;city&#x27;</span>: np.random.choice([<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;深圳&#x27;</span>, <span class="string">&#x27;杭州&#x27;</span>, <span class="string">&#x27;成都&#x27;</span>], <span class="number">1000</span>),</span><br><span class="line">            <span class="string">&#x27;segment&#x27;</span>: np.random.choice([<span class="string">&#x27;VIP&#x27;</span>, <span class="string">&#x27;普通&#x27;</span>, <span class="string">&#x27;新用户&#x27;</span>], <span class="number">1000</span>, p=[<span class="number">0.1</span>, <span class="number">0.7</span>, <span class="number">0.2</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加数据质量问题</span></span><br><span class="line">        df_sample = pd.DataFrame(data)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 缺失值</span></span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">50</span>).index, <span class="string">&#x27;age&#x27;</span>] = np.nan</span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">30</span>).index, <span class="string">&#x27;email&#x27;</span>] = <span class="literal">None</span></span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">20</span>).index, <span class="string">&#x27;phone&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">40</span>).index, <span class="string">&#x27;last_login&#x27;</span>] = pd.NaT</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 异常值</span></span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">10</span>).index, <span class="string">&#x27;age&#x27;</span>] = [<span class="number">150</span>, -<span class="number">5</span>, <span class="number">200</span>, <span class="number">0</span>, <span class="number">999</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>]</span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">15</span>).index, <span class="string">&#x27;total_spent&#x27;</span>] = [-<span class="number">1000</span>, <span class="number">50000</span>, <span class="number">100000</span>, <span class="number">250000</span>, <span class="number">500000</span>] * <span class="number">3</span></span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">8</span>).index, <span class="string">&#x27;order_count&#x27;</span>] = [-<span class="number">10</span>, <span class="number">1000</span>, <span class="number">500</span>, <span class="number">300</span>, <span class="number">200</span>, <span class="number">150</span>, <span class="number">120</span>, <span class="number">80</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. 不一致数据</span></span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">25</span>).index, <span class="string">&#x27;city&#x27;</span>] = [<span class="string">&#x27;Unknown&#x27;</span>, <span class="string">&#x27;其他&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>, <span class="string">&#x27;Beijing&#x27;</span>, <span class="string">&#x27;Shanghai&#x27;</span>]</span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">20</span>).index, <span class="string">&#x27;segment&#x27;</span>] = [<span class="string">&#x27;VIP&#x27;</span>, <span class="string">&#x27;vip&#x27;</span>, <span class="string">&#x27;普通客户&#x27;</span>, <span class="string">&#x27;新用户&#x27;</span>, <span class="string">&#x27;New&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. 格式问题</span></span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">15</span>).index, <span class="string">&#x27;email&#x27;</span>] = [<span class="string">&#x27;invalid&#x27;</span>, <span class="string">&#x27;user@&#x27;</span>, <span class="string">&#x27;@domain.com&#x27;</span>, <span class="string">&#x27;no.at.sign&#x27;</span>]</span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">12</span>).index, <span class="string">&#x27;phone&#x27;</span>] = [<span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;123456789012345&#x27;</span>, <span class="string">&#x27;abc12345678&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 5. 逻辑错误</span></span><br><span class="line">        df_sample.loc[df_sample.sample(<span class="number">5</span>).index, <span class="string">&#x27;registration_date&#x27;</span>] = df_sample[<span class="string">&#x27;last_login&#x27;</span>] + timedelta(days=<span class="number">30</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> df_sample</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_completeness_metrics</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;计算完整性指标&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;计算完整性指标...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        completeness = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 总体缺失率</span></span><br><span class="line">        total_cells = <span class="variable language_">self</span>.df.size</span><br><span class="line">        missing_cells = <span class="variable language_">self</span>.df.isnull().<span class="built_in">sum</span>().<span class="built_in">sum</span>() + (<span class="variable language_">self</span>.df == <span class="string">&#x27;&#x27;</span>).<span class="built_in">sum</span>().<span class="built_in">sum</span>()</span><br><span class="line">        completeness[<span class="string">&#x27;overall_missing_rate&#x27;</span>] = (missing_cells / total_cells) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 各列缺失率</span></span><br><span class="line">        column_missing_rates = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> column <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns:</span><br><span class="line">            null_count = <span class="variable language_">self</span>.df[column].isnull().<span class="built_in">sum</span>()</span><br><span class="line">            empty_count = (<span class="variable language_">self</span>.df[column] == <span class="string">&#x27;&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line">            total_count = <span class="built_in">len</span>(<span class="variable language_">self</span>.df)</span><br><span class="line">            column_missing_rates[column] = ((null_count + empty_count) / total_count) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        completeness[<span class="string">&#x27;column_missing_rates&#x27;</span>] = column_missing_rates</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. 完整记录比例</span></span><br><span class="line">        complete_records = <span class="variable language_">self</span>.df.notnull().<span class="built_in">all</span>(axis=<span class="number">1</span>).<span class="built_in">sum</span>()</span><br><span class="line">        completeness[<span class="string">&#x27;complete_record_rate&#x27;</span>] = (complete_records / <span class="built_in">len</span>(<span class="variable language_">self</span>.df)) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. 数据覆盖度（基于关键字段）</span></span><br><span class="line">        key_columns = [<span class="string">&#x27;customer_id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;email&#x27;</span>]  <span class="comment"># 假设这些是关键字段</span></span><br><span class="line">        key_coverage = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> key_columns:</span><br><span class="line">            <span class="keyword">if</span> col <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns:</span><br><span class="line">                coverage = (<span class="variable language_">self</span>.df[col].notnull().<span class="built_in">sum</span>() / <span class="built_in">len</span>(<span class="variable language_">self</span>.df)) * <span class="number">100</span></span><br><span class="line">                key_coverage[col] = coverage</span><br><span class="line">        </span><br><span class="line">        completeness[<span class="string">&#x27;key_field_coverage&#x27;</span>] = key_coverage</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;completeness&#x27;</span>] = completeness</span><br><span class="line">        <span class="keyword">return</span> completeness</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_accuracy_metrics</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;计算准确性指标&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;计算准确性指标...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        accuracy = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 格式准确性</span></span><br><span class="line">        format_accuracy = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 邮箱格式验证</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;email&#x27;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns:</span><br><span class="line">            email_pattern = <span class="string">r&#x27;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,&#125;$&#x27;</span></span><br><span class="line">            valid_emails = <span class="variable language_">self</span>.df[<span class="string">&#x27;email&#x27;</span>].<span class="built_in">str</span>.<span class="keyword">match</span>(email_pattern, na=<span class="literal">False</span>).<span class="built_in">sum</span>()</span><br><span class="line">            format_accuracy[<span class="string">&#x27;email&#x27;</span>] = (valid_emails / <span class="variable language_">self</span>.df[<span class="string">&#x27;email&#x27;</span>].notnull().<span class="built_in">sum</span>()) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 手机号格式验证</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;phone&#x27;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns:</span><br><span class="line">            phone_pattern = <span class="string">r&#x27;^1[3-9]\d&#123;9&#125;$&#x27;</span></span><br><span class="line">            valid_phones = <span class="variable language_">self</span>.df[<span class="string">&#x27;phone&#x27;</span>].<span class="built_in">str</span>.<span class="keyword">match</span>(phone_pattern, na=<span class="literal">False</span>).<span class="built_in">sum</span>()</span><br><span class="line">            format_accuracy[<span class="string">&#x27;phone&#x27;</span>] = (valid_phones / <span class="variable language_">self</span>.df[<span class="string">&#x27;phone&#x27;</span>].notnull().<span class="built_in">sum</span>()) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        accuracy[<span class="string">&#x27;format_accuracy&#x27;</span>] = format_accuracy</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 范围准确性</span></span><br><span class="line">        range_accuracy = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;age&#x27;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns:</span><br><span class="line">            valid_ages = <span class="variable language_">self</span>.df[<span class="string">&#x27;age&#x27;</span>].between(<span class="number">0</span>, <span class="number">120</span>).<span class="built_in">sum</span>()</span><br><span class="line">            range_accuracy[<span class="string">&#x27;age&#x27;</span>] = (valid_ages / <span class="variable language_">self</span>.df[<span class="string">&#x27;age&#x27;</span>].notnull().<span class="built_in">sum</span>()) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;total_spent&#x27;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns:</span><br><span class="line">            valid_spent = (<span class="variable language_">self</span>.df[<span class="string">&#x27;total_spent&#x27;</span>] &gt;= <span class="number">0</span>).<span class="built_in">sum</span>()</span><br><span class="line">            range_accuracy[<span class="string">&#x27;total_spent&#x27;</span>] = (valid_spent / <span class="variable language_">self</span>.df[<span class="string">&#x27;total_spent&#x27;</span>].notnull().<span class="built_in">sum</span>()) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        accuracy[<span class="string">&#x27;range_accuracy&#x27;</span>] = range_accuracy</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. 业务规则准确性</span></span><br><span class="line">        business_accuracy = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查注册日期早于最后登录日期</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(col <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns <span class="keyword">for</span> col <span class="keyword">in</span> [<span class="string">&#x27;registration_date&#x27;</span>, <span class="string">&#x27;last_login&#x27;</span>]):</span><br><span class="line">            date_logic_valid = (<span class="variable language_">self</span>.df[<span class="string">&#x27;registration_date&#x27;</span>] &lt;= <span class="variable language_">self</span>.df[<span class="string">&#x27;last_login&#x27;</span>]).<span class="built_in">sum</span>()</span><br><span class="line">            business_accuracy[<span class="string">&#x27;date_logic&#x27;</span>] = (date_logic_valid / <span class="built_in">len</span>(<span class="variable language_">self</span>.df)) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查订单数量与消费金额的逻辑关系</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(col <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns <span class="keyword">for</span> col <span class="keyword">in</span> [<span class="string">&#x27;order_count&#x27;</span>, <span class="string">&#x27;total_spent&#x27;</span>]):</span><br><span class="line">            <span class="comment"># 简单逻辑：有订单应该有消费，有消费应该有订单</span></span><br><span class="line">            order_spent_logic = ((<span class="variable language_">self</span>.df[<span class="string">&#x27;order_count&#x27;</span>] &gt; <span class="number">0</span>) == (<span class="variable language_">self</span>.df[<span class="string">&#x27;total_spent&#x27;</span>] &gt; <span class="number">0</span>)).<span class="built_in">sum</span>()</span><br><span class="line">            business_accuracy[<span class="string">&#x27;order_spent_logic&#x27;</span>] = (order_spent_logic / <span class="built_in">len</span>(<span class="variable language_">self</span>.df)) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        accuracy[<span class="string">&#x27;business_accuracy&#x27;</span>] = business_accuracy</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;accuracy&#x27;</span>] = accuracy</span><br><span class="line">        <span class="keyword">return</span> accuracy</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_consistency_metrics</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;计算一致性指标&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;计算一致性指标...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        consistency = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 数据类型一致性</span></span><br><span class="line">        type_consistency = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> column <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns:</span><br><span class="line">            <span class="comment"># 检查列中数据类型是否一致</span></span><br><span class="line">            unique_dtypes = <span class="variable language_">self</span>.df[column].apply(<span class="built_in">type</span>).nunique()</span><br><span class="line">            type_consistency[column] = unique_dtypes == <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        consistency[<span class="string">&#x27;type_consistency&#x27;</span>] = type_consistency</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 值域一致性</span></span><br><span class="line">        domain_consistency = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 分类字段的值域检查</span></span><br><span class="line">        categorical_columns = <span class="variable language_">self</span>.df.select_dtypes(include=[<span class="string">&#x27;object&#x27;</span>]).columns</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> categorical_columns:</span><br><span class="line">            <span class="keyword">if</span> col <span class="keyword">in</span> [<span class="string">&#x27;city&#x27;</span>, <span class="string">&#x27;segment&#x27;</span>]:  <span class="comment"># 假设这些是已知的分类字段</span></span><br><span class="line">                expected_values = &#123;</span><br><span class="line">                    <span class="string">&#x27;city&#x27;</span>: [<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;深圳&#x27;</span>, <span class="string">&#x27;杭州&#x27;</span>, <span class="string">&#x27;成都&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;segment&#x27;</span>: [<span class="string">&#x27;VIP&#x27;</span>, <span class="string">&#x27;普通&#x27;</span>, <span class="string">&#x27;新用户&#x27;</span>]</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> col <span class="keyword">in</span> expected_values:</span><br><span class="line">                    valid_values = <span class="variable language_">self</span>.df[col].isin(expected_values[col]).<span class="built_in">sum</span>()</span><br><span class="line">                    domain_consistency[col] = (valid_values / <span class="variable language_">self</span>.df[col].notnull().<span class="built_in">sum</span>()) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        consistency[<span class="string">&#x27;domain_consistency&#x27;</span>] = domain_consistency</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. 重复数据检查</span></span><br><span class="line">        duplicate_metrics = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 完全重复记录</span></span><br><span class="line">        complete_duplicates = <span class="variable language_">self</span>.df.duplicated().<span class="built_in">sum</span>()</span><br><span class="line">        duplicate_metrics[<span class="string">&#x27;complete_duplicates&#x27;</span>] = (complete_duplicates / <span class="built_in">len</span>(<span class="variable language_">self</span>.df)) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 基于关键字段的部分重复</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;customer_id&#x27;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns:</span><br><span class="line">            key_duplicates = <span class="variable language_">self</span>.df.duplicated(subset=[<span class="string">&#x27;customer_id&#x27;</span>]).<span class="built_in">sum</span>()</span><br><span class="line">            duplicate_metrics[<span class="string">&#x27;key_duplicates&#x27;</span>] = (key_duplicates / <span class="built_in">len</span>(<span class="variable language_">self</span>.df)) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        consistency[<span class="string">&#x27;duplicate_metrics&#x27;</span>] = duplicate_metrics</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. 跨字段一致性</span></span><br><span class="line">        cross_field_consistency = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查城市和客户分段的组合是否合理</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(col <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns <span class="keyword">for</span> col <span class="keyword">in</span> [<span class="string">&#x27;city&#x27;</span>, <span class="string">&#x27;segment&#x27;</span>]):</span><br><span class="line">            <span class="comment"># 这里可以定义业务规则，比如某些城市不应该有某些分段</span></span><br><span class="line">            <span class="comment"># 简化示例：检查是否存在异常组合</span></span><br><span class="line">            valid_combinations = <span class="built_in">len</span>(<span class="variable language_">self</span>.df)  <span class="comment"># 假设所有组合都有效</span></span><br><span class="line">            cross_field_consistency[<span class="string">&#x27;city_segment&#x27;</span>] = (valid_combinations / <span class="built_in">len</span>(<span class="variable language_">self</span>.df)) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        consistency[<span class="string">&#x27;cross_field_consistency&#x27;</span>] = cross_field_consistency</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;consistency&#x27;</span>] = consistency</span><br><span class="line">        <span class="keyword">return</span> consistency</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detect_anomalies</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;检测数据异常&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;检测数据异常...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        anomalies = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 数值字段的统计异常</span></span><br><span class="line">        numerical_columns = <span class="variable language_">self</span>.df.select_dtypes(include=[np.number]).columns</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> numerical_columns:</span><br><span class="line">            col_data = <span class="variable language_">self</span>.df[col].dropna()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(col_data) &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># 使用Z-score检测异常值</span></span><br><span class="line">                z_scores = np.<span class="built_in">abs</span>(stats.zscore(col_data))</span><br><span class="line">                outliers_z = (z_scores &gt; <span class="number">3</span>).<span class="built_in">sum</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 使用IQR检测异常值</span></span><br><span class="line">                Q1 = col_data.quantile(<span class="number">0.25</span>)</span><br><span class="line">                Q3 = col_data.quantile(<span class="number">0.75</span>)</span><br><span class="line">                IQR = Q3 - Q1</span><br><span class="line">                lower_bound = Q1 - <span class="number">1.5</span> * IQR</span><br><span class="line">                upper_bound = Q3 + <span class="number">1.5</span> * IQR</span><br><span class="line">                outliers_iqr = ((col_data &lt; lower_bound) | (col_data &gt; upper_bound)).<span class="built_in">sum</span>()</span><br><span class="line">                </span><br><span class="line">                anomalies[col] = &#123;</span><br><span class="line">                    <span class="string">&#x27;z_score_outliers&#x27;</span>: outliers_z,</span><br><span class="line">                    <span class="string">&#x27;z_score_outlier_rate&#x27;</span>: (outliers_z / <span class="built_in">len</span>(col_data)) * <span class="number">100</span>,</span><br><span class="line">                    <span class="string">&#x27;iqr_outliers&#x27;</span>: outliers_iqr,</span><br><span class="line">                    <span class="string">&#x27;iqr_outlier_rate&#x27;</span>: (outliers_iqr / <span class="built_in">len</span>(col_data)) * <span class="number">100</span></span><br><span class="line">                &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 使用隔离森林检测多变量异常</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(numerical_columns) &gt;= <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                numerical_data = <span class="variable language_">self</span>.df[numerical_columns].dropna()</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(numerical_data) &gt; <span class="number">10</span>:</span><br><span class="line">                    iso_forest = IsolationForest(contamination=<span class="number">0.1</span>, random_state=<span class="number">42</span>)</span><br><span class="line">                    predictions = iso_forest.fit_predict(numerical_data)</span><br><span class="line">                    multivariate_outliers = (predictions == -<span class="number">1</span>).<span class="built_in">sum</span>()</span><br><span class="line">                    anomalies[<span class="string">&#x27;multivariate_outliers&#x27;</span>] = &#123;</span><br><span class="line">                        <span class="string">&#x27;count&#x27;</span>: multivariate_outliers,</span><br><span class="line">                        <span class="string">&#x27;rate&#x27;</span>: (multivariate_outliers / <span class="built_in">len</span>(numerical_data)) * <span class="number">100</span></span><br><span class="line">                    &#125;</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                anomalies[<span class="string">&#x27;multivariate_outliers&#x27;</span>] = &#123;<span class="string">&#x27;count&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;rate&#x27;</span>: <span class="number">0</span>&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;anomalies&#x27;</span>] = anomalies</span><br><span class="line">        <span class="keyword">return</span> anomalies</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_visualizations</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;创建数据质量可视化&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;创建数据可视化...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 缺失值矩阵</span></span><br><span class="line">        plt.figure(figsize=(<span class="number">12</span>, <span class="number">8</span>))</span><br><span class="line">        msno.matrix(<span class="variable language_">self</span>.df)</span><br><span class="line">        plt.title(<span class="string">f&#x27;<span class="subst">&#123;self.name&#125;</span> - 缺失值矩阵&#x27;</span>, fontsize=<span class="number">16</span>, fontweight=<span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line">        plt.tight_layout()</span><br><span class="line">        <span class="variable language_">self</span>.visualizations[<span class="string">&#x27;missing_matrix&#x27;</span>] = <span class="variable language_">self</span>._fig_to_base64(plt)</span><br><span class="line">        plt.close()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 数据完整性热力图</span></span><br><span class="line">        plt.figure(figsize=(<span class="number">10</span>, <span class="number">6</span>))</span><br><span class="line">        completeness_data = []</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="variable language_">self</span>.df.columns:</span><br><span class="line">            complete_rate = (<span class="variable language_">self</span>.df[col].notnull().<span class="built_in">sum</span>() / <span class="built_in">len</span>(<span class="variable language_">self</span>.df)) * <span class="number">100</span></span><br><span class="line">            completeness_data.append(complete_rate)</span><br><span class="line">        </span><br><span class="line">        plt.barh(<span class="variable language_">self</span>.df.columns, completeness_data, color=<span class="string">&#x27;skyblue&#x27;</span>)</span><br><span class="line">        plt.xlabel(<span class="string">&#x27;完整性比例 (%)&#x27;</span>)</span><br><span class="line">        plt.title(<span class="string">&#x27;各字段数据完整性&#x27;</span>, fontsize=<span class="number">14</span>, fontweight=<span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line">        plt.xlim(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">        plt.grid(axis=<span class="string">&#x27;x&#x27;</span>, alpha=<span class="number">0.3</span>)</span><br><span class="line">        plt.tight_layout()</span><br><span class="line">        <span class="variable language_">self</span>.visualizations[<span class="string">&#x27;completeness_bar&#x27;</span>] = <span class="variable language_">self</span>._fig_to_base64(plt)</span><br><span class="line">        plt.close()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. 数值字段分布和异常值</span></span><br><span class="line">        numerical_columns = <span class="variable language_">self</span>.df.select_dtypes(include=[np.number]).columns</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(numerical_columns) &gt; <span class="number">0</span>:</span><br><span class="line">            fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">2</span>, figsize=(<span class="number">15</span>, <span class="number">10</span>))</span><br><span class="line">            axes = axes.flatten()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> i, col <span class="keyword">in</span> <span class="built_in">enumerate</span>(numerical_columns[:<span class="number">4</span>]):  <span class="comment"># 最多显示4个数值字段</span></span><br><span class="line">                <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(axes):</span><br><span class="line">                    data = <span class="variable language_">self</span>.df[col].dropna()</span><br><span class="line">                    axes[i].hist(data, bins=<span class="number">30</span>, alpha=<span class="number">0.7</span>, color=<span class="string">&#x27;lightcoral&#x27;</span>, edgecolor=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">                    axes[i].set_title(<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span> 分布&#x27;</span>, fontweight=<span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line">                    axes[i].set_xlabel(col)</span><br><span class="line">                    axes[i].set_ylabel(<span class="string">&#x27;频数&#x27;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 标记异常值范围</span></span><br><span class="line">                    Q1 = data.quantile(<span class="number">0.25</span>)</span><br><span class="line">                    Q3 = data.quantile(<span class="number">0.75</span>)</span><br><span class="line">                    IQR = Q3 - Q1</span><br><span class="line">                    lower_bound = Q1 - <span class="number">1.5</span> * IQR</span><br><span class="line">                    upper_bound = Q3 + <span class="number">1.5</span> * IQR</span><br><span class="line">                    </span><br><span class="line">                    outliers = data[(data &lt; lower_bound) | (data &gt; upper_bound)]</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">len</span>(outliers) &gt; <span class="number">0</span>:</span><br><span class="line">                        axes[i].axvspan(lower_bound, upper_bound, alpha=<span class="number">0.2</span>, color=<span class="string">&#x27;green&#x27;</span>, label=<span class="string">&#x27;正常范围&#x27;</span>)</span><br><span class="line">                        axes[i].legend()</span><br><span class="line">            </span><br><span class="line">            plt.suptitle(<span class="string">&#x27;数值字段分布与异常值检测&#x27;</span>, fontsize=<span class="number">16</span>, fontweight=<span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line">            plt.tight_layout()</span><br><span class="line">            <span class="variable language_">self</span>.visualizations[<span class="string">&#x27;numerical_distributions&#x27;</span>] = <span class="variable language_">self</span>._fig_to_base64(plt)</span><br><span class="line">            plt.close()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. 分类字段分布</span></span><br><span class="line">        categorical_columns = <span class="variable language_">self</span>.df.select_dtypes(include=[<span class="string">&#x27;object&#x27;</span>]).columns</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(categorical_columns) &gt; <span class="number">0</span>:</span><br><span class="line">            fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">2</span>, figsize=(<span class="number">15</span>, <span class="number">10</span>))</span><br><span class="line">            axes = axes.flatten()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> i, col <span class="keyword">in</span> <span class="built_in">enumerate</span>(categorical_columns[:<span class="number">4</span>]):  <span class="comment"># 最多显示4个分类字段</span></span><br><span class="line">                <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(axes):</span><br><span class="line">                    value_counts = <span class="variable language_">self</span>.df[col].value_counts().head(<span class="number">10</span>)  <span class="comment"># 只显示前10个</span></span><br><span class="line">                    axes[i].bar(value_counts.index, value_counts.values, color=<span class="string">&#x27;lightgreen&#x27;</span>)</span><br><span class="line">                    axes[i].set_title(<span class="string">f&#x27;<span class="subst">&#123;col&#125;</span> 分布&#x27;</span>, fontweight=<span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line">                    axes[i].set_xlabel(col)</span><br><span class="line">                    axes[i].set_ylabel(<span class="string">&#x27;计数&#x27;</span>)</span><br><span class="line">                    axes[i].tick_params(axis=<span class="string">&#x27;x&#x27;</span>, rotation=<span class="number">45</span>)</span><br><span class="line">            </span><br><span class="line">            plt.suptitle(<span class="string">&#x27;分类字段分布&#x27;</span>, fontsize=<span class="number">16</span>, fontweight=<span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line">            plt.tight_layout()</span><br><span class="line">            <span class="variable language_">self</span>.visualizations[<span class="string">&#x27;categorical_distributions&#x27;</span>] = <span class="variable language_">self</span>._fig_to_base64(plt)</span><br><span class="line">            plt.close()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 5. 数据质量评分雷达图</span></span><br><span class="line">        categories = [<span class="string">&#x27;完整性&#x27;</span>, <span class="string">&#x27;准确性&#x27;</span>, <span class="string">&#x27;一致性&#x27;</span>]</span><br><span class="line">        scores = [</span><br><span class="line">            <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;completeness&#x27;</span>][<span class="string">&#x27;complete_record_rate&#x27;</span>],</span><br><span class="line">            np.mean([v <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;accuracy&#x27;</span>][<span class="string">&#x27;format_accuracy&#x27;</span>].items()]) <span class="keyword">if</span> <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;accuracy&#x27;</span>][<span class="string">&#x27;format_accuracy&#x27;</span>] <span class="keyword">else</span> <span class="number">0</span>,</span><br><span class="line">            np.mean([v <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;consistency&#x27;</span>][<span class="string">&#x27;domain_consistency&#x27;</span>].items()]) <span class="keyword">if</span> <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;consistency&#x27;</span>][<span class="string">&#x27;domain_consistency&#x27;</span>] <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 完成雷达图</span></span><br><span class="line">        angles = np.linspace(<span class="number">0</span>, <span class="number">2</span>*np.pi, <span class="built_in">len</span>(categories), endpoint=<span class="literal">False</span>).tolist()</span><br><span class="line">        scores += scores[:<span class="number">1</span>]  <span class="comment"># 闭合雷达图</span></span><br><span class="line">        angles += angles[:<span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line">        fig, ax = plt.subplots(figsize=(<span class="number">8</span>, <span class="number">8</span>), subplot_kw=<span class="built_in">dict</span>(projection=<span class="string">&#x27;polar&#x27;</span>))</span><br><span class="line">        ax.plot(angles, scores, <span class="string">&#x27;o-&#x27;</span>, linewidth=<span class="number">2</span>, label=<span class="string">&#x27;数据质量&#x27;</span>)</span><br><span class="line">        ax.fill(angles, scores, alpha=<span class="number">0.25</span>)</span><br><span class="line">        ax.set_thetagrids(np.degrees(angles[:-<span class="number">1</span>]), categories)</span><br><span class="line">        ax.set_ylim(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">        ax.set_title(<span class="string">&#x27;数据质量评估雷达图&#x27;</span>, size=<span class="number">16</span>, fontweight=<span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line">        ax.grid(<span class="literal">True</span>)</span><br><span class="line">        plt.tight_layout()</span><br><span class="line">        <span class="variable language_">self</span>.visualizations[<span class="string">&#x27;quality_radar&#x27;</span>] = <span class="variable language_">self</span>._fig_to_base64(plt)</span><br><span class="line">        plt.close()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_fig_to_base64</span>(<span class="params">self, fig</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;将matplotlib图形转换为base64字符串&quot;&quot;&quot;</span></span><br><span class="line">        buf = io.BytesIO()</span><br><span class="line">        fig.savefig(buf, <span class="built_in">format</span>=<span class="string">&#x27;png&#x27;</span>, dpi=<span class="number">100</span>, bbox_inches=<span class="string">&#x27;tight&#x27;</span>)</span><br><span class="line">        buf.seek(<span class="number">0</span>)</span><br><span class="line">        img_str = base64.b64encode(buf.read()).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        buf.close()</span><br><span class="line">        <span class="keyword">return</span> img_str</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_cleaning_recommendations</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成数据清洗建议&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;生成清洗建议...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        recommendations = []</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 基于完整性问题的建议</span></span><br><span class="line">        completeness = <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;completeness&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> completeness[<span class="string">&#x27;overall_missing_rate&#x27;</span>] &gt; <span class="number">5</span>:</span><br><span class="line">            recommendations.append(&#123;</span><br><span class="line">                <span class="string">&#x27;category&#x27;</span>: <span class="string">&#x27;完整性&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;issue&#x27;</span>: <span class="string">f&quot;总体缺失率较高 (<span class="subst">&#123;completeness[<span class="string">&#x27;overall_missing_rate&#x27;</span>]:<span class="number">.1</span>f&#125;</span>%)&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;recommendation&#x27;</span>: <span class="string">&#x27;实施数据填充策略，如均值/中位数填充、向前/向后填充或使用机器学习模型预测缺失值&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;priority&#x27;</span>: <span class="string">&#x27;高&#x27;</span> <span class="keyword">if</span> completeness[<span class="string">&#x27;overall_missing_rate&#x27;</span>] &gt; <span class="number">10</span> <span class="keyword">else</span> <span class="string">&#x27;中&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 基于高缺失率的列提出具体建议</span></span><br><span class="line">        <span class="keyword">for</span> col, rate <span class="keyword">in</span> completeness[<span class="string">&#x27;column_missing_rates&#x27;</span>].items():</span><br><span class="line">            <span class="keyword">if</span> rate &gt; <span class="number">20</span>:</span><br><span class="line">                recommendations.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;category&#x27;</span>: <span class="string">&#x27;完整性&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;issue&#x27;</span>: <span class="string">f&quot;字段 &#x27;<span class="subst">&#123;col&#125;</span>&#x27; 缺失严重 (<span class="subst">&#123;rate:<span class="number">.1</span>f&#125;</span>%)&quot;</span>,</span><br><span class="line">                    <span class="string">&#x27;recommendation&#x27;</span>: <span class="string">f&#x27;考虑删除该字段或与业务部门沟通确定填充策略&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;priority&#x27;</span>: <span class="string">&#x27;高&#x27;</span></span><br><span class="line">                &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 基于准确性问题的建议</span></span><br><span class="line">        accuracy = <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;accuracy&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> field, acc_rate <span class="keyword">in</span> accuracy[<span class="string">&#x27;format_accuracy&#x27;</span>].items():</span><br><span class="line">            <span class="keyword">if</span> acc_rate &lt; <span class="number">95</span>:</span><br><span class="line">                recommendations.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;category&#x27;</span>: <span class="string">&#x27;准确性&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;issue&#x27;</span>: <span class="string">f&quot;字段 &#x27;<span class="subst">&#123;field&#125;</span>&#x27; 格式准确率较低 (<span class="subst">&#123;acc_rate:<span class="number">.1</span>f&#125;</span>%)&quot;</span>,</span><br><span class="line">                    <span class="string">&#x27;recommendation&#x27;</span>: <span class="string">f&#x27;实施数据验证规则，使用正则表达式验证<span class="subst">&#123;field&#125;</span>格式，并修正或删除无效记录&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;priority&#x27;</span>: <span class="string">&#x27;中&#x27;</span> <span class="keyword">if</span> acc_rate &gt; <span class="number">80</span> <span class="keyword">else</span> <span class="string">&#x27;高&#x27;</span></span><br><span class="line">                &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 基于一致性问题的建议</span></span><br><span class="line">        consistency = <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;consistency&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> consistency[<span class="string">&#x27;duplicate_metrics&#x27;</span>][<span class="string">&#x27;complete_duplicates&#x27;</span>] &gt; <span class="number">1</span>:</span><br><span class="line">            recommendations.append(&#123;</span><br><span class="line">                <span class="string">&#x27;category&#x27;</span>: <span class="string">&#x27;一致性&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;issue&#x27;</span>: <span class="string">f&quot;发现完全重复记录 (<span class="subst">&#123;consistency[<span class="string">&#x27;duplicate_metrics&#x27;</span>][<span class="string">&#x27;complete_duplicates&#x27;</span>]:<span class="number">.1</span>f&#125;</span>%)&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;recommendation&#x27;</span>: <span class="string">&#x27;实施去重流程，基于业务键删除重复记录&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;priority&#x27;</span>: <span class="string">&#x27;高&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 基于异常值的建议</span></span><br><span class="line">        anomalies = <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;anomalies&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> col, anomaly_info <span class="keyword">in</span> anomalies.items():</span><br><span class="line">            <span class="keyword">if</span> col != <span class="string">&#x27;multivariate_outliers&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span> anomaly_info[<span class="string">&#x27;z_score_outlier_rate&#x27;</span>] &gt; <span class="number">5</span>:</span><br><span class="line">                    recommendations.append(&#123;</span><br><span class="line">                        <span class="string">&#x27;category&#x27;</span>: <span class="string">&#x27;准确性&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;issue&#x27;</span>: <span class="string">f&quot;字段 &#x27;<span class="subst">&#123;col&#125;</span>&#x27; 异常值较多 (Z-score: <span class="subst">&#123;anomaly_info[<span class="string">&#x27;z_score_outlier_rate&#x27;</span>]:<span class="number">.1</span>f&#125;</span>%)&quot;</span>,</span><br><span class="line">                        <span class="string">&#x27;recommendation&#x27;</span>: <span class="string">f&#x27;分析异常值原因，根据业务规则进行修正、删除或保留&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;priority&#x27;</span>: <span class="string">&#x27;中&#x27;</span></span><br><span class="line">                    &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.cleaning_recommendations = recommendations</span><br><span class="line">        <span class="keyword">return</span> recommendations</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_overall_quality_score</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;计算总体数据质量评分&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;计算总体质量评分...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        completeness = <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;completeness&#x27;</span>]</span><br><span class="line">        accuracy = <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;accuracy&#x27;</span>]</span><br><span class="line">        consistency = <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;consistency&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 权重分配</span></span><br><span class="line">        weights = &#123;</span><br><span class="line">            <span class="string">&#x27;completeness&#x27;</span>: <span class="number">0.4</span>,  <span class="comment"># 完整性最重要</span></span><br><span class="line">            <span class="string">&#x27;accuracy&#x27;</span>: <span class="number">0.35</span>,     <span class="comment"># 准确性次重要</span></span><br><span class="line">            <span class="string">&#x27;consistency&#x27;</span>: <span class="number">0.25</span>   <span class="comment"># 一致性相对次要</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 完整性得分 (基于完整记录比例)</span></span><br><span class="line">        completeness_score = completeness[<span class="string">&#x27;complete_record_rate&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 准确性得分 (平均各种准确性指标)</span></span><br><span class="line">        accuracy_components = []</span><br><span class="line">        <span class="keyword">if</span> accuracy[<span class="string">&#x27;format_accuracy&#x27;</span>]:</span><br><span class="line">            accuracy_components.append(np.mean(<span class="built_in">list</span>(accuracy[<span class="string">&#x27;format_accuracy&#x27;</span>].values())))</span><br><span class="line">        <span class="keyword">if</span> accuracy[<span class="string">&#x27;range_accuracy&#x27;</span>]:</span><br><span class="line">            accuracy_components.append(np.mean(<span class="built_in">list</span>(accuracy[<span class="string">&#x27;range_accuracy&#x27;</span>].values())))</span><br><span class="line">        <span class="keyword">if</span> accuracy[<span class="string">&#x27;business_accuracy&#x27;</span>]:</span><br><span class="line">            accuracy_components.append(np.mean(<span class="built_in">list</span>(accuracy[<span class="string">&#x27;business_accuracy&#x27;</span>].values())))</span><br><span class="line">        </span><br><span class="line">        accuracy_score = np.mean(accuracy_components) <span class="keyword">if</span> accuracy_components <span class="keyword">else</span> <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 一致性得分</span></span><br><span class="line">        consistency_components = []</span><br><span class="line">        <span class="keyword">if</span> consistency[<span class="string">&#x27;domain_consistency&#x27;</span>]:</span><br><span class="line">            consistency_components.append(np.mean(<span class="built_in">list</span>(consistency[<span class="string">&#x27;domain_consistency&#x27;</span>].values())))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 考虑重复数据的影响</span></span><br><span class="line">        duplicate_penalty = consistency[<span class="string">&#x27;duplicate_metrics&#x27;</span>][<span class="string">&#x27;complete_duplicates&#x27;</span>]</span><br><span class="line">        consistency_score = (np.mean(consistency_components) <span class="keyword">if</span> consistency_components <span class="keyword">else</span> <span class="number">100</span>) - duplicate_penalty</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 计算加权总分</span></span><br><span class="line">        overall_score = (</span><br><span class="line">            completeness_score * weights[<span class="string">&#x27;completeness&#x27;</span>] +</span><br><span class="line">            accuracy_score * weights[<span class="string">&#x27;accuracy&#x27;</span>] +</span><br><span class="line">            <span class="built_in">max</span>(consistency_score, <span class="number">0</span>) * weights[<span class="string">&#x27;consistency&#x27;</span>]</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 确定质量等级</span></span><br><span class="line">        <span class="keyword">if</span> overall_score &gt;= <span class="number">90</span>:</span><br><span class="line">            quality_grade = <span class="string">&quot;优秀&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> overall_score &gt;= <span class="number">80</span>:</span><br><span class="line">            quality_grade = <span class="string">&quot;良好&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> overall_score &gt;= <span class="number">70</span>:</span><br><span class="line">            quality_grade = <span class="string">&quot;一般&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> overall_score &gt;= <span class="number">60</span>:</span><br><span class="line">            quality_grade = <span class="string">&quot;及格&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            quality_grade = <span class="string">&quot;不及格&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;overall_score&#x27;</span>] = overall_score</span><br><span class="line">        <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;quality_grade&#x27;</span>] = quality_grade</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> overall_score, quality_grade</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_html_report</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成HTML格式的数据质量报告&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;生成HTML报告...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        overall_score = <span class="variable language_">self</span>.quality_metrics.get(<span class="string">&#x27;overall_score&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">        quality_grade = <span class="variable language_">self</span>.quality_metrics.get(<span class="string">&#x27;quality_grade&#x27;</span>, <span class="string">&#x27;未知&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        html_content = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;html lang=&quot;zh-CN&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;数据质量评估报告 - <span class="subst">&#123;self.name&#125;</span>&lt;/title&gt;</span></span><br><span class="line"><span class="string">            &lt;style&gt;</span></span><br><span class="line"><span class="string">                body &#123;&#123; font-family: Arial, sans-serif; margin: 20px; color: #333; &#125;&#125;</span></span><br><span class="line"><span class="string">                .header &#123;&#123; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; &#125;&#125;</span></span><br><span class="line"><span class="string">                .score-card &#123;&#123; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; &#125;&#125;</span></span><br><span class="line"><span class="string">                .metric-card &#123;&#123; background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #007bff; &#125;&#125;</span></span><br><span class="line"><span class="string">                .recommendation &#123;&#123; background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #ffc107; &#125;&#125;</span></span><br><span class="line"><span class="string">                .high-priority &#123;&#123; border-left-color: #dc3545 !important; background: #f8d7da; &#125;&#125;</span></span><br><span class="line"><span class="string">                .medium-priority &#123;&#123; border-left-color: #ffc107 !important; background: #fff3cd; &#125;&#125;</span></span><br><span class="line"><span class="string">                .low-priority &#123;&#123; border-left-color: #28a745 !important; background: #d4edda; &#125;&#125;</span></span><br><span class="line"><span class="string">                .visualization &#123;&#123; text-align: center; margin: 20px 0; &#125;&#125;</span></span><br><span class="line"><span class="string">                img &#123;&#123; max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 5px; &#125;&#125;</span></span><br><span class="line"><span class="string">                table &#123;&#123; width: 100%; border-collapse: collapse; margin: 15px 0; &#125;&#125;</span></span><br><span class="line"><span class="string">                th, td &#123;&#123; padding: 12px; text-align: left; border-bottom: 1px solid #ddd; &#125;&#125;</span></span><br><span class="line"><span class="string">                th &#123;&#123; background-color: #f2f2f2; &#125;&#125;</span></span><br><span class="line"><span class="string">                .quality-badge &#123;&#123; display: inline-block; padding: 5px 15px; border-radius: 20px; color: white; font-weight: bold; &#125;&#125;</span></span><br><span class="line"><span class="string">                .excellent &#123;&#123; background: #28a745; &#125;&#125;</span></span><br><span class="line"><span class="string">                .good &#123;&#123; background: #17a2b8; &#125;&#125;</span></span><br><span class="line"><span class="string">                .average &#123;&#123; background: #ffc107; color: #333; &#125;&#125;</span></span><br><span class="line"><span class="string">                .poor &#123;&#123; background: #dc3545; &#125;&#125;</span></span><br><span class="line"><span class="string">            &lt;/style&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;header&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h1&gt;数据质量评估报告&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                &lt;h2&gt;<span class="subst">&#123;self.name&#125;</span>&lt;/h2&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;生成时间: <span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            &lt;div class=&quot;score-card&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h2&gt;总体质量评估&lt;/h2&gt;</span></span><br><span class="line"><span class="string">                &lt;div style=&quot;display: flex; align-items: center; gap: 20px;&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div style=&quot;flex: 1;&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;h3&gt;质量评分: &lt;span class=&quot;quality-badge <span class="subst">&#123;quality_grade.lower()&#125;</span>&quot;&gt;<span class="subst">&#123;overall_score:<span class="number">.1</span>f&#125;</span>/100 - <span class="subst">&#123;quality_grade&#125;</span>&lt;/span&gt;&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                        &lt;p&gt;数据集包含 <span class="subst">&#123;<span class="built_in">len</span>(self.df)&#125;</span> 条记录，<span class="subst">&#123;<span class="built_in">len</span>(self.df.columns)&#125;</span> 个字段&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;div style=&quot;flex: 1;&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;img src=&quot;data:image/png;base64,<span class="subst">&#123;self.visualizations.get(<span class="string">&#x27;quality_radar&#x27;</span>, <span class="string">&#x27;&#x27;</span>)&#125;</span>&quot; alt=&quot;质量雷达图&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            &lt;div class=&quot;score-card&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h2&gt;详细质量指标&lt;/h2&gt;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                &lt;h3&gt;完整性指标&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;metric-card&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;p&gt;&lt;strong&gt;总体缺失率:&lt;/strong&gt; <span class="subst">&#123;self.quality_metrics[<span class="string">&#x27;completeness&#x27;</span>][<span class="string">&#x27;overall_missing_rate&#x27;</span>]:<span class="number">.2</span>f&#125;</span>%&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;p&gt;&lt;strong&gt;完整记录比例:&lt;/strong&gt; <span class="subst">&#123;self.quality_metrics[<span class="string">&#x27;completeness&#x27;</span>][<span class="string">&#x27;complete_record_rate&#x27;</span>]:<span class="number">.2</span>f&#125;</span>%&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                &lt;h3&gt;准确性指标&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;metric-card&quot;&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加准确性指标</span></span><br><span class="line">        <span class="keyword">for</span> field, accuracy <span class="keyword">in</span> <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;accuracy&#x27;</span>][<span class="string">&#x27;format_accuracy&#x27;</span>].items():</span><br><span class="line">            html_content += <span class="string">f&#x27;&lt;p&gt;&lt;strong&gt;<span class="subst">&#123;field&#125;</span>格式准确率:&lt;/strong&gt; <span class="subst">&#123;accuracy:<span class="number">.2</span>f&#125;</span>%&lt;/p&gt;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> field, accuracy <span class="keyword">in</span> <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;accuracy&#x27;</span>][<span class="string">&#x27;range_accuracy&#x27;</span>].items():</span><br><span class="line">            html_content += <span class="string">f&#x27;&lt;p&gt;&lt;strong&gt;<span class="subst">&#123;field&#125;</span>范围准确率:&lt;/strong&gt; <span class="subst">&#123;accuracy:<span class="number">.2</span>f&#125;</span>%&lt;/p&gt;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        html_content += <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                &lt;h3&gt;一致性指标&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;metric-card&quot;&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加一致性指标</span></span><br><span class="line">        html_content += <span class="string">f&#x27;&lt;p&gt;&lt;strong&gt;完全重复记录:&lt;/strong&gt; <span class="subst">&#123;self.quality_metrics[<span class="string">&quot;consistency&quot;</span>][<span class="string">&quot;duplicate_metrics&quot;</span>][<span class="string">&quot;complete_duplicates&quot;</span>]:<span class="number">.2</span>f&#125;</span>%&lt;/p&gt;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;key_duplicates&#x27;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.quality_metrics[<span class="string">&quot;consistency&quot;</span>][<span class="string">&quot;duplicate_metrics&quot;</span>]:</span><br><span class="line">            html_content += <span class="string">f&#x27;&lt;p&gt;&lt;strong&gt;关键字段重复:&lt;/strong&gt; <span class="subst">&#123;self.quality_metrics[<span class="string">&quot;consistency&quot;</span>][<span class="string">&quot;duplicate_metrics&quot;</span>][<span class="string">&quot;key_duplicates&quot;</span>]:<span class="number">.2</span>f&#125;</span>%&lt;/p&gt;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        html_content += <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            &lt;div class=&quot;score-card&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h2&gt;数据可视化&lt;/h2&gt;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                &lt;div class=&quot;visualization&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;h3&gt;缺失值分析&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                    &lt;img src=&quot;data:image/png;base64,&quot;&quot;&quot;</span> + <span class="variable language_">self</span>.visualizations.get(<span class="string">&#x27;missing_matrix&#x27;</span>, <span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;&quot;&quot;&quot; alt=&quot;缺失值矩阵&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                &lt;div class=&quot;visualization&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;h3&gt;字段完整性&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                    &lt;img src=&quot;data:image/png;base64,&quot;&quot;&quot;</span> + <span class="variable language_">self</span>.visualizations.get(<span class="string">&#x27;completeness_bar&#x27;</span>, <span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;&quot;&quot;&quot; alt=&quot;字段完整性&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加数值字段分布</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;numerical_distributions&#x27;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.visualizations:</span><br><span class="line">            html_content += <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;visualization&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;h3&gt;数值字段分布与异常值&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                    &lt;img src=&quot;data:image/png;base64,&quot;&quot;&quot;</span> + <span class="variable language_">self</span>.visualizations[<span class="string">&#x27;numerical_distributions&#x27;</span>] + <span class="string">&quot;&quot;&quot;&quot; alt=&quot;数值字段分布&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加分类字段分布</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;categorical_distributions&#x27;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.visualizations:</span><br><span class="line">            html_content += <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;visualization&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;h3&gt;分类字段分布&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                    &lt;img src=&quot;data:image/png;base64,&quot;&quot;&quot;</span> + <span class="variable language_">self</span>.visualizations[<span class="string">&#x27;categorical_distributions&#x27;</span>] + <span class="string">&quot;&quot;&quot;&quot; alt=&quot;分类字段分布&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        html_content += <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            &lt;div class=&quot;score-card&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h2&gt;数据清洗建议&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 按优先级分组建议</span></span><br><span class="line">        high_priority = [r <span class="keyword">for</span> r <span class="keyword">in</span> <span class="variable language_">self</span>.cleaning_recommendations <span class="keyword">if</span> r[<span class="string">&#x27;priority&#x27;</span>] == <span class="string">&#x27;高&#x27;</span>]</span><br><span class="line">        medium_priority = [r <span class="keyword">for</span> r <span class="keyword">in</span> <span class="variable language_">self</span>.cleaning_recommendations <span class="keyword">if</span> r[<span class="string">&#x27;priority&#x27;</span>] == <span class="string">&#x27;中&#x27;</span>]</span><br><span class="line">        low_priority = [r <span class="keyword">for</span> r <span class="keyword">in</span> <span class="variable language_">self</span>.cleaning_recommendations <span class="keyword">if</span> r[<span class="string">&#x27;priority&#x27;</span>] == <span class="string">&#x27;低&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> high_priority:</span><br><span class="line">            html_content += <span class="string">&#x27;&lt;h3 style=&quot;color: #dc3545;&quot;&gt;高优先级建议&lt;/h3&gt;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> rec <span class="keyword">in</span> high_priority:</span><br><span class="line">                html_content += <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;recommendation high-priority&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;h4&gt;<span class="subst">&#123;rec[<span class="string">&#x27;category&#x27;</span>]&#125;</span>: <span class="subst">&#123;rec[<span class="string">&#x27;issue&#x27;</span>]&#125;</span>&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                    &lt;p&gt;<span class="subst">&#123;rec[<span class="string">&#x27;recommendation&#x27;</span>]&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> medium_priority:</span><br><span class="line">            html_content += <span class="string">&#x27;&lt;h3 style=&quot;color: #ffc107;&quot;&gt;中优先级建议&lt;/h3&gt;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> rec <span class="keyword">in</span> medium_priority:</span><br><span class="line">                html_content += <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;recommendation medium-priority&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;h4&gt;<span class="subst">&#123;rec[<span class="string">&#x27;category&#x27;</span>]&#125;</span>: <span class="subst">&#123;rec[<span class="string">&#x27;issue&#x27;</span>]&#125;</span>&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                    &lt;p&gt;<span class="subst">&#123;rec[<span class="string">&#x27;recommendation&#x27;</span>]&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> low_priority:</span><br><span class="line">            html_content += <span class="string">&#x27;&lt;h3 style=&quot;color: #28a745;&quot;&gt;低优先级建议&lt;/h3&gt;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> rec <span class="keyword">in</span> low_priority:</span><br><span class="line">                html_content += <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;recommendation low-priority&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;h4&gt;<span class="subst">&#123;rec[<span class="string">&#x27;category&#x27;</span>]&#125;</span>: <span class="subst">&#123;rec[<span class="string">&#x27;issue&#x27;</span>]&#125;</span>&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                    &lt;p&gt;<span class="subst">&#123;rec[<span class="string">&#x27;recommendation&#x27;</span>]&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.cleaning_recommendations:</span><br><span class="line">            html_content += <span class="string">&#x27;&lt;p&gt;数据质量良好，无需重大清洗操作。&lt;/p&gt;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        html_content += <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            &lt;div class=&quot;score-card&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h2&gt;详细质量指标表&lt;/h2&gt;</span></span><br><span class="line"><span class="string">                &lt;table&gt;</span></span><br><span class="line"><span class="string">                    &lt;tr&gt;</span></span><br><span class="line"><span class="string">                        &lt;th&gt;指标类别&lt;/th&gt;</span></span><br><span class="line"><span class="string">                        &lt;th&gt;具体指标&lt;/th&gt;</span></span><br><span class="line"><span class="string">                        &lt;th&gt;数值&lt;/th&gt;</span></span><br><span class="line"><span class="string">                        &lt;th&gt;状态&lt;/th&gt;</span></span><br><span class="line"><span class="string">                    &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加完整性指标表格行</span></span><br><span class="line">        html_content += <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                    &lt;tr&gt;</span></span><br><span class="line"><span class="string">                        &lt;td rowspan=&quot;2&quot;&gt;完整性&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;总体缺失率&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;<span class="subst">&#123;self.quality_metrics[<span class="string">&#x27;completeness&#x27;</span>][<span class="string">&#x27;overall_missing_rate&#x27;</span>]:<span class="number">.2</span>f&#125;</span>%&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;<span class="subst">&#123;<span class="string">&#x27;良好&#x27;</span> <span class="keyword">if</span> self.quality_metrics[<span class="string">&#x27;completeness&#x27;</span>][<span class="string">&#x27;overall_missing_rate&#x27;</span>] &lt; <span class="number">5</span> <span class="keyword">else</span> <span class="string">&#x27;需改进&#x27;</span>&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                    &lt;/tr&gt;</span></span><br><span class="line"><span class="string">                    &lt;tr&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;完整记录比例&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;<span class="subst">&#123;self.quality_metrics[<span class="string">&#x27;completeness&#x27;</span>][<span class="string">&#x27;complete_record_rate&#x27;</span>]:<span class="number">.2</span>f&#125;</span>%&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;<span class="subst">&#123;<span class="string">&#x27;良好&#x27;</span> <span class="keyword">if</span> self.quality_metrics[<span class="string">&#x27;completeness&#x27;</span>][<span class="string">&#x27;complete_record_rate&#x27;</span>] &gt; <span class="number">90</span> <span class="keyword">else</span> <span class="string">&#x27;需改进&#x27;</span>&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                    &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加准确性指标表格行</span></span><br><span class="line">        row_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> field, accuracy <span class="keyword">in</span> <span class="variable language_">self</span>.quality_metrics[<span class="string">&#x27;accuracy&#x27;</span>][<span class="string">&#x27;format_accuracy&#x27;</span>].items():</span><br><span class="line">            status = <span class="string">&#x27;良好&#x27;</span> <span class="keyword">if</span> accuracy &gt; <span class="number">95</span> <span class="keyword">else</span> <span class="string">&#x27;需改进&#x27;</span></span><br><span class="line">            html_content += <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                    &lt;tr&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;<span class="subst">&#123;<span class="string">&#x27;准确性&#x27;</span> <span class="keyword">if</span> row_count == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;<span class="subst">&#123;field&#125;</span>格式准确率&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;<span class="subst">&#123;accuracy:<span class="number">.2</span>f&#125;</span>%&lt;/td&gt;</span></span><br><span class="line"><span class="string">                        &lt;td&gt;<span class="subst">&#123;status&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                    &lt;/tr&gt;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">            row_count += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        html_content += <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &lt;/table&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            &lt;footer style=&quot;text-align: center; margin-top: 50px; padding: 20px; border-top: 1px solid #ddd;&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;数据质量评估报告 - 生成于 &#123;datetime.now().strftime(&#x27;%Y-%m-%d&#x27;)&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;/footer&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> html_content</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_full_analysis</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;运行完整的数据质量分析&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;开始分析数据集: <span class="subst">&#123;self.name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 计算各项指标</span></span><br><span class="line">        <span class="variable language_">self</span>.calculate_completeness_metrics()</span><br><span class="line">        <span class="variable language_">self</span>.calculate_accuracy_metrics()</span><br><span class="line">        <span class="variable language_">self</span>.calculate_consistency_metrics()</span><br><span class="line">        <span class="variable language_">self</span>.detect_anomalies()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建可视化</span></span><br><span class="line">        <span class="variable language_">self</span>.create_visualizations()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成建议和总体评分</span></span><br><span class="line">        <span class="variable language_">self</span>.generate_cleaning_recommendations()</span><br><span class="line">        overall_score, quality_grade = <span class="variable language_">self</span>.calculate_overall_quality_score()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成报告</span></span><br><span class="line">        html_report = <span class="variable language_">self</span>.generate_html_report()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 保存报告</span></span><br><span class="line">        report_filename = <span class="string">f&quot;data_quality_report_<span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.html&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(report_filename, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(html_report)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n数据质量分析完成!&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;总体质量评分: <span class="subst">&#123;overall_score:<span class="number">.1</span>f&#125;</span>/100 - <span class="subst">&#123;quality_grade&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;HTML报告已保存: <span class="subst">&#123;report_filename&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.quality_metrics, <span class="variable language_">self</span>.cleaning_recommendations, report_filename</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据质量评估报告生成器&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建分析器实例</span></span><br><span class="line">    analyzer = DataQualityAnalyzer(pd.DataFrame(), <span class="string">&quot;客户数据集&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建示例数据（在实际应用中，这里应该加载真实数据）</span></span><br><span class="line">    sample_data = analyzer.create_sample_data()</span><br><span class="line">    analyzer.df = sample_data</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 运行完整分析</span></span><br><span class="line">    metrics, recommendations, report_file = analyzer.run_full_analysis()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 打印关键发现</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;关键发现摘要:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;1. 总体质量: <span class="subst">&#123;metrics[<span class="string">&#x27;overall_score&#x27;</span>]:<span class="number">.1</span>f&#125;</span>/100 (<span class="subst">&#123;metrics[<span class="string">&#x27;quality_grade&#x27;</span>]&#125;</span>)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;2. 数据完整性: <span class="subst">&#123;metrics[<span class="string">&#x27;completeness&#x27;</span>][<span class="string">&#x27;complete_record_rate&#x27;</span>]:<span class="number">.1</span>f&#125;</span>%&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;3. 发现清洗建议: <span class="subst">&#123;<span class="built_in">len</span>(recommendations)&#125;</span> 条&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示高优先级建议</span></span><br><span class="line">    high_priority = [r <span class="keyword">for</span> r <span class="keyword">in</span> recommendations <span class="keyword">if</span> r[<span class="string">&#x27;priority&#x27;</span>] == <span class="string">&#x27;高&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> high_priority:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n高优先级建议 (<span class="subst">&#123;<span class="built_in">len</span>(high_priority)&#125;</span> 条):&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i, rec <span class="keyword">in</span> <span class="built_in">enumerate</span>(high_priority, <span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;i&#125;</span>. <span class="subst">&#123;rec[<span class="string">&#x27;issue&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n详细报告请查看: <span class="subst">&#123;report_file&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li></ol><h2 id="20道SQL语法学习"><a href="#20道SQL语法学习" class="headerlink" title="20道SQL语法学习"></a>20道SQL语法学习</h2><p><strong>基础查询（1-5）</strong></p><ol><li><h3 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 从employees表中选择所有字段，只显示前10条记录</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 从employees表中选择所有字段，只显示前10条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure></li><li><h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询工资大于50000的员工姓名和部门</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询工资大于50000的员工姓名和部门</span></span><br><span class="line"><span class="keyword">SELECT</span> name, department </span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">50000</span>;</span><br></pre></td></tr></table></figure></li><li><h3 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询姓名以&#x27;张&#x27;开头，且包含&#x27;伟&#x27;字的员工</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询在&#x27;技术部&#x27;或&#x27;市场部&#x27;工作，且工龄超过3年的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, department, hire_date</span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> department <span class="keyword">IN</span> (<span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>)</span><br><span class="line">  <span class="keyword">AND</span> DATEDIFF(CURDATE(), hire_date) <span class="operator">&gt;</span> <span class="number">3</span><span class="operator">*</span><span class="number">365</span>;</span><br></pre></td></tr></table></figure></li><li><h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询姓名以&#x27;张&#x27;开头，且包含&#x27;伟&#x27;字的员工</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询姓名以&#x27;张&#x27;开头，且包含&#x27;伟&#x27;字的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;张%&#x27;</span> <span class="keyword">AND</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%伟%&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><h3 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询年龄在25到35岁之间，或者工资在30000到50000之间的员工</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询年龄在25到35岁之间，或者工资在30000到50000之间的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, age, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (age <span class="keyword">BETWEEN</span> <span class="number">25</span> <span class="keyword">AND</span> <span class="number">35</span>) </span><br><span class="line">   <span class="keyword">OR</span> (salary <span class="keyword">BETWEEN</span> <span class="number">30000</span> <span class="keyword">AND</span> <span class="number">50000</span>);</span><br></pre></td></tr></table></figure></li></ol><p><strong>聚合函数（6-10）</strong></p><ol start="6"><li><h3 id="基本聚合"><a href="#基本聚合" class="headerlink" title="基本聚合"></a>基本聚合</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 计算各部门员工数量、平均工资、最高和最低工资</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 计算各部门员工数量、平均工资、最高和最低工资</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    department,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> 员工数量,</span><br><span class="line">    <span class="built_in">AVG</span>(salary) <span class="keyword">as</span> 平均工资,</span><br><span class="line">    <span class="built_in">MAX</span>(salary) <span class="keyword">as</span> 最高工资,</span><br><span class="line">    <span class="built_in">MIN</span>(salary) <span class="keyword">as</span> 最低工资</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department;</span><br></pre></td></tr></table></figure></li><li><h3 id="分组统计"><a href="#分组统计" class="headerlink" title="分组统计"></a>分组统计</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 统计每个部门每个职级的员工数量和平均工资</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 统计每个部门每个职级的员工数量和平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    department,</span><br><span class="line">    position,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> 员工数量,</span><br><span class="line">    <span class="built_in">AVG</span>(salary) <span class="keyword">as</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department, position</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> department, position;</span><br></pre></td></tr></table></figure></li><li><h3 id="分组过滤"><a href="#分组过滤" class="headerlink" title="分组过滤"></a>分组过滤</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工数量超过10人的部门及其平均工资</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工数量超过10人的部门及其平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    department,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> 员工数量,</span><br><span class="line">    <span class="built_in">AVG</span>(salary) <span class="keyword">as</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure></li><li><h3 id="多维度聚合"><a href="#多维度聚合" class="headerlink" title="多维度聚合"></a>多维度聚合</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按部门和性别统计员工数量，并计算各部门的男女比例</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按部门和性别统计员工数量，并计算各部门的男女比例</span></span><br><span class="line"><span class="keyword">WITH</span> dept_gender_stats <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        department,</span><br><span class="line">        gender,</span><br><span class="line">        <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> count</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department, gender</span><br><span class="line">),</span><br><span class="line">dept_totals <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        department,</span><br><span class="line">        <span class="built_in">SUM</span>(count) <span class="keyword">as</span> total</span><br><span class="line">    <span class="keyword">FROM</span> dept_gender_stats</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    dgs.department,</span><br><span class="line">    dgs.gender,</span><br><span class="line">    dgs.count,</span><br><span class="line">    ROUND(dgs.count <span class="operator">/</span> dt.total <span class="operator">*</span> <span class="number">100</span>, <span class="number">2</span>) <span class="keyword">as</span> 比例</span><br><span class="line"><span class="keyword">FROM</span> dept_gender_stats dgs</span><br><span class="line"><span class="keyword">JOIN</span> dept_totals dt <span class="keyword">ON</span> dgs.department <span class="operator">=</span> dt.department</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dgs.department, dgs.gender;</span><br></pre></td></tr></table></figure></li><li><h3 id="复杂聚合"><a href="#复杂聚合" class="headerlink" title="复杂聚合"></a>复杂聚合</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 计算每个部门的工资差异系数（标准差/平均值）</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 计算每个部门的工资差异系数（标准差/平均值）</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    department,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> 员工数量,</span><br><span class="line">    <span class="built_in">AVG</span>(salary) <span class="keyword">as</span> 平均工资,</span><br><span class="line">    STDDEV(salary) <span class="keyword">as</span> 工资标准差,</span><br><span class="line">    ROUND(STDDEV(salary) <span class="operator">/</span> <span class="built_in">AVG</span>(salary), <span class="number">4</span>) <span class="keyword">as</span> 差异系数</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li></ol><p><strong>多表连接（11-15）</strong></p><ol start="11"><li><h3 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工及其所属部门名称（employees和departments表连接）</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工及其所属部门名称（employees和departments表连接）</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    e.emp_id,</span><br><span class="line">    e.name,</span><br><span class="line">    e.department,</span><br><span class="line">    d.dept_name,</span><br><span class="line">    d.location</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.department <span class="operator">=</span> d.dept_name;</span><br></pre></td></tr></table></figure></li><li><h3 id="左连接"><a href="#左连接" class="headerlink" title="左连接"></a>左连接</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有员工信息，包括没有分配部门的员工</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有员工信息，包括没有分配部门的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    e.emp_id,</span><br><span class="line">    e.name,</span><br><span class="line">    e.department,</span><br><span class="line">    d.dept_name,</span><br><span class="line">    d.location</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.department <span class="operator">=</span> d.dept_name;</span><br></pre></td></tr></table></figure></li><li><h3 id="多表连接"><a href="#多表连接" class="headerlink" title="多表连接"></a>多表连接</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工姓名、部门名称和项目名称（三个表连接）</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工姓名、部门名称和项目名称（三个表连接）</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    e.name <span class="keyword">as</span> 员工姓名,</span><br><span class="line">    d.dept_name <span class="keyword">as</span> 部门名称,</span><br><span class="line">    p.project_name <span class="keyword">as</span> 项目名称,</span><br><span class="line">    ep.role <span class="keyword">as</span> 角色</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.department <span class="operator">=</span> d.dept_name</span><br><span class="line"><span class="keyword">JOIN</span> employee_projects ep <span class="keyword">ON</span> e.emp_id <span class="operator">=</span> ep.emp_id</span><br><span class="line"><span class="keyword">JOIN</span> projects p <span class="keyword">ON</span> ep.project_id <span class="operator">=</span> p.project_id;</span><br></pre></td></tr></table></figure></li><li><h3 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询每个员工及其直接上级的姓名</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询每个员工及其直接上级的姓名</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    e.emp_id,</span><br><span class="line">    e.name <span class="keyword">as</span> 员工姓名,</span><br><span class="line">    e.manager_id,</span><br><span class="line">    m.name <span class="keyword">as</span> 经理姓名</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.emp_id;</span><br></pre></td></tr></table></figure></li><li><h3 id="复杂连接"><a href="#复杂连接" class="headerlink" title="复杂连接"></a>复杂连接</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询参与了多个项目的员工及其参与的项目数量</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询参与了多个项目的员工及其参与的项目数量</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    e.emp_id,</span><br><span class="line">    e.name,</span><br><span class="line">    <span class="built_in">COUNT</span>(ep.project_id) <span class="keyword">as</span> 项目数量,</span><br><span class="line">    GROUP_CONCAT(p.project_name) <span class="keyword">as</span> 参与项目</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> employee_projects ep <span class="keyword">ON</span> e.emp_id <span class="operator">=</span> ep.emp_id</span><br><span class="line"><span class="keyword">JOIN</span> projects p <span class="keyword">ON</span> ep.project_id <span class="operator">=</span> p.project_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> e.emp_id, e.name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(ep.project_id) <span class="operator">&gt;</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li></ol><p><strong>子查询和高级功能（16-20）</strong></p><ol start="16"><li><h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询工资高于本部门平均工资的员工</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询工资高于本部门平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    e.emp_id,</span><br><span class="line">    e.name,</span><br><span class="line">    e.department,</span><br><span class="line">    e.salary,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department <span class="operator">=</span> e.department) <span class="keyword">as</span> 部门平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department <span class="operator">=</span> e.department);</span><br></pre></td></tr></table></figure></li><li><h3 id="相关子查询"><a href="#相关子查询" class="headerlink" title="相关子查询"></a>相关子查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询每个部门工资最高的员工信息</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询每个部门工资最高的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    e.emp_id,</span><br><span class="line">    e.name,</span><br><span class="line">    e.department,</span><br><span class="line">    e.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) </span><br><span class="line">    <span class="keyword">FROM</span> employees </span><br><span class="line">    <span class="keyword">WHERE</span> department <span class="operator">=</span> e.department</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><h3 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 为每个部门的员工按工资排名，显示排名和工资</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 为每个部门的员工按工资排名，显示排名和工资</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    emp_id,</span><br><span class="line">    name,</span><br><span class="line">    department,</span><br><span class="line">    salary,</span><br><span class="line">    <span class="built_in">RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> department <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>) <span class="keyword">as</span> 部门排名,</span><br><span class="line">    <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> department <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>) <span class="keyword">as</span> 部门密集排名,</span><br><span class="line">    <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> department <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>) <span class="keyword">as</span> 部门行号</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure></li><li><h3 id="CASE表达式"><a href="#CASE表达式" class="headerlink" title="CASE表达式"></a>CASE表达式</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将员工按工资水平分类：高(&gt;80000)、中(40000-80000)、低(&lt;40000)</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将员工按工资水平分类：高(&gt;80000)、中(40000-80000)、低(&lt;40000)</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    emp_id,</span><br><span class="line">    name,</span><br><span class="line">    department,</span><br><span class="line">    salary,</span><br><span class="line">    <span class="keyword">CASE</span> </span><br><span class="line">        <span class="keyword">WHEN</span> salary <span class="operator">&gt;</span> <span class="number">80000</span> <span class="keyword">THEN</span> <span class="string">&#x27;高&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> salary <span class="keyword">BETWEEN</span> <span class="number">40000</span> <span class="keyword">AND</span> <span class="number">80000</span> <span class="keyword">THEN</span> <span class="string">&#x27;中&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">&#x27;低&#x27;</span></span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">as</span> 工资水平</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure></li><li><h3 id="递归查询"><a href="#递归查询" class="headerlink" title="递归查询"></a>递归查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工的所有下属（包括间接下属）</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工的所有下属（包括间接下属）</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span> employee_hierarchy <span class="keyword">AS</span> (</span><br><span class="line">    <span class="comment">-- 基础情况：直接下属</span></span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        emp_id,</span><br><span class="line">        name,</span><br><span class="line">        manager_id,</span><br><span class="line">        <span class="number">1</span> <span class="keyword">as</span> level,</span><br><span class="line">        <span class="built_in">CAST</span>(name <span class="keyword">AS</span> <span class="type">CHAR</span>(<span class="number">1000</span>)) <span class="keyword">as</span> hierarchy_path</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 递归情况：间接下属</span></span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        e.emp_id,</span><br><span class="line">        e.name,</span><br><span class="line">        e.manager_id,</span><br><span class="line">        eh.level <span class="operator">+</span> <span class="number">1</span>,</span><br><span class="line">        CONCAT(eh.hierarchy_path, <span class="string">&#x27; -&gt; &#x27;</span>, e.name)</span><br><span class="line">    <span class="keyword">FROM</span> employees e</span><br><span class="line">    <span class="keyword">JOIN</span> employee_hierarchy eh <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> eh.emp_id</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    emp_id,</span><br><span class="line">    name,</span><br><span class="line">    manager_id,</span><br><span class="line">    level,</span><br><span class="line">    hierarchy_path</span><br><span class="line"><span class="keyword">FROM</span> employee_hierarchy</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> level, emp_id;</span><br></pre></td></tr></table></figure></li></ol><h3 id="数据清洗SQL实现"><a href="#数据清洗SQL实现" class="headerlink" title="数据清洗SQL实现"></a>数据清洗SQL实现</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用SQL语句清洗数据：</span></span><br><span class="line"><span class="comment">-- 1. 填充缺失的部门信息（用上一有效值填充）</span></span><br><span class="line"><span class="comment">-- 2. 删除重复的员工记录（保留最新记录）</span></span><br><span class="line"><span class="comment">-- 3. 标准化电话号码格式</span></span><br><span class="line"><span class="comment">-- 4. 标记异常工资值（超出3个标准差）</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用SQL语句清洗数据：</span></span><br><span class="line"><span class="comment">-- 1. 填充缺失的部门信息（用上一有效值填充）</span></span><br><span class="line"><span class="comment">-- 2. 删除重复的员工记录（保留最新记录）</span></span><br><span class="line"><span class="comment">-- 3. 标准化电话号码格式</span></span><br><span class="line"><span class="comment">-- 4. 标记异常工资值（超出3个标准差）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建需要清洗的数据表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employee_cleanup (</span><br><span class="line">    emp_id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    department <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">    record_date <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> employee_cleanup <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;13812345678&#x27;</span>, <span class="number">60000</span>, <span class="string">&#x27;2023-01-15&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;138-1234-5678&#x27;</span>, <span class="number">60000</span>, <span class="string">&#x27;2023-01-16&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;1351234567&#x27;</span>, <span class="number">80000</span>, <span class="string">&#x27;2023-01-15&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;13612345678&#x27;</span>, <span class="number">55000</span>, <span class="string">&#x27;2023-01-17&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;13912345678&#x27;</span>, <span class="number">250000</span>, <span class="string">&#x27;2023-01-15&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;钱七&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="string">&#x27;1371234abcd&#x27;</span>, <span class="number">90000</span>, <span class="string">&#x27;2023-01-18&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;1351234567&#x27;</span>, <span class="number">80000</span>, <span class="string">&#x27;2023-01-19&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据清洗解决方案</span></span><br><span class="line"><span class="keyword">WITH</span> cleaned_data <span class="keyword">AS</span> (</span><br><span class="line">    <span class="comment">-- 1. 填充缺失的部门信息（用上一有效值填充）</span></span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        emp_id,</span><br><span class="line">        name,</span><br><span class="line">        <span class="keyword">CASE</span> </span><br><span class="line">            <span class="keyword">WHEN</span> department <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">THEN</span> </span><br><span class="line">                <span class="built_in">LAG</span>(department) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> emp_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> record_date)</span><br><span class="line">            <span class="keyword">ELSE</span> department</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">as</span> department_filled,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- 2. 标准化电话号码格式</span></span><br><span class="line">        REGEXP_REPLACE(phone, <span class="string">&#x27;[^0-9]&#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> phone_cleaned,</span><br><span class="line">        </span><br><span class="line">        salary,</span><br><span class="line">        record_date,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- 3. 标记异常工资值</span></span><br><span class="line">        <span class="keyword">CASE</span> </span><br><span class="line">            <span class="keyword">WHEN</span> <span class="built_in">ABS</span>(salary <span class="operator">-</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employee_cleanup)) <span class="operator">&gt;</span> </span><br><span class="line">                 <span class="number">3</span> <span class="operator">*</span> (<span class="keyword">SELECT</span> STDDEV(salary) <span class="keyword">FROM</span> employee_cleanup) <span class="keyword">THEN</span> <span class="string">&#x27;异常&#x27;</span></span><br><span class="line">            <span class="keyword">ELSE</span> <span class="string">&#x27;正常&#x27;</span></span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">as</span> salary_status,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- 用于去重的行号</span></span><br><span class="line">        <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (</span><br><span class="line">            <span class="keyword">PARTITION</span> <span class="keyword">BY</span> emp_id, name </span><br><span class="line">            <span class="keyword">ORDER</span> <span class="keyword">BY</span> record_date <span class="keyword">DESC</span></span><br><span class="line">        ) <span class="keyword">as</span> rn</span><br><span class="line">    <span class="keyword">FROM</span> employee_cleanup</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    emp_id,</span><br><span class="line">    name,</span><br><span class="line">    department_filled <span class="keyword">as</span> department,</span><br><span class="line">    <span class="keyword">CASE</span> </span><br><span class="line">        <span class="keyword">WHEN</span> LENGTH(phone_cleaned) <span class="operator">=</span> <span class="number">11</span> <span class="keyword">THEN</span> </span><br><span class="line">            CONCAT(SUBSTR(phone_cleaned, <span class="number">1</span>, <span class="number">3</span>), <span class="string">&#x27;-&#x27;</span>, </span><br><span class="line">                   SUBSTR(phone_cleaned, <span class="number">4</span>, <span class="number">4</span>), <span class="string">&#x27;-&#x27;</span>, </span><br><span class="line">                   SUBSTR(phone_cleaned, <span class="number">8</span>, <span class="number">4</span>))</span><br><span class="line">        <span class="keyword">ELSE</span> phone_cleaned</span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">as</span> phone,</span><br><span class="line">    salary,</span><br><span class="line">    salary_status,</span><br><span class="line">    record_date</span><br><span class="line"><span class="keyword">FROM</span> cleaned_data</span><br><span class="line"><span class="comment">-- 4. 删除重复记录（保留最新记录）</span></span><br><span class="line"><span class="keyword">WHERE</span> rn <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> emp_id, record_date;</span><br></pre></td></tr></table></figure><h1 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h1><h2 id="数据清洗脚本测试数据"><a href="#数据清洗脚本测试数据" class="headerlink" title="数据清洗脚本测试数据"></a>数据清洗脚本测试数据</h2><ol><li><h3 id="缺失值处理-1"><a href="#缺失值处理-1" class="headerlink" title="缺失值处理"></a>缺失值处理</h3><p><strong>测试数据（stundents.csv）：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">id,name,subject,score,exam_date</span><br><span class="line">1,张三,数学,85,2023-06-01</span><br><span class="line">2,李四,数学,,2023-06-01</span><br><span class="line">3,王五,英语,92,</span><br><span class="line">4,,数学,78,2023-06-01</span><br><span class="line">5,赵六,英语,88,2023-06-02</span><br></pre></td></tr></table></figure></li><li><h3 id="重复数据处理-1"><a href="#重复数据处理-1" class="headerlink" title="重复数据处理"></a>重复数据处理</h3><p><strong>测试数据（stundent_records.csv）:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">student_id,name,subject,score,record_date</span><br><span class="line">1001,张三,数学,85,2023-01-15</span><br><span class="line">1001,张三,数学,90,2023-02-20</span><br><span class="line">1002,李四,英语,78,2023-01-15</span><br><span class="line">1001,张三,数学,85,2023-01-15</span><br><span class="line">1003,王五,数学,92,2023-01-16</span><br><span class="line">1002,李四,英语,82,2023-02-18</span><br></pre></td></tr></table></figure></li><li><h3 id="数据类型转换-1"><a href="#数据类型转换-1" class="headerlink" title="数据类型转换"></a>数据类型转换</h3><p><strong>测试数据（mixed_data.csv）：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">id,date_str,price_str,quantity</span><br><span class="line">1,2023-01-15,125.50,10</span><br><span class="line">2,2023/02/20,abc,5</span><br><span class="line">3,2023-03-25,78.00,8</span><br><span class="line">4,invalid_date,45.30,12</span><br><span class="line">5,2023-05-10,120.00,15</span><br></pre></td></tr></table></figure></li><li><h3 id="异常值检测与处理-1"><a href="#异常值检测与处理-1" class="headerlink" title="异常值检测与处理"></a>异常值检测与处理</h3><p><strong>测试数据（scores.csv）：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">student_id,math_score,english_score,physics_score</span><br><span class="line">1,85,92,78</span><br><span class="line">2,120,88,85</span><br><span class="line">3,95,-5,92</span><br><span class="line">4,65,72,150</span><br><span class="line">5,88,91,76</span><br><span class="line">6,45,38,42</span><br><span class="line">7,99,105,98</span><br></pre></td></tr></table></figure></li><li><h3 id="文本数据清洗-1"><a href="#文本数据清洗-1" class="headerlink" title="文本数据清洗"></a>文本数据清洗</h3><p><strong>测试数据（user_comments.csv）：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user_id,comment,phone,email,comment_date</span><br><span class="line">1,这个产品&lt;em&gt;很好&lt;/em&gt;!,13812345678,user1@example.com,2023/01/15</span><br><span class="line">2,不满意!!!,135-1234-5678,user2@gmail.com,2023年2月20日</span><br><span class="line">3,一般般,123456,user3,2023-03-25</span><br><span class="line">4,&lt;div&gt;推荐购买&lt;/div&gt;,13800138000,user4@qq.com,2023-04-10</span><br></pre></td></tr></table></figure></li><li><h3 id="数据标准化-1"><a href="#数据标准化-1" class="headerlink" title="数据标准化"></a>数据标准化</h3><p><strong>测试数据（product_data.csv）：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">product_id,price,sales_volume,rating</span><br><span class="line">1,299,1500,4.5</span><br><span class="line">2,899,800,4.8</span><br><span class="line">3,1599,300,4.2</span><br><span class="line">4,499,1200,4.6</span><br><span class="line">5,1299,450,4.4</span><br></pre></td></tr></table></figure></li><li><h3 id="多源数据整合-1"><a href="#多源数据整合-1" class="headerlink" title="多源数据整合"></a>多源数据整合</h3><p><strong>CSV数据（sales_q1.csv）：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">order_id,customer_id,product,amount,order_date</span><br><span class="line">1001,C001,产品A,299,2023-01-15</span><br><span class="line">1002,C002,产品B,899,2023-02-20</span><br></pre></td></tr></table></figure><p><strong>Excel数据（sales_q2.xlsx）：</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">订单ID,客户ID,产品名称,金额,下单日期</span><br><span class="line">1003,C003,产品C,1599,2023-04-10</span><br><span class="line">1004,C001,产品A,299,2023-05-15</span><br></pre></td></tr></table></figure><p><strong>JSON数据（sales_q3.json）：</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span><span class="attr">&quot;order_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1005&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;customer_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C002&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;product&quot;</span><span class="punctuation">:</span> <span class="string">&quot;产品B&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="number">899</span><span class="punctuation">,</span> <span class="attr">&quot;order_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-07-20&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span><span class="attr">&quot;order_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1006&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;customer_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C004&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;product&quot;</span><span class="punctuation">:</span> <span class="string">&quot;产品D&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="number">499</span><span class="punctuation">,</span> <span class="attr">&quot;order_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-08-15&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="SQL语法学习测试数据"><a href="#SQL语法学习测试数据" class="headerlink" title="SQL语法学习测试数据"></a>SQL语法学习测试数据</h2><p><strong>建表语句和测试数据</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库和表</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE practice_db;</span><br><span class="line">USE practice_db;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    emp_id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    age <span class="type">INT</span>,</span><br><span class="line">    gender <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">    department <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    position <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    hire_date <span class="type">DATE</span>,</span><br><span class="line">    manager_id <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 部门表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    dept_id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    location <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 项目表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> projects (</span><br><span class="line">    project_id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    project_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    start_date <span class="type">DATE</span>,</span><br><span class="line">    end_date <span class="type">DATE</span>,</span><br><span class="line">    budget <span class="type">DECIMAL</span>(<span class="number">12</span>,<span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工项目关联表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employee_projects (</span><br><span class="line">    emp_id <span class="type">INT</span>,</span><br><span class="line">    project_id <span class="type">INT</span>,</span><br><span class="line">    role <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    join_date <span class="type">DATE</span>,</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (emp_id, project_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入测试数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">60000</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;工程师&#x27;</span>, <span class="string">&#x27;2020-03-15&#x27;</span>, <span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="number">35</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">80000</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;经理&#x27;</span>, <span class="string">&#x27;2018-06-01&#x27;</span>, <span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="number">26</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">55000</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;专员&#x27;</span>, <span class="string">&#x27;2021-08-20&#x27;</span>, <span class="number">5</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="number">32</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">75000</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;高级工程师&#x27;</span>, <span class="string">&#x27;2019-02-10&#x27;</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;钱七&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">90000</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;总监&#x27;</span>, <span class="string">&#x27;2016-11-05&#x27;</span>, <span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">6</span>, <span class="string">&#x27;孙八&#x27;</span>, <span class="number">29</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">58000</span>, <span class="string">&#x27;人力资源部&#x27;</span>, <span class="string">&#x27;专员&#x27;</span>, <span class="string">&#x27;2020-09-12&#x27;</span>, <span class="number">8</span>),</span><br><span class="line">(<span class="number">7</span>, <span class="string">&#x27;周九&#x27;</span>, <span class="number">45</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">95000</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;总监&#x27;</span>, <span class="string">&#x27;2015-04-20&#x27;</span>, <span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">8</span>, <span class="string">&#x27;吴十&#x27;</span>, <span class="number">38</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">82000</span>, <span class="string">&#x27;人力资源部&#x27;</span>, <span class="string">&#x27;经理&#x27;</span>, <span class="string">&#x27;2017-07-30&#x27;</span>, <span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">9</span>, <span class="string">&#x27;郑十一&#x27;</span>, <span class="number">31</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">68000</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;经理&#x27;</span>, <span class="string">&#x27;2019-12-01&#x27;</span>, <span class="number">5</span>),</span><br><span class="line">(<span class="number">10</span>, <span class="string">&#x27;王伟&#x27;</span>, <span class="number">27</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">52000</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;工程师&#x27;</span>, <span class="string">&#x27;2022-01-15&#x27;</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">11</span>, <span class="string">&#x27;张伟&#x27;</span>, <span class="number">33</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">72000</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="string">&#x27;经理&#x27;</span>, <span class="string">&#x27;2018-09-10&#x27;</span>, <span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">12</span>, <span class="string">&#x27;李伟&#x27;</span>, <span class="number">41</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">88000</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;架构师&#x27;</span>, <span class="string">&#x27;2017-03-25&#x27;</span>, <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> departments <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;人力资源部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;运营部&#x27;</span>, <span class="string">&#x27;深圳&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> projects <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;电商平台升级&#x27;</span>, <span class="string">&#x27;2023-01-01&#x27;</span>, <span class="string">&#x27;2023-06-30&#x27;</span>, <span class="number">500000</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;移动App开发&#x27;</span>, <span class="string">&#x27;2023-02-15&#x27;</span>, <span class="string">&#x27;2023-08-31&#x27;</span>, <span class="number">300000</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;市场推广活动&#x27;</span>, <span class="string">&#x27;2023-03-01&#x27;</span>, <span class="string">&#x27;2023-05-31&#x27;</span>, <span class="number">150000</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;HR系统重构&#x27;</span>, <span class="string">&#x27;2023-04-01&#x27;</span>, <span class="string">&#x27;2023-09-30&#x27;</span>, <span class="number">200000</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;数据分析平台&#x27;</span>, <span class="string">&#x27;2023-05-15&#x27;</span>, <span class="string">&#x27;2023-12-31&#x27;</span>, <span class="number">400000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> employee_projects <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;开发工程师&#x27;</span>, <span class="string">&#x27;2023-01-01&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;后端开发&#x27;</span>, <span class="string">&#x27;2023-02-20&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="number">1</span>, <span class="string">&#x27;项目经理&#x27;</span>, <span class="string">&#x27;2023-01-01&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="number">3</span>, <span class="string">&#x27;活动策划&#x27;</span>, <span class="string">&#x27;2023-03-01&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="number">1</span>, <span class="string">&#x27;技术负责人&#x27;</span>, <span class="string">&#x27;2023-01-01&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="number">2</span>, <span class="string">&#x27;架构师&#x27;</span>, <span class="string">&#x27;2023-02-15&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="number">3</span>, <span class="string">&#x27;项目总监&#x27;</span>, <span class="string">&#x27;2023-03-01&#x27;</span>),</span><br><span class="line">(<span class="number">6</span>, <span class="number">4</span>, <span class="string">&#x27;需求分析&#x27;</span>, <span class="string">&#x27;2023-04-01&#x27;</span>),</span><br><span class="line">(<span class="number">7</span>, <span class="number">5</span>, <span class="string">&#x27;技术顾问&#x27;</span>, <span class="string">&#x27;2023-05-15&#x27;</span>),</span><br><span class="line">(<span class="number">8</span>, <span class="number">4</span>, <span class="string">&#x27;项目经理&#x27;</span>, <span class="string">&#x27;2023-04-01&#x27;</span>),</span><br><span class="line">(<span class="number">9</span>, <span class="number">3</span>, <span class="string">&#x27;执行经理&#x27;</span>, <span class="string">&#x27;2023-03-01&#x27;</span>),</span><br><span class="line">(<span class="number">10</span>, <span class="number">2</span>, <span class="string">&#x27;前端开发&#x27;</span>, <span class="string">&#x27;2023-02-15&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>SQL练习题对应的数据说明</strong></p><p><em>基础查询（1-5题）</em></p><p>使用<code>employees</code>表数据</p><p><em>聚合函数（6-10题）</em></p><p>使用<code>employees</code>表和分组统计</p><p><em>多表连接（11-15题）</em></p><p>使用<code>employees</code>,<code>departments</code>,<code>projects</code>,<code>employee_projects</code>表</p><p><em>子查询和高级功能（16-20题）</em></p><p>使用所有表进行复杂查询</p><p><strong>附加数据清洗SQL题目数据</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建需要清洗的数据表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employee_cleanup (</span><br><span class="line">    emp_id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    department <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">    record_date <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> employee_cleanup <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;13812345678&#x27;</span>, <span class="number">60000</span>, <span class="string">&#x27;2023-01-15&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;138-1234-5678&#x27;</span>, <span class="number">60000</span>, <span class="string">&#x27;2023-01-16&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;1351234567&#x27;</span>, <span class="number">80000</span>, <span class="string">&#x27;2023-01-15&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;13612345678&#x27;</span>, <span class="number">55000</span>, <span class="string">&#x27;2023-01-17&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;13912345678&#x27;</span>, <span class="number">250000</span>, <span class="string">&#x27;2023-01-15&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;钱七&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="string">&#x27;1371234abcd&#x27;</span>, <span class="number">90000</span>, <span class="string">&#x27;2023-01-18&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;1351234567&#x27;</span>, <span class="number">80000</span>, <span class="string">&#x27;2023-01-19&#x27;</span>);</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://leccxx-maker.github.io/ccxx">leccxx</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://leccxx-maker.github.io/ccxx/2025/11/17/2025-11-18-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0/">https://leccxx-maker.github.io/ccxx/2025/11/17/2025-11-18-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/ccxx/tags/%E7%BB%83%E4%B9%A0/">练习</a></div><div class="post-share"><div class="social-share" data-image="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/ccxx/2025/11/17/Ubuntu%20for%20Linux%20%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0/" title="Ubuntu for Linux 基础练习"><img class="cover" src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='onerror=null,src="/ccxx/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Ubuntu for Linux 基础练习</div></div><div class="info-2"><div class="info-item-1">Ubuntu for Linux 基础练习Ubuntu操作练习基础操作 用户和权限管理 创建新用户testuser并设置密码 将该用户添加到sudo组 创建一个共享目录/home/shared,设置权限775，确保该组用户有读写权限 1234567891011121314151617181920212223242526272829### 相关操作# 创建用户组zdffgroupsudo ...</div></div></div></a><a class="pagination-related" href="/ccxx/2025/11/17/2025-11-18-Dockerfile-and-YAML-file/" title="Dockerfile and YAML file"><img class="cover" src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='onerror=null,src="/ccxx/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Dockerfile and YAML file</div></div><div class="info-2"><div class="info-item-1">Dockerfile与YAML文件编写练习Dockerfile编写练习 基础Nginx镜像1234# 基于官方Nginx镜像，添加自定义HTML页面FROM nginx:alpineCOPY index.html /usr/share/nginx/html/EXPOSE 80 Python Flask应用12345678# 构建Python Flask应用镜像FROM python:3.9...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/ccxx/2025/11/17/2025-11-18-Dockerfile-and-YAML-file/" title="Dockerfile and YAML file"><img class="cover" src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-18</div><div class="info-item-2">Dockerfile and YAML file</div></div><div class="info-2"><div class="info-item-1">Dockerfile与YAML文件编写练习Dockerfile编写练习 基础Nginx镜像1234# 基于官方Nginx镜像，添加自定义HTML页面FROM nginx:alpineCOPY index.html /usr/share/nginx/html/EXPOSE 80 Python Flask应用12345678# 构建Python Flask应用镜像FROM python:3.9...</div></div></div></a><a class="pagination-related" href="/ccxx/2025/11/17/Ubuntu%20for%20Linux%20%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0/" title="Ubuntu for Linux 基础练习"><img class="cover" src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-18</div><div class="info-item-2">Ubuntu for Linux 基础练习</div></div><div class="info-2"><div class="info-item-1">Ubuntu for Linux 基础练习Ubuntu操作练习基础操作 用户和权限管理 创建新用户testuser并设置密码 将该用户添加到sudo组 创建一个共享目录/home/shared,设置权限775，确保该组用户有读写权限 1234567891011121314151617181920212223242526272829### 相关操作# 创建用户组zdffgroupsudo ...</div></div></div></a><a class="pagination-related" href="/ccxx/2025/11/19/%E5%AD%A6%E4%B9%A0python/" title="学习Python"><img class="cover" src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-20</div><div class="info-item-2">学习Python</div></div><div class="info-2"><div class="info-item-1">学习python的计划初步规划 计划的时间为2~3个月（开始时间为2024年11月20日到2025年1月20日或者2025年2月20日） 至少要达到中阶左右水平 12345678910111213141516《Python编程从入门到实践（第2版）》：Python入门基础，建议完成书中的项目。《代码整洁之道》：学习良好的代码风格和实践，培养编程规范。数据结构与算法入门《算法（第4版）》：了...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/avatar/avatar.jpg" onerror='this.onerror=null,this.src="/ccxx/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">leccxx</div><div class="author-info-description">Not having dreams that are impossible to achieve.</div><div class="site-data"><a href="/ccxx/archives/"><div class="headline">Articles</div><div class="length-num">5</div></a><a href="/ccxx/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/ccxx/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/leccxx-maker"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/leccxx-maker" target="_blank" title="Github"><i class="fab fa-github" style="color:#24292e"></i></a><a class="social-icon" href="mailto:25225ccxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color:#4a7dbe"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">欢迎来到我的博客！这里记录我在 Python、容器和 Linux 领域的学习笔记。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0"><span class="toc-number">1.</span> <span class="toc-text">数据清洗与SQL语法练习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E7%BA%A7%E9%A2%98%E7%9B%AE"><span class="toc-number">1.1.</span> <span class="toc-text">初级题目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E5%A4%B1%E5%80%BC%E5%A4%84%E7%90%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">缺失值处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">1.1.2.</span> <span class="toc-text">重复数据处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.1.3.</span> <span class="toc-text">数据类型转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E7%BA%A7%E9%A2%98%E7%9B%AE"><span class="toc-number">1.2.</span> <span class="toc-text">中级题目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%80%BC%E6%A3%80%E6%B5%8B%E4%B8%8E%E5%A4%84%E7%90%86"><span class="toc-number">1.2.1.</span> <span class="toc-text">异常值检测与处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97"><span class="toc-number">1.2.2.</span> <span class="toc-text">文本数据清洗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96"><span class="toc-number">1.2.3.</span> <span class="toc-text">数据标准化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E9%A2%98%E7%9B%AE"><span class="toc-number">1.3.</span> <span class="toc-text">高级题目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E6%95%B4%E5%90%88"><span class="toc-number">1.3.1.</span> <span class="toc-text">多源数据整合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E8%A7%84%E5%88%99%E6%B8%85%E6%B4%97"><span class="toc-number">1.3.2.</span> <span class="toc-text">复杂规则清洗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97"><span class="toc-number">1.3.3.</span> <span class="toc-text">非结构化数据清洗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%B4%A8%E9%87%8F%E8%AF%84%E4%BC%B0%E6%8A%A5%E5%91%8A"><span class="toc-number">1.3.4.</span> <span class="toc-text">数据质量评估报告</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20%E9%81%93SQL%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0"><span class="toc-number">1.4.</span> <span class="toc-text">20道SQL语法学习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.1.</span> <span class="toc-text">简单查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.2.</span> <span class="toc-text">条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.3.</span> <span class="toc-text">多条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.4.</span> <span class="toc-text">模糊查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.5.</span> <span class="toc-text">范围查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%81%9A%E5%90%88"><span class="toc-number">1.4.6.</span> <span class="toc-text">基本聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E7%BB%9F%E8%AE%A1"><span class="toc-number">1.4.7.</span> <span class="toc-text">分组统计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E8%BF%87%E6%BB%A4"><span class="toc-number">1.4.8.</span> <span class="toc-text">分组过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%BB%B4%E5%BA%A6%E8%81%9A%E5%90%88"><span class="toc-number">1.4.9.</span> <span class="toc-text">多维度聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E8%81%9A%E5%90%88"><span class="toc-number">1.4.10.</span> <span class="toc-text">复杂聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.11.</span> <span class="toc-text">内连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A6%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.12.</span> <span class="toc-text">左连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.13.</span> <span class="toc-text">多表连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.14.</span> <span class="toc-text">自连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.15.</span> <span class="toc-text">复杂连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.16.</span> <span class="toc-text">子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.17.</span> <span class="toc-text">相关子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">1.4.18.</span> <span class="toc-text">窗口函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CASE%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.4.19.</span> <span class="toc-text">CASE表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.20.</span> <span class="toc-text">递归查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97SQL%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.4.21.</span> <span class="toc-text">数据清洗SQL实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="toc-number">2.</span> <span class="toc-text">测试数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E8%84%9A%E6%9C%AC%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="toc-number">2.1.</span> <span class="toc-text">数据清洗脚本测试数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E5%A4%B1%E5%80%BC%E5%A4%84%E7%90%86-1"><span class="toc-number">2.1.1.</span> <span class="toc-text">缺失值处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86-1"><span class="toc-number">2.1.2.</span> <span class="toc-text">重复数据处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2-1"><span class="toc-number">2.1.3.</span> <span class="toc-text">数据类型转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%80%BC%E6%A3%80%E6%B5%8B%E4%B8%8E%E5%A4%84%E7%90%86-1"><span class="toc-number">2.1.4.</span> <span class="toc-text">异常值检测与处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97-1"><span class="toc-number">2.1.5.</span> <span class="toc-text">文本数据清洗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96-1"><span class="toc-number">2.1.6.</span> <span class="toc-text">数据标准化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E6%95%B4%E5%90%88-1"><span class="toc-number">2.1.7.</span> <span class="toc-text">多源数据整合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.</span> <span class="toc-text">SQL语法学习测试数据</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/ccxx/2025/11/19/%E5%AD%A6%E4%B9%A0python/" title="学习Python"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='this.onerror=null,this.src="/ccxx/img/404.jpg"' alt="学习Python"></a><div class="content"><a class="title" href="/ccxx/2025/11/19/%E5%AD%A6%E4%B9%A0python/" title="学习Python">学习Python</a><time datetime="2025-11-19T16:00:00.000Z" title="Created 2025-11-20 00:00:00">2025-11-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ccxx/2025/11/17/2025-11-18-Dockerfile-and-YAML-file/" title="Dockerfile and YAML file"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='this.onerror=null,this.src="/ccxx/img/404.jpg"' alt="Dockerfile and YAML file"></a><div class="content"><a class="title" href="/ccxx/2025/11/17/2025-11-18-Dockerfile-and-YAML-file/" title="Dockerfile and YAML file">Dockerfile and YAML file</a><time datetime="2025-11-17T16:00:00.000Z" title="Created 2025-11-18 00:00:00">2025-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ccxx/2025/11/17/2025-11-18-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0/" title="数据清洗与SQL语法练习"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='this.onerror=null,this.src="/ccxx/img/404.jpg"' alt="数据清洗与SQL语法练习"></a><div class="content"><a class="title" href="/ccxx/2025/11/17/2025-11-18-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E4%B8%8ESQL%E8%AF%AD%E6%B3%95%E7%BB%83%E4%B9%A0/" title="数据清洗与SQL语法练习">数据清洗与SQL语法练习</a><time datetime="2025-11-17T16:00:00.000Z" title="Created 2025-11-18 00:00:00">2025-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ccxx/2025/11/17/Ubuntu%20for%20Linux%20%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0/" title="Ubuntu for Linux 基础练习"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='this.onerror=null,this.src="/ccxx/img/404.jpg"' alt="Ubuntu for Linux 基础练习"></a><div class="content"><a class="title" href="/ccxx/2025/11/17/Ubuntu%20for%20Linux%20%E5%9F%BA%E7%A1%80%E7%BB%83%E4%B9%A0/" title="Ubuntu for Linux 基础练习">Ubuntu for Linux 基础练习</a><time datetime="2025-11-17T16:00:00.000Z" title="Created 2025-11-18 00:00:00">2025-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ccxx/2025/11/17/K8s%E9%9B%86%E7%BE%A4%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/" title="K8s集群自动化部署与管理平台"><img src="https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/lake-tahoe-1658659.jpg" onerror='this.onerror=null,this.src="/ccxx/img/404.jpg"' alt="K8s集群自动化部署与管理平台"></a><div class="content"><a class="title" href="/ccxx/2025/11/17/K8s%E9%9B%86%E7%BE%A4%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/" title="K8s集群自动化部署与管理平台">K8s集群自动化部署与管理平台</a><time datetime="2025-11-17T16:00:00.000Z" title="Created 2025-11-18 00:00:00">2025-11-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://myblog-ccxx.oss-cn-hangzhou.aliyuncs.com/site_imgs/mushrooms-9946579.jpg)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By leccxx</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/ccxx/js/utils.js?v=5.5.2"></script><script src="/ccxx/js/main.js?v=5.5.2"></script><div class="js-pjax"></div><script async data-pjax src="/ccxx/"></script></div></body></html>